# Database Structure Documentation

**Generated**: 8/28/2025, 9:46:18 AM  
**Version**: v07  
**Generated By**: Thomas Schenkelberg  
**Filename**: DATABASE-STRUCTURE_20250828_v07.md

---

## Table of Contents

- [Overview](#overview)
  - [Summary Statistics](#summary-statistics)
- [Tables Overview](#tables-overview)
- [Table Structures](#table-structures)
  - [coa_translation_sessions](#coa-translation-sessions)
  - [entities](#entities)
  - [entity_groups](#entity-groups)
  - [report_line_items](#report-line-items)
  - [report_structure_change_logs](#report-structure-change-logs)
  - [report_structures](#report-structures)
  - [security_audit_logs](#security-audit-logs)
  - [security_rate_limits](#security-rate-limits)
  - [user_accounts](#user-accounts)
  - [user_entity_access](#user-entity-access)
  - [user_roles](#user-roles)
  - [user_session_logs](#user-session-logs)
- [Constraints and Validation Rules](#constraints-and-validation-rules)
- [Enums and Custom Types](#enums-and-custom-types)
- [Foreign Key Relationships Graph](#foreign-key-relationships-graph-text-based)
- [Database Functions](#database-functions)
- [Security Policies Summary](#security-policies-summary)
- [Indexes and Performance](#indexes-and-performance)
- [Usage Examples](#usage-examples)
- [Conventions Used](#conventions-used)
- [Changelog](#changelog)

---

## Overview

This document provides a comprehensive overview of the database structure for the current system.

### Summary Statistics
- **Total Tables**: 12
- **Total Columns**: 192
- **Total Enums**: 6
- **Total Foreign Keys**: 21
- **Total RLS Policies**: 43
- **Total Database Functions**: 61
- **Total Indexes**: 69
- **Total Constraints**: 155
- **Schema**: public

---

## Tables Overview

| Table Name                       | Type       | Columns  | Foreign Keys | RLS Policies | Indexes  |
| -------------------------------- | ---------- | -------- | ------------ | ------------ | -------- |
| **coa_translation_sessions**     | BASE TABLE | 22       | 2            | 5            | 9        |
| **entities**                     | BASE TABLE | 11       | 2            | 3            | 3        |
| **entity_groups**                | BASE TABLE | 9        | 1            | 2            | 3        |
| **report_line_items**            | BASE TABLE | 36       | 5            | 5            | 12       |
| **report_structure_change_logs** | BASE TABLE | 19       | 0            | 3            | 6        |
| **report_structures**            | BASE TABLE | 20       | 2            | 5            | 8        |
| **security_audit_logs**          | BASE TABLE | 13       | 3            | 1            | 6        |
| **security_rate_limits**         | BASE TABLE | 11       | 0            | 1            | 2        |
| **user_accounts**                | BASE TABLE | 18       | 0            | 7            | 6        |
| **user_entity_access**           | BASE TABLE | 13       | 4            | 6            | 7        |
| **user_roles**                   | BASE TABLE | 8        | 2            | 3            | 4        |
| **user_session_logs**            | BASE TABLE | 12       | 0            | 2            | 3        |

This overview provides a quick summary of all database tables with their key characteristics. Tables with RLS policies have security controls enabled, while foreign keys indicate relationships between tables.

---

## Table Structures

### coa_translation_sessions

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 22  
**Foreign Keys**: 2  
**RLS Policies**: 5  
**Indexes**: 9

#### Columns

| Column                           | Type                     | Nullable | Default              |
| -------------------------------- | ------------------------ | -------- | -------------------- |
| **coa_translation_session_uuid** | uuid                     | No       | UUID                 |
| **session_id**                   | uuid                     | No       | UUID                 |
| **user_id**                      | uuid                     | No       | None                 |
| **filename**                     | text                     | No       | None                 |
| **total_accounts**               | integer                  | No       | None                 |
| **processed_accounts**           | integer                  | Yes      | 0                    |
| **source_language**              | text                     | Yes      | None                 |
| **target_language**              | text                     | No       | None                 |
| **session_data**                 | jsonb                    | No       | '{}'::jsonb          |
| **status**                       | text                     | No       | 'processing'::text   |
| **created_at**                   | timestamp with time zone | No       | Current Time         |
| **completed_at**                 | timestamp with time zone | Yes      | None                 |
| **updated_at**                   | timestamp with time zone | No       | Current Time         |
| **error_details**                | jsonb                    | Yes      | None                 |
| **retry_count**                  | integer                  | Yes      | 0                    |
| **progress_percentage**          | numeric                  | Yes      | 0.00                 |
| **estimated_completion_at**      | timestamp with time zone | Yes      | None                 |
| **user_uuid**                    | uuid                     | Yes      | None                 |
| **status_enum**                  | USER-DEFINED             | No       | 'pending'::transl... |
| **coa_translation_session_id**   | integer                  | No       | None                 |
| **entity_uuid**                  | uuid                     | Yes      | None                 |
| **entity_id**                    | integer                  | Yes      | None                 |


**Primary Keys**: coa_translation_session_uuid, user_uuid, entity_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column      | References                     | Constraint Name                          |
| ----------- | ------------------------------ | ---------------------------------------- |
| entity_uuid | public.entities.entity_uuid    | fk_coa_translation_sessions_entity       |
| user_uuid   | public.user_accounts.user_uuid | fk_coa_translation_sessions_user_account |


#### Row Level Security Policies

**Admins can view all translation sessions**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Users can delete their own translation sessions**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (auth.uid() = user_id)  
- **With Check Expression**: N/A  

**Users can insert their own translation sessions**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: (auth.uid() = user_id)  

**Users can update their own translation sessions**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (auth.uid() = user_id)  
- **With Check Expression**: N/A  

**Users can view their own translation sessions**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (auth.uid() = user_id)  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                                  | Columns                      | Unique   | Primary  | Type     |
| ------------------------------------------- | ---------------------------- | -------- | -------- | -------- |
| idx_coa_translation_sessions_created_at     | created_at                   | No       | No       | btree    |
| idx_coa_translation_sessions_status         | status                       | No       | No       | btree    |
| idx_coa_translation_sessions_status_enum    | status_enum                  | No       | No       | btree    |
| idx_coa_translation_sessions_status_updated | updated_at, status_enum      | No       | No       | btree    |
| idx_coa_translation_sessions_user_account   | user_uuid                    | No       | No       | btree    |
| idx_coa_translation_sessions_user_id        | user_id                      | No       | No       | btree    |
| pk_coa_translation_sessions                 | coa_translation_session_uuid | Yes      | Yes      | btree    |
| uq_coa_translation_sessions_id              | coa_translation_session_id   | Yes      | No       | btree    |
| uq_coa_translation_sessions_session_id      | session_id                   | Yes      | No       | btree    |


---

### entities

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 11  
**Foreign Keys**: 2  
**RLS Policies**: 3  
**Indexes**: 3

#### Columns

| Column                   | Type                     | Nullable | Default      |
| ------------------------ | ------------------------ | -------- | ------------ |
| **entity_uuid**          | uuid                     | No       | UUID         |
| **entity_id**            | integer                  | No       | None         |
| **entity_name**          | text                     | No       | None         |
| **entity_code**          | text                     | No       | None         |
| **entity_group_uuid**    | uuid                     | No       | None         |
| **entity_group_id**      | integer                  | No       | None         |
| **description**          | text                     | Yes      | None         |
| **is_active**            | boolean                  | No       | true         |
| **created_at**           | timestamp with time zone | No       | Current Time |
| **updated_at**           | timestamp with time zone | No       | Current Time |
| **created_by_user_uuid** | uuid                     | Yes      | None         |


**Primary Keys**: entity_uuid, entity_group_uuid, created_by_user_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column               | References                             | Constraint Name          |
| -------------------- | -------------------------------------- | ------------------------ |
| created_by_user_uuid | public.user_accounts.user_uuid         | fk_entities_created_by   |
| entity_group_uuid    | public.entity_groups.entity_group_uuid | fk_entities_entity_group |


#### Row Level Security Policies

**Entity admins can update their entities**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM user_entity_access uea
  WHERE ((uea.user_uuid = ( SELECT user_accounts.user_uuid
           FROM user_accounts
          WHERE (user_accounts.supabase_user_uuid = auth.uid()))) AND ((uea.entity_uuid = entities.entity_uuid) OR (uea.entity_group_uuid = entities.entity_group_uuid)) AND (uea.is_active = true) AND (uea.access_level = 'entity_admin'::access_level))))  
- **With Check Expression**: N/A  

**Super admins can manage all entities**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_super_admin_user()  
- **With Check Expression**: N/A  

**Users can view entities they have access to**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM user_entity_access uea
  WHERE ((uea.user_uuid = ( SELECT user_accounts.user_uuid
           FROM user_accounts
          WHERE (user_accounts.supabase_user_uuid = auth.uid()))) AND ((uea.entity_uuid = entities.entity_uuid) OR (uea.entity_group_uuid = entities.entity_group_uuid)) AND (uea.is_active = true))))  
- **With Check Expression**: N/A  



#### Indexes

| Index Name       | Columns     | Unique   | Primary  | Type     |
| ---------------- | ----------- | -------- | -------- | -------- |
| pk_entities      | entity_uuid | Yes      | Yes      | btree    |
| uq_entities_code | entity_code | Yes      | No       | btree    |
| uq_entities_id   | entity_id   | Yes      | No       | btree    |


---

### entity_groups

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 9  
**Foreign Keys**: 1  
**RLS Policies**: 2  
**Indexes**: 3

#### Columns

| Column                   | Type                     | Nullable | Default      |
| ------------------------ | ------------------------ | -------- | ------------ |
| **entity_group_uuid**    | uuid                     | No       | UUID         |
| **entity_group_id**      | integer                  | No       | None         |
| **entity_group_name**    | text                     | No       | None         |
| **entity_group_code**    | text                     | No       | None         |
| **description**          | text                     | Yes      | None         |
| **is_active**            | boolean                  | No       | true         |
| **created_at**           | timestamp with time zone | No       | Current Time |
| **updated_at**           | timestamp with time zone | No       | Current Time |
| **created_by_user_uuid** | uuid                     | Yes      | None         |


**Primary Keys**: entity_group_uuid, created_by_user_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column               | References                     | Constraint Name             |
| -------------------- | ------------------------------ | --------------------------- |
| created_by_user_uuid | public.user_accounts.user_uuid | fk_entity_groups_created_by |


#### Row Level Security Policies

**Entity admins can view their entity groups**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM (user_entity_access uea
     JOIN entities e ON ((e.entity_group_uuid = entity_groups.entity_group_uuid)))
  WHERE ((uea.user_uuid = ( SELECT user_accounts.user_uuid
           FROM user_accounts
          WHERE (user_accounts.supabase_user_uuid = auth.uid()))) AND (uea.entity_uuid = e.entity_uuid) AND (uea.is_active = true) AND (uea.access_level = 'entity_admin'::access_level))))  
- **With Check Expression**: N/A  

**Super admins can manage all entity groups**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_super_admin_user()  
- **With Check Expression**: N/A  



#### Indexes

| Index Name            | Columns           | Unique   | Primary  | Type     |
| --------------------- | ----------------- | -------- | -------- | -------- |
| pk_entity_groups      | entity_group_uuid | Yes      | Yes      | btree    |
| uq_entity_groups_code | entity_group_code | Yes      | No       | btree    |
| uq_entity_groups_id   | entity_group_id   | Yes      | No       | btree    |


---

### report_line_items

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 36  
**Foreign Keys**: 5  
**RLS Policies**: 5  
**Indexes**: 12

#### Columns

| Column                            | Type                     | Nullable | Default      |
| --------------------------------- | ------------------------ | -------- | ------------ |
| **report_line_item_uuid**         | uuid                     | No       | UUID         |
| **report_line_item_id**           | integer                  | No       | None         |
| **report_line_item_description**  | text                     | Yes      | None         |
| **report_structure_id**           | integer                  | No       | None         |
| **report_structure_uuid**         | uuid                     | No       | None         |
| **report_structure_name**         | text                     | No       | None         |
| **report_line_item_key**          | text                     | No       | None         |
| **parent_report_line_item_key**   | text                     | Yes      | None         |
| **parent_report_line_item_uuid**  | uuid                     | Yes      | None         |
| **is_parent_key_existing**        | boolean                  | Yes      | false        |
| **sort_order**                    | integer                  | No       | 0            |
| **hierarchy_path**                | text                     | Yes      | None         |
| **level_1_line_item_description** | text                     | Yes      | None         |
| **level_2_line_item_description** | text                     | Yes      | None         |
| **level_3_line_item_description** | text                     | Yes      | None         |
| **level_4_line_item_description** | text                     | Yes      | None         |
| **level_5_line_item_description** | text                     | Yes      | None         |
| **level_6_line_item_description** | text                     | Yes      | None         |
| **level_7_line_item_description** | text                     | Yes      | None         |
| **line_item_type**                | text                     | Yes      | None         |
| **description_of_leaf**           | text                     | Yes      | None         |
| **is_leaf**                       | boolean                  | Yes      | false        |
| **is_calculated**                 | boolean                  | Yes      | false        |
| **display**                       | boolean                  | Yes      | true         |
| **data_source**                   | text                     | Yes      | None         |
| **comment**                       | text                     | Yes      | None         |
| **created_at**                    | timestamp with time zone | Yes      | Current Time |
| **updated_at**                    | timestamp with time zone | Yes      | Current Time |
| **created_by**                    | uuid                     | Yes      | None         |
| **updated_by**                    | uuid                     | Yes      | None         |
| **tags**                          | ARRAY                    | Yes      | None         |
| **metadata**                      | jsonb                    | Yes      | '{}'::jsonb  |
| **created_by_user_uuid**          | uuid                     | Yes      | None         |
| **updated_by_user_uuid**          | uuid                     | Yes      | None         |
| **entity_uuid**                   | uuid                     | Yes      | None         |
| **entity_id**                     | integer                  | Yes      | None         |


**Primary Keys**: report_line_item_uuid, report_structure_uuid, parent_report_line_item_uuid, created_by_user_uuid, updated_by_user_uuid, entity_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column                | References                                     | Constraint Name                              |
| --------------------- | ---------------------------------------------- | -------------------------------------------- |
| created_by_user_uuid  | public.user_accounts.user_uuid                 | fk_report_line_items_created_by_user_account |
| entity_uuid           | public.entities.entity_uuid                    | fk_report_line_items_entity                  |
| report_structure_id   | public.report_structures.report_structure_id   | report_line_items_report_structure_id_fkey   |
| report_structure_uuid | public.report_structures.report_structure_uuid | report_line_items_report_structure_uuid_fkey |
| updated_by_user_uuid  | public.user_accounts.user_uuid                 | fk_report_line_items_updated_by_user_account |


#### Row Level Security Policies

**Admins can delete report line items**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Admins can insert report line items**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: is_admin_user()  

**Admins can update report line items**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Admins can view all report line items**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Authenticated users can view line items from active structures**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM report_structures
  WHERE ((report_structures.report_structure_uuid = report_line_items.report_structure_uuid) AND (report_structures.is_active = true))))  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                                    | Columns                                            | Unique   | Primary  | Type     |
| --------------------------------------------- | -------------------------------------------------- | -------- | -------- | -------- |
| idx_report_line_items_created_by_user_account | created_by_user_uuid                               | No       | No       | btree    |
| idx_report_line_items_key                     | report_line_item_key                               | No       | No       | btree    |
| idx_report_line_items_parent_uuid             | parent_report_line_item_uuid                       | No       | No       | btree    |
| idx_report_line_items_sort_order              | report_structure_uuid, sort_order                  | No       | No       | btree    |
| idx_report_line_items_structure_id            | report_structure_id                                | No       | No       | btree    |
| idx_report_line_items_structure_parent        | report_structure_uuid, parent_report_line_item_... | No       | No       | btree    |
| idx_report_line_items_structure_sort          | report_structure_uuid, sort_order                  | No       | No       | btree    |
| idx_report_line_items_structure_uuid          | report_structure_uuid                              | No       | No       | btree    |
| idx_report_line_items_updated_by_user_account | updated_by_user_uuid                               | No       | No       | btree    |
| pk_report_line_items                          | report_line_item_uuid                              | Yes      | Yes      | btree    |
| uq_report_line_items_id                       | report_line_item_id                                | Yes      | No       | btree    |
| uq_report_line_items_structure_sort_order     | report_structure_uuid, sort_order                  | Yes      | No       | btree    |


---

### report_structure_change_logs

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 19  
**Foreign Keys**: 0  
**RLS Policies**: 3  
**Indexes**: 6

#### Columns

| Column                    | Type                     | Nullable | Default              |
| ------------------------- | ------------------------ | -------- | -------------------- |
| **change_uuid**           | uuid                     | No       | UUID                 |
| **change_id**             | integer                  | No       | nextval('report_s... |
| **user_uuid**             | uuid                     | No       | None                 |
| **user_first_name**       | text                     | Yes      | None                 |
| **user_last_name**        | text                     | Yes      | None                 |
| **user_email**            | text                     | Yes      | None                 |
| **structure_uuid**        | uuid                     | No       | None                 |
| **structure_id**          | integer                  | No       | None                 |
| **line_item_uuid**        | uuid                     | Yes      | None                 |
| **line_item_id**          | integer                  | Yes      | None                 |
| **action_type**           | USER-DEFINED             | No       | None                 |
| **line_item_key**         | text                     | No       | None                 |
| **line_item_description** | text                     | Yes      | None                 |
| **previous_state**        | jsonb                    | Yes      | None                 |
| **new_state**             | jsonb                    | Yes      | None                 |
| **timestamp**             | timestamp with time zone | No       | Current Time         |
| **is_undone**             | boolean                  | No       | false                |
| **undone_at**             | timestamp with time zone | Yes      | None                 |
| **undone_by_uuid**        | uuid                     | Yes      | None                 |


**Primary Keys**: change_uuid, user_uuid, structure_uuid, line_item_uuid, undone_by_uuid






#### Row Level Security Policies

**Admins can view all change logs**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Users can insert their own change logs**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: (auth.uid() = user_uuid)  

**Users can update their own change logs for undo**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((auth.uid() = user_uuid) OR is_admin_user())  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                                | Columns        | Unique   | Primary  | Type     |
| ----------------------------------------- | -------------- | -------- | -------- | -------- |
| idx_change_log_is_undone                  | is_undone      | No       | No       | btree    |
| idx_change_log_structure_uuid             | structure_uuid | No       | No       | btree    |
| idx_change_log_timestamp                  | timestamp      | No       | No       | btree    |
| idx_change_log_user_uuid                  | user_uuid      | No       | No       | btree    |
| pk_report_structure_change_logs           | change_uuid    | Yes      | Yes      | btree    |
| uq_report_structure_change_logs_change_id | change_id      | Yes      | No       | btree    |


---

### report_structures

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 20  
**Foreign Keys**: 2  
**RLS Policies**: 5  
**Indexes**: 8

#### Columns

| Column                            | Type                     | Nullable | Default              |
| --------------------------------- | ------------------------ | -------- | -------------------- |
| **report_structure_uuid**         | uuid                     | No       | UUID                 |
| **report_structure_id**           | integer                  | No       | None                 |
| **report_structure_name**         | text                     | No       | None                 |
| **is_active**                     | boolean                  | No       | false                |
| **created_at**                    | timestamp with time zone | No       | Current Time         |
| **updated_at**                    | timestamp with time zone | No       | Current Time         |
| **created_by_supabase_user_uuid** | uuid                     | No       | None                 |
| **created_by_user_name**          | text                     | No       | None                 |
| **version**                       | integer                  | No       | 1                    |
| **name_of_import_file**           | text                     | Yes      | None                 |
| **imported_structure_id**         | text                     | Yes      | None                 |
| **description**                   | text                     | Yes      | None                 |
| **tags**                          | ARRAY                    | Yes      | None                 |
| **metadata**                      | jsonb                    | Yes      | '{}'::jsonb          |
| **archived_at**                   | timestamp with time zone | Yes      | None                 |
| **archived_by**                   | uuid                     | Yes      | None                 |
| **archived_by_user_uuid**         | uuid                     | Yes      | None                 |
| **lifecycle_status**              | USER-DEFINED             | No       | 'draft'::report_s... |
| **entity_uuid**                   | uuid                     | Yes      | None                 |
| **entity_id**                     | integer                  | Yes      | None                 |


**Primary Keys**: report_structure_uuid, created_by_supabase_user_uuid, archived_by_user_uuid, entity_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column                | References                     | Constraint Name                               |
| --------------------- | ------------------------------ | --------------------------------------------- |
| archived_by_user_uuid | public.user_accounts.user_uuid | fk_report_structures_archived_by_user_account |
| entity_uuid           | public.entities.entity_uuid    | fk_report_structures_entity                   |


#### Row Level Security Policies

**Admins can delete report structures**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Admins can insert report structures**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: is_admin_user()  

**Admins can update report structures**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Admins can view all report structures**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Authenticated users can view active report structures**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (is_active = true)  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                                     | Columns                       | Unique   | Primary  | Type     |
| ---------------------------------------------- | ----------------------------- | -------- | -------- | -------- |
| idx_report_structures_active_created           | is_active, created_at         | No       | No       | btree    |
| idx_report_structures_archived_by_user_account | archived_by_user_uuid         | No       | No       | btree    |
| idx_report_structures_created_by_user          | created_by_supabase_user_uuid | No       | No       | btree    |
| idx_report_structures_is_active                | is_active                     | No       | No       | btree    |
| idx_report_structures_lifecycle_active         | is_active, lifecycle_status   | No       | No       | btree    |
| idx_report_structures_lifecycle_status         | lifecycle_status              | No       | No       | btree    |
| pk_report_structures                           | report_structure_uuid         | Yes      | Yes      | btree    |
| uq_report_structures_id                        | report_structure_id           | Yes      | No       | btree    |


---

### security_audit_logs

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 13  
**Foreign Keys**: 3  
**RLS Policies**: 1  
**Indexes**: 6

#### Columns

| Column                      | Type                     | Nullable | Default      |
| --------------------------- | ------------------------ | -------- | ------------ |
| **security_audit_log_uuid** | uuid                     | No       | UUID         |
| **user_id**                 | uuid                     | Yes      | None         |
| **action**                  | text                     | No       | None         |
| **target_user_id**          | uuid                     | Yes      | None         |
| **details**                 | jsonb                    | Yes      | None         |
| **ip_address**              | inet                     | Yes      | None         |
| **user_agent**              | text                     | Yes      | None         |
| **created_at**              | timestamp with time zone | No       | Current Time |
| **user_uuid**               | uuid                     | Yes      | None         |
| **target_user_uuid**        | uuid                     | Yes      | None         |
| **security_audit_log_id**   | integer                  | No       | None         |
| **entity_uuid**             | uuid                     | Yes      | None         |
| **entity_id**               | integer                  | Yes      | None         |


**Primary Keys**: security_audit_log_uuid, user_uuid, target_user_uuid, entity_uuid



**Timestamps**: created_at


#### Foreign Key Relationships

| Column           | References                     | Constraint Name                            |
| ---------------- | ------------------------------ | ------------------------------------------ |
| entity_uuid      | public.entities.entity_uuid    | fk_security_audit_logs_entity              |
| target_user_uuid | public.user_accounts.user_uuid | fk_security_audit_logs_target_user_account |
| user_uuid        | public.user_accounts.user_uuid | fk_security_audit_logs_user_account        |


#### Row Level Security Policies

**Admins can view audit logs**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user_v2()  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                                  | Columns                 | Unique   | Primary  | Type     |
| ------------------------------------------- | ----------------------- | -------- | -------- | -------- |
| idx_security_audit_logs_action_created      | action, created_at      | No       | No       | btree    |
| idx_security_audit_logs_target_user_account | target_user_uuid        | No       | No       | btree    |
| idx_security_audit_logs_user_account        | user_uuid               | No       | No       | btree    |
| idx_security_audit_logs_user_created        | user_id, created_at     | No       | No       | btree    |
| pk_security_audit_logs                      | security_audit_log_uuid | Yes      | Yes      | btree    |
| uq_security_audit_logs_id                   | security_audit_log_id   | Yes      | No       | btree    |


---

### security_rate_limits

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 11  
**Foreign Keys**: 0  
**RLS Policies**: 1  
**Indexes**: 2

#### Columns

| Column                       | Type                     | Nullable | Default      |
| ---------------------------- | ------------------------ | -------- | ------------ |
| **security_rate_limit_uuid** | uuid                     | No       | UUID         |
| **security_rate_limit_id**   | integer                  | No       | None         |
| **operation_type**           | text                     | No       | None         |
| **identifier**               | text                     | No       | None         |
| **attempt_count**            | integer                  | No       | 1            |
| **window_start_at**          | timestamp with time zone | No       | Current Time |
| **last_attempt_at**          | timestamp with time zone | No       | Current Time |
| **is_blocked**               | boolean                  | No       | false        |
| **blocked_until_at**         | timestamp with time zone | Yes      | None         |
| **created_at**               | timestamp with time zone | No       | Current Time |
| **updated_at**               | timestamp with time zone | No       | Current Time |


**Primary Keys**: security_rate_limit_uuid



**Timestamps**: created_at, updated_at




#### Row Level Security Policies

**Admins can manage rate limits**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user_v2()  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                      | Columns                                     | Unique   | Primary  | Type     |
| ------------------------------- | ------------------------------------------- | -------- | -------- | -------- |
| idx_security_rate_limits_lookup | operation_type, identifier, window_start_at | No       | No       | btree    |
| security_rate_limits_pkey       | security_rate_limit_uuid                    | Yes      | Yes      | btree    |


---

### user_accounts

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 18  
**Foreign Keys**: 0  
**RLS Policies**: 7  
**Indexes**: 6

#### Columns

| Column                    | Type                     | Nullable | Default              |
| ------------------------- | ------------------------ | -------- | -------------------- |
| **user_uuid**             | uuid                     | No       | UUID                 |
| **user_id**               | integer                  | No       | None                 |
| **supabase_user_uuid**    | uuid                     | No       | None                 |
| **email**                 | text                     | No       | None                 |
| **first_name**            | text                     | Yes      | None                 |
| **last_name**             | text                     | Yes      | None                 |
| **created_at**            | timestamp with time zone | No       | Current Time         |
| **approved_at**           | timestamp with time zone | Yes      | None                 |
| **approved_by**           | uuid                     | Yes      | None                 |
| **phone_number**          | text                     | Yes      | None                 |
| **timezone**              | text                     | Yes      | 'UTC'::text          |
| **locale**                | text                     | Yes      | 'en-US'::text        |
| **last_login_at**         | timestamp with time zone | Yes      | None                 |
| **password_changed_at**   | timestamp with time zone | Yes      | None                 |
| **failed_login_attempts** | integer                  | Yes      | 0                    |
| **locked_until**          | timestamp with time zone | Yes      | None                 |
| **updated_at**            | timestamp with time zone | Yes      | Current Time         |
| **user_status**           | USER-DEFINED             | No       | 'pending'::user_a... |


**Primary Keys**: user_uuid



**Timestamps**: created_at, updated_at




#### Row Level Security Policies

**Admins can update all user_accounts**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Admins can view all user_accounts**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Deny anonymous access to user accounts**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: anon  
- **Using Expression**: false  
- **With Check Expression**: N/A  

**Only super admins can delete user accounts**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_super_admin_user()  
- **With Check Expression**: N/A  

**Users can insert their own user_account**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: (auth.uid() = supabase_user_uuid)  

**Users can update their own user_account**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (auth.uid() = supabase_user_uuid)  
- **With Check Expression**: N/A  

**Users can view their own user_account**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (auth.uid() = supabase_user_uuid)  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                          | Columns            | Unique   | Primary  | Type     |
| ----------------------------------- | ------------------ | -------- | -------- | -------- |
| idx_user_accounts_last_login        | last_login_at      | No       | No       | btree    |
| idx_user_accounts_status_enum       | user_status        | No       | No       | btree    |
| pk_user_accounts                    | user_uuid          | Yes      | Yes      | btree    |
| uq_user_accounts_email              | email              | Yes      | No       | btree    |
| uq_user_accounts_id                 | user_id            | Yes      | No       | btree    |
| uq_user_accounts_supabase_user_uuid | supabase_user_uuid | Yes      | No       | btree    |


---

### user_entity_access

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 13  
**Foreign Keys**: 4  
**RLS Policies**: 6  
**Indexes**: 7

#### Columns

| Column                      | Type                     | Nullable | Default      |
| --------------------------- | ------------------------ | -------- | ------------ |
| **user_entity_access_uuid** | uuid                     | No       | UUID         |
| **user_entity_access_id**   | integer                  | No       | None         |
| **user_uuid**               | uuid                     | No       | None         |
| **user_id**                 | integer                  | No       | None         |
| **entity_uuid**             | uuid                     | Yes      | None         |
| **entity_id**               | integer                  | Yes      | None         |
| **entity_group_uuid**       | uuid                     | Yes      | None         |
| **entity_group_id**         | integer                  | Yes      | None         |
| **access_level**            | USER-DEFINED             | No       | None         |
| **granted_by_user_uuid**    | uuid                     | Yes      | None         |
| **granted_at**              | timestamp with time zone | No       | Current Time |
| **revoked_at**              | timestamp with time zone | Yes      | None         |
| **is_active**               | boolean                  | No       | true         |


**Primary Keys**: user_entity_access_uuid, user_uuid, entity_uuid, entity_group_uuid, granted_by_user_uuid




#### Foreign Key Relationships

| Column               | References                             | Constraint Name                    |
| -------------------- | -------------------------------------- | ---------------------------------- |
| entity_group_uuid    | public.entity_groups.entity_group_uuid | fk_user_entity_access_entity_group |
| entity_uuid          | public.entities.entity_uuid            | fk_user_entity_access_entity       |
| granted_by_user_uuid | public.user_accounts.user_uuid         | fk_user_entity_access_granted_by   |
| user_uuid            | public.user_accounts.user_uuid         | fk_user_entity_access_user         |


#### Row Level Security Policies

**Entity admins can delete access grants in their scope v2**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (is_super_admin_user() OR is_entity_admin_for_scope(( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid())), entity_uuid, entity_group_uuid))  
- **With Check Expression**: N/A  

**Entity admins can insert access grants in their scope v2**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: N/A  
- **With Check Expression**: (is_super_admin_user() OR is_entity_admin_for_scope(( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid())), entity_uuid, entity_group_uuid))  

**Entity admins can update access grants in their scope v2**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (is_super_admin_user() OR is_entity_admin_for_scope(( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid())), entity_uuid, entity_group_uuid))  
- **With Check Expression**: N/A  

**Entity admins can view access grants in their scope v2**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (is_super_admin_user() OR (user_uuid = ( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid()))) OR is_entity_admin_for_scope(( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid())), entity_uuid, entity_group_uuid))  
- **With Check Expression**: N/A  

**Super admins can manage all user entity access**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_super_admin_user()  
- **With Check Expression**: N/A  

**Users can view their own access grants**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (user_uuid = ( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid())))  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                           | Columns                            | Unique   | Primary  | Type     |
| ------------------------------------ | ---------------------------------- | -------- | -------- | -------- |
| idx_user_entity_access_active_entity | user_uuid, entity_uuid             | Yes      | No       | btree    |
| idx_user_entity_access_active_group  | user_uuid, entity_group_uuid       | Yes      | No       | btree    |
| idx_user_entity_access_admin_lookup  | user_uuid, access_level, is_active | No       | No       | btree    |
| pk_user_entity_access                | user_entity_access_uuid            | Yes      | Yes      | btree    |
| uea_unique_active_entity             | user_uuid, entity_uuid             | Yes      | No       | btree    |
| uea_unique_active_entity_group       | user_uuid, entity_group_uuid       | Yes      | No       | btree    |
| uq_user_entity_access_id             | user_entity_access_id              | Yes      | No       | btree    |


---

### user_roles

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 8  
**Foreign Keys**: 2  
**RLS Policies**: 3  
**Indexes**: 4

#### Columns

| Column                            | Type                     | Nullable | Default            |
| --------------------------------- | ------------------------ | -------- | ------------------ |
| **user_role_uuid**                | uuid                     | No       | UUID               |
| **user_id**                       | uuid                     | No       | None               |
| **assigned_by**                   | uuid                     | Yes      | None               |
| **assigned_at**                   | timestamp with time zone | No       | Current Time       |
| **assigned_by_user_account_uuid** | uuid                     | Yes      | None               |
| **user_uuid**                     | uuid                     | Yes      | None               |
| **user_role_id**                  | integer                  | No       | None               |
| **role**                          | USER-DEFINED             | Yes      | 'viewer'::app_role |


**Primary Keys**: user_role_uuid, assigned_by_user_account_uuid, user_uuid




#### Foreign Key Relationships

| Column                        | References                     | Constraint Name                        |
| ----------------------------- | ------------------------------ | -------------------------------------- |
| assigned_by_user_account_uuid | public.user_accounts.user_uuid | fk_user_roles_assigned_by_user_account |
| user_uuid                     | public.user_accounts.user_uuid | fk_user_roles_user_account             |


#### Row Level Security Policies

**Admins can view all roles**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user_v2()  
- **With Check Expression**: N/A  

**Super admins can manage all roles**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_super_admin_user()  
- **With Check Expression**: N/A  

**Users can view their own roles**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (user_id = auth.uid())  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                              | Columns                       | Unique   | Primary  | Type     |
| --------------------------------------- | ----------------------------- | -------- | -------- | -------- |
| idx_user_roles_assigned_by_user_account | assigned_by_user_account_uuid | No       | No       | btree    |
| idx_user_roles_user_account             | user_uuid                     | No       | No       | btree    |
| pk_user_roles                           | user_role_uuid                | Yes      | Yes      | btree    |
| uq_user_roles_id                        | user_role_id                  | Yes      | No       | btree    |


---

### user_session_logs

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 12  
**Foreign Keys**: 0  
**RLS Policies**: 2  
**Indexes**: 3

#### Columns

| Column                    | Type                     | Nullable | Default      |
| ------------------------- | ------------------------ | -------- | ------------ |
| **user_session_log_uuid** | uuid                     | No       | UUID         |
| **user_session_log_id**   | integer                  | No       | None         |
| **user_id**               | uuid                     | No       | None         |
| **session_token**         | text                     | No       | None         |
| **ip_address**            | inet                     | Yes      | None         |
| **user_agent**            | text                     | Yes      | None         |
| **created_at**            | timestamp with time zone | No       | Current Time |
| **expires_at**            | timestamp with time zone | No       | None         |
| **last_activity_at**      | timestamp with time zone | No       | Current Time |
| **ended_at**              | timestamp with time zone | Yes      | None         |
| **is_active**             | boolean                  | No       | true         |
| **session_metadata**      | jsonb                    | Yes      | '{}'::jsonb  |


**Primary Keys**: user_session_log_uuid



**Timestamps**: created_at




#### Row Level Security Policies

**Admins can view all session logs**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user_v2()  
- **With Check Expression**: N/A  

**Users can view their own session logs**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (auth.uid() = user_id)  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                    | Columns               | Unique   | Primary  | Type     |
| ----------------------------- | --------------------- | -------- | -------- | -------- |
| idx_user_session_logs_active  | expires_at, is_active | No       | No       | btree    |
| idx_user_session_logs_user_id | user_id               | No       | No       | btree    |
| user_session_logs_pkey        | user_session_log_uuid | Yes      | Yes      | btree    |


---


## Constraints and Validation Rules

Database constraints ensure data integrity and enforce business rules at the database level:

### CHECK Constraints

| Table                            | Constraint Name                       | Column            | Details  |
| -------------------------------- | ------------------------------------- | ----------------- | -------- |
| **coa_translation_sessions**     | 2200_35528_10_not_null                | Multiple          | statu... |
| **coa_translation_sessions**     | 2200_35528_11_not_null                | Multiple          | creat... |
| **coa_translation_sessions**     | 2200_35528_13_not_null                | Multiple          | updat... |
| **coa_translation_sessions**     | 2200_35528_19_not_null                | Multiple          | statu... |
| **coa_translation_sessions**     | 2200_35528_1_not_null                 | Multiple          | coa_t... |
| **coa_translation_sessions**     | 2200_35528_20_not_null                | Multiple          | coa_t... |
| **coa_translation_sessions**     | 2200_35528_2_not_null                 | Multiple          | sessi... |
| **coa_translation_sessions**     | 2200_35528_3_not_null                 | Multiple          | user_... |
| **coa_translation_sessions**     | 2200_35528_4_not_null                 | Multiple          | filen... |
| **coa_translation_sessions**     | 2200_35528_5_not_null                 | Multiple          | total... |
| **coa_translation_sessions**     | 2200_35528_8_not_null                 | Multiple          | targe... |
| **coa_translation_sessions**     | 2200_35528_9_not_null                 | Multiple          | sessi... |
| **coa_translation_sessions**     | coa_translation_sessions_status_check | status            | (stat... |
| **entities**                     | 2200_49146_10_not_null                | Multiple          | updat... |
| **entities**                     | 2200_49146_1_not_null                 | Multiple          | entit... |
| **entities**                     | 2200_49146_2_not_null                 | Multiple          | entit... |
| **entities**                     | 2200_49146_3_not_null                 | Multiple          | entit... |
| **entities**                     | 2200_49146_4_not_null                 | Multiple          | entit... |
| **entities**                     | 2200_49146_5_not_null                 | Multiple          | entit... |
| **entities**                     | 2200_49146_6_not_null                 | Multiple          | entit... |
| **entities**                     | 2200_49146_8_not_null                 | Multiple          | is_ac... |
| **entities**                     | 2200_49146_9_not_null                 | Multiple          | creat... |
| **entity_groups**                | 2200_49125_1_not_null                 | Multiple          | entit... |
| **entity_groups**                | 2200_49125_2_not_null                 | Multiple          | entit... |
| **entity_groups**                | 2200_49125_3_not_null                 | Multiple          | entit... |
| **entity_groups**                | 2200_49125_4_not_null                 | Multiple          | entit... |
| **entity_groups**                | 2200_49125_6_not_null                 | Multiple          | is_ac... |
| **entity_groups**                | 2200_49125_7_not_null                 | Multiple          | creat... |
| **entity_groups**                | 2200_49125_8_not_null                 | Multiple          | updat... |
| **report_line_items**            | 2200_28522_11_not_null                | Multiple          | sort_... |
| **report_line_items**            | 2200_28522_1_not_null                 | Multiple          | repor... |
| **report_line_items**            | 2200_28522_2_not_null                 | Multiple          | repor... |
| **report_line_items**            | 2200_28522_4_not_null                 | Multiple          | repor... |
| **report_line_items**            | 2200_28522_5_not_null                 | Multiple          | repor... |
| **report_line_items**            | 2200_28522_6_not_null                 | Multiple          | repor... |
| **report_line_items**            | 2200_28522_7_not_null                 | Multiple          | repor... |
| **report_structure_change_logs** | 2200_27322_11_not_null                | Multiple          | actio... |
| **report_structure_change_logs** | 2200_27322_12_not_null                | Multiple          | line_... |
| **report_structure_change_logs** | 2200_27322_16_not_null                | Multiple          | times... |
| **report_structure_change_logs** | 2200_27322_17_not_null                | Multiple          | is_un... |
| **report_structure_change_logs** | 2200_27322_1_not_null                 | Multiple          | chang... |
| **report_structure_change_logs** | 2200_27322_2_not_null                 | Multiple          | chang... |
| **report_structure_change_logs** | 2200_27322_3_not_null                 | Multiple          | user_... |
| **report_structure_change_logs** | 2200_27322_7_not_null                 | Multiple          | struc... |
| **report_structure_change_logs** | 2200_27322_8_not_null                 | Multiple          | struc... |
| **report_structures**            | 2200_28507_18_not_null                | Multiple          | lifec... |
| **report_structures**            | 2200_28507_1_not_null                 | Multiple          | repor... |
| **report_structures**            | 2200_28507_2_not_null                 | Multiple          | repor... |
| **report_structures**            | 2200_28507_3_not_null                 | Multiple          | repor... |
| **report_structures**            | 2200_28507_4_not_null                 | Multiple          | is_ac... |
| **report_structures**            | 2200_28507_5_not_null                 | Multiple          | creat... |
| **report_structures**            | 2200_28507_6_not_null                 | Multiple          | updat... |
| **report_structures**            | 2200_28507_7_not_null                 | Multiple          | creat... |
| **report_structures**            | 2200_28507_8_not_null                 | Multiple          | creat... |
| **report_structures**            | 2200_28507_9_not_null                 | Multiple          | versi... |
| **security_audit_logs**          | 2200_41112_11_not_null                | Multiple          | secur... |
| **security_audit_logs**          | 2200_41112_1_not_null                 | Multiple          | secur... |
| **security_audit_logs**          | 2200_41112_3_not_null                 | Multiple          | actio... |
| **security_audit_logs**          | 2200_41112_8_not_null                 | Multiple          | creat... |
| **security_rate_limits**         | 2200_52774_10_not_null                | Multiple          | creat... |
| **security_rate_limits**         | 2200_52774_11_not_null                | Multiple          | updat... |
| **security_rate_limits**         | 2200_52774_1_not_null                 | Multiple          | secur... |
| **security_rate_limits**         | 2200_52774_2_not_null                 | Multiple          | secur... |
| **security_rate_limits**         | 2200_52774_3_not_null                 | Multiple          | opera... |
| **security_rate_limits**         | 2200_52774_4_not_null                 | Multiple          | ident... |
| **security_rate_limits**         | 2200_52774_5_not_null                 | Multiple          | attem... |
| **security_rate_limits**         | 2200_52774_6_not_null                 | Multiple          | windo... |
| **security_rate_limits**         | 2200_52774_7_not_null                 | Multiple          | last_... |
| **security_rate_limits**         | 2200_52774_8_not_null                 | Multiple          | is_bl... |
| **user_accounts**                | 2200_35478_19_not_null                | Multiple          | user_... |
| **user_accounts**                | 2200_35478_1_not_null                 | Multiple          | user_... |
| **user_accounts**                | 2200_35478_2_not_null                 | Multiple          | user_... |
| **user_accounts**                | 2200_35478_3_not_null                 | Multiple          | supab... |
| **user_accounts**                | 2200_35478_4_not_null                 | Multiple          | email... |
| **user_accounts**                | 2200_35478_8_not_null                 | Multiple          | creat... |
| **user_entity_access**           | 2200_49178_11_not_null                | Multiple          | grant... |
| **user_entity_access**           | 2200_49178_13_not_null                | Multiple          | is_ac... |
| **user_entity_access**           | 2200_49178_1_not_null                 | Multiple          | user_... |
| **user_entity_access**           | 2200_49178_2_not_null                 | Multiple          | user_... |
| **user_entity_access**           | 2200_49178_3_not_null                 | Multiple          | user_... |
| **user_entity_access**           | 2200_49178_4_not_null                 | Multiple          | user_... |
| **user_entity_access**           | 2200_49178_9_not_null                 | Multiple          | acces... |
| **user_entity_access**           | chk_entity_or_group                   | entity_uuid       | (((en... |
| **user_entity_access**           | chk_entity_or_group                   | entity_group_uuid | (((en... |
| **user_roles**                   | 2200_41085_1_not_null                 | Multiple          | user_... |
| **user_roles**                   | 2200_41085_2_not_null                 | Multiple          | user_... |
| **user_roles**                   | 2200_41085_5_not_null                 | Multiple          | assig... |
| **user_roles**                   | 2200_41085_8_not_null                 | Multiple          | user_... |
| **user_session_logs**            | 2200_52761_11_not_null                | Multiple          | is_ac... |
| **user_session_logs**            | 2200_52761_1_not_null                 | Multiple          | user_... |
| **user_session_logs**            | 2200_52761_2_not_null                 | Multiple          | user_... |
| **user_session_logs**            | 2200_52761_3_not_null                 | Multiple          | user_... |
| **user_session_logs**            | 2200_52761_4_not_null                 | Multiple          | sessi... |
| **user_session_logs**            | 2200_52761_7_not_null                 | Multiple          | creat... |
| **user_session_logs**            | 2200_52761_8_not_null                 | Multiple          | expir... |
| **user_session_logs**            | 2200_52761_9_not_null                 | Multiple          | last_... |

**Count**: 96 constraints of this type

### FOREIGN KEY Constraints

| Table                        | Constraint Name                               | Column                        | Details  |
| ---------------------------- | --------------------------------------------- | ----------------------------- | -------- |
| **coa_translation_sessions** | coa_translation_sessions_user_id_fkey         | user_id                       | Refer... |
| **coa_translation_sessions** | fk_coa_translation_sessions_entity            | entity_uuid                   | Refer... |
| **coa_translation_sessions** | fk_coa_translation_sessions_user_account      | user_uuid                     | Refer... |
| **entities**                 | fk_entities_created_by                        | created_by_user_uuid          | Refer... |
| **entities**                 | fk_entities_entity_group                      | entity_group_uuid             | Refer... |
| **entity_groups**            | fk_entity_groups_created_by                   | created_by_user_uuid          | Refer... |
| **report_line_items**        | fk_report_line_items_created_by_user_account  | created_by_user_uuid          | Refer... |
| **report_line_items**        | fk_report_line_items_entity                   | entity_uuid                   | Refer... |
| **report_line_items**        | fk_report_line_items_updated_by_user_account  | updated_by_user_uuid          | Refer... |
| **report_line_items**        | report_line_items_created_by_fkey             | created_by                    | Refer... |
| **report_line_items**        | report_line_items_report_structure_id_fkey    | report_structure_id           | Refer... |
| **report_line_items**        | report_line_items_report_structure_uuid_fkey  | report_structure_uuid         | Refer... |
| **report_line_items**        | report_line_items_updated_by_fkey             | updated_by                    | Refer... |
| **report_structures**        | fk_report_structures_archived_by_user_account | archived_by_user_uuid         | Refer... |
| **report_structures**        | fk_report_structures_entity                   | entity_uuid                   | Refer... |
| **report_structures**        | report_structures_archived_by_fkey            | archived_by                   | Refer... |
| **security_audit_logs**      | fk_security_audit_logs_entity                 | entity_uuid                   | Refer... |
| **security_audit_logs**      | fk_security_audit_logs_target_user_account    | target_user_uuid              | Refer... |
| **security_audit_logs**      | fk_security_audit_logs_user_account           | user_uuid                     | Refer... |
| **security_audit_logs**      | security_audit_log_user_id_fkey               | user_id                       | Refer... |
| **user_entity_access**       | fk_user_entity_access_entity                  | entity_uuid                   | Refer... |
| **user_entity_access**       | fk_user_entity_access_entity_group            | entity_group_uuid             | Refer... |
| **user_entity_access**       | fk_user_entity_access_granted_by              | granted_by_user_uuid          | Refer... |
| **user_entity_access**       | fk_user_entity_access_user                    | user_uuid                     | Refer... |
| **user_roles**               | fk_user_roles_assigned_by_user_account        | assigned_by_user_account_uuid | Refer... |
| **user_roles**               | fk_user_roles_user_account                    | user_uuid                     | Refer... |
| **user_roles**               | user_roles_assigned_by_fkey                   | assigned_by                   | Refer... |
| **user_roles**               | user_roles_user_id_fkey                       | user_id                       | Refer... |

**Count**: 28 constraints of this type

### PRIMARY KEY Constraints

| Table                            | Constraint Name                 | Column                       | Details  |
| -------------------------------- | ------------------------------- | ---------------------------- | -------- |
| **coa_translation_sessions**     | pk_coa_translation_sessions     | coa_translation_session_uuid | prima... |
| **entities**                     | pk_entities                     | entity_uuid                  | prima... |
| **entity_groups**                | pk_entity_groups                | entity_group_uuid            | prima... |
| **report_line_items**            | pk_report_line_items            | report_line_item_uuid        | prima... |
| **report_structure_change_logs** | pk_report_structure_change_logs | change_uuid                  | prima... |
| **report_structures**            | pk_report_structures            | report_structure_uuid        | prima... |
| **security_audit_logs**          | pk_security_audit_logs          | security_audit_log_uuid      | prima... |
| **security_rate_limits**         | security_rate_limits_pkey       | security_rate_limit_uuid     | prima... |
| **user_accounts**                | pk_user_accounts                | user_uuid                    | prima... |
| **user_entity_access**           | pk_user_entity_access           | user_entity_access_uuid      | prima... |
| **user_roles**                   | pk_user_roles                   | user_role_uuid               | prima... |
| **user_session_logs**            | user_session_logs_pkey          | user_session_log_uuid        | prima... |

**Count**: 12 constraints of this type

### UNIQUE Constraints

| Table                            | Constraint Name                           | Column                     | Details  |
| -------------------------------- | ----------------------------------------- | -------------------------- | -------- |
| **coa_translation_sessions**     | uq_coa_translation_sessions_id            | coa_translation_session_id | uniqu... |
| **coa_translation_sessions**     | uq_coa_translation_sessions_session_id    | session_id                 | uniqu... |
| **entities**                     | uq_entities_code                          | entity_code                | uniqu... |
| **entities**                     | uq_entities_id                            | entity_id                  | uniqu... |
| **entity_groups**                | uq_entity_groups_code                     | entity_group_code          | uniqu... |
| **entity_groups**                | uq_entity_groups_id                       | entity_group_id            | uniqu... |
| **report_line_items**            | uq_report_line_items_id                   | report_line_item_id        | uniqu... |
| **report_line_items**            | uq_report_line_items_structure_sort_order | report_structure_uuid      | uniqu... |
| **report_line_items**            | uq_report_line_items_structure_sort_order | report_structure_uuid      | uniqu... |
| **report_line_items**            | uq_report_line_items_structure_sort_order | sort_order                 | uniqu... |
| **report_line_items**            | uq_report_line_items_structure_sort_order | sort_order                 | uniqu... |
| **report_structure_change_logs** | uq_report_structure_change_logs_change_id | change_id                  | uniqu... |
| **report_structures**            | uq_report_structures_id                   | report_structure_id        | uniqu... |
| **security_audit_logs**          | uq_security_audit_logs_id                 | security_audit_log_id      | uniqu... |
| **user_accounts**                | uq_user_accounts_email                    | email                      | uniqu... |
| **user_accounts**                | uq_user_accounts_id                       | user_id                    | uniqu... |
| **user_accounts**                | uq_user_accounts_supabase_user_uuid       | supabase_user_uuid         | uniqu... |
| **user_entity_access**           | uq_user_entity_access_id                  | user_entity_access_id      | uniqu... |
| **user_roles**                   | uq_user_roles_id                          | user_role_id               | uniqu... |

**Count**: 19 constraints of this type

### Constraint Summary
- **Primary Key**: Ensures unique identification of records
- **Foreign Key**: Maintains referential integrity between tables  
- **Unique**: Prevents duplicate values in specified columns
- **Check**: Enforces custom validation rules and business logic

---

## Enums and Custom Types

### access_level

**Values**: viewer, entity_admin


### app_role

**Values**: super_admin, entity_admin, viewer


### change_action_type

**Values**: create, delete, rename, move


### report_structure_lifecycle_status

**Values**: draft, active, inactive, archived, deprecated


### translation_session_status

**Values**: pending, processing, completed, failed, cancelled, paused


### user_account_status

**Values**: pending, approved, rejected, suspended, archived



---

## Foreign Key Relationships Graph (Text-Based)

This section provides a text-based mapping of all foreign key relationships in the database:

- **coa_translation_sessions.entity_uuid** → **entities.entity_uuid**
- **coa_translation_sessions.user_uuid** → **user_accounts.user_uuid**
- **entities.created_by_user_uuid** → **user_accounts.user_uuid**
- **entities.entity_group_uuid** → **entity_groups.entity_group_uuid**
- **entity_groups.created_by_user_uuid** → **user_accounts.user_uuid**
- **report_line_items.created_by_user_uuid** → **user_accounts.user_uuid**
- **report_line_items.entity_uuid** → **entities.entity_uuid**
- **report_line_items.report_structure_id** → **report_structures.report_structure_id**
- **report_line_items.report_structure_uuid** → **report_structures.report_structure_uuid**
- **report_line_items.updated_by_user_uuid** → **user_accounts.user_uuid**
- **report_structures.archived_by_user_uuid** → **user_accounts.user_uuid**
- **report_structures.entity_uuid** → **entities.entity_uuid**
- **security_audit_logs.entity_uuid** → **entities.entity_uuid**
- **security_audit_logs.target_user_uuid** → **user_accounts.user_uuid**
- **security_audit_logs.user_uuid** → **user_accounts.user_uuid**
- **user_entity_access.entity_group_uuid** → **entity_groups.entity_group_uuid**
- **user_entity_access.entity_uuid** → **entities.entity_uuid**
- **user_entity_access.granted_by_user_uuid** → **user_accounts.user_uuid**
- **user_entity_access.user_uuid** → **user_accounts.user_uuid**
- **user_roles.assigned_by_user_account_uuid** → **user_accounts.user_uuid**
- **user_roles.user_uuid** → **user_accounts.user_uuid**

---

## Database Functions

The database includes 61 custom functions for business logic, security, and data validation:

| Function Name                                  | Schema   | Return Type           | Arguments                                          | Type     |
| ---------------------------------------------- | -------- | --------------------- | -------------------------------------------------- | -------- |
| **audit_user_account_changes**                 | public   | trigger               | None                                               | function |
| **bulk_update_user_status**                    | public   | jsonb                 | p_user_uuids uuid[], p_new_status user_account_... | function |
| **check_permission_conflicts**                 | public   | record                | p_user_uuid uuid                                   | function |
| **check_rate_limit**                           | public   | boolean               | operation_type text, identifier text, max_attem... | function |
| **cleanup_old_documentation_files**            | public   | integer               | p_keep_count integer DEFAULT 10                    | function |
| **convert_line_items_to_concatenated_format**  | public   | jsonb                 | p_structure_id integer                             | function |
| **detect_suspicious_activity**                 | public   | boolean               | p_user_id uuid, p_time_window_minutes integer D... | function |
| **enforce_node_limit**                         | public   | trigger               | None                                               | function |
| **enhanced_check_rate_limit**                  | public   | boolean               | p_operation_type text, p_identifier text, p_max... | function |
| **enhanced_log_security_event**                | public   | uuid                  | p_action text, p_target_user_id uuid DEFAULT NU... | function |
| **ensure_single_active_structure**             | public   | trigger               | None                                               | function |
| **extract_structure_id_from_line_item_id**     | public   | integer               | p_line_item_id integer                             | function |
| **get_column_info**                            | public   | record                | None                                               | function |
| **get_current_user_details**                   | public   | record                | None                                               | function |
| **get_database_functions**                     | public   | record                | None                                               | function |
| **get_enhanced_user_management_summary**       | public   | record                | None                                               | function |
| **get_enhanced_user_summary**                  | public   | record                | None                                               | function |
| **get_enum_values**                            | public   | record                | None                                               | function |
| **get_foreign_keys**                           | public   | record                | None                                               | function |
| **get_indexes**                                | public   | record                | None                                               | function |
| **get_next_concatenated_line_item_id**         | public   | integer               | p_structure_id integer                             | function |
| **get_report_structure_with_creator**          | public   | record                | p_structure_uuid uuid                              | function |
| **get_report_structures_by_lifecycle_status**  | public   | record                | p_status report_structure_lifecycle_status         | function |
| **get_rls_policies**                           | public   | record                | None                                               | function |
| **get_table_constraints**                      | public   | record                | None                                               | function |
| **get_table_info**                             | public   | record                | None                                               | function |
| **get_translation_sessions_by_status**         | public   | record                | p_status translation_session_status                | function |
| **get_user_accessible_entities**               | public   | record                | p_user_uuid uuid                                   | function |
| **get_user_account_by_supabase_uuid**          | public   | record                | p_supabase_uuid uuid                               | function |
| **get_user_effective_permissions**             | public   | record                | p_user_uuid uuid                                   | function |
| **get_user_summary**                           | public   | record                | None                                               | function |
| **get_user_with_roles**                        | public   | record                | p_supabase_user_uuid uuid                          | function |
| **get_users_by_status**                        | public   | record                | p_status user_account_status                       | function |
| **get_valid_user_account_status_transitions**  | public   | user_account_status[] | p_current_status user_account_status               | function |
| **grant_entity_access**                        | public   | boolean               | p_user_uuid uuid, p_entity_uuid uuid, p_access_... | function |
| **grant_entity_access**                        | public   | boolean               | p_user_uuid uuid, p_access_level access_level, ... | function |
| **grant_entity_group_access**                  | public   | boolean               | p_user_uuid uuid, p_entity_group_uuid uuid, p_a... | function |
| **handle_new_user**                            | public   | trigger               | None                                               | function |
| **handle_new_user_role**                       | public   | trigger               | None                                               | function |
| **has_role**                                   | public   | boolean               | _user_id uuid, _role app_role                      | function |
| **invite_user_with_role**                      | public   | jsonb                 | p_email text, p_first_name text DEFAULT NULL::t... | function |
| **is_admin_user**                              | public   | boolean               | None                                               | function |
| **is_admin_user_v2**                           | public   | boolean               | None                                               | function |
| **is_entity_admin_for_scope**                  | public   | boolean               | p_user_uuid uuid, p_entity_uuid uuid DEFAULT NU... | function |
| **is_super_admin_user**                        | public   | boolean               | None                                               | function |
| **is_valid_report_structure_lifecycle_trans... | public   | boolean               | p_from_status report_structure_lifecycle_status... | function |
| **is_valid_translation_session_status_trans... | public   | boolean               | p_from_status translation_session_status, p_to_... | function |
| **is_valid_user_account_status_transition**    | public   | boolean               | p_from_status user_account_status, p_to_status ... | function |
| **log_failed_auth_attempt**                    | public   | void                  | p_email text, p_ip_address inet DEFAULT NULL::i... | function |
| **log_security_event**                         | public   | uuid                  | p_action text, p_target_user_id uuid DEFAULT NU... | function |
| **log_structure_change**                       | public   | uuid                  | p_structure_uuid uuid, p_structure_id integer, ... | function |
| **reorder_line_item_with_hierarchy**           | public   | jsonb                 | p_structure_uuid uuid, p_moved_item_uuid uuid, ... | function |
| **revoke_all_user_access**                     | public   | jsonb                 | p_user_uuid uuid, p_reason text DEFAULT 'Accoun... | function |
| **set_updated_at**                             | public   | trigger               | None                                               | function |
| **transition_user_account_status**             | public   | boolean               | p_user_uuid uuid, p_new_status user_account_sta... | function |
| **update_sort_orders_transaction**             | public   | jsonb                 | p_structure_uuid uuid, p_updates jsonb             | function |
| **update_updated_at_column**                   | public   | trigger               | None                                               | function |
| **user_has_entity_access**                     | public   | boolean               | p_user_uuid uuid, p_entity_uuid uuid               | function |
| **validate_report_structure_lifecycle_trans... | public   | trigger               | None                                               | function |
| **validate_translation_session_status_trans... | public   | trigger               | None                                               | function |
| **validate_user_account_status_transition**    | public   | trigger               | None                                               | function |

---

## Security Policies Summary

This database implements Row Level Security (RLS) across 12 tables to ensure data isolation and proper access control.

### Tables with RLS Enabled

- **coa_translation_sessions**: 5 policies
- **entities**: 3 policies
- **entity_groups**: 2 policies
- **report_line_items**: 5 policies
- **report_structure_change_logs**: 3 policies
- **report_structures**: 5 policies
- **security_audit_logs**: 1 policies
- **security_rate_limits**: 1 policies
- **user_accounts**: 7 policies
- **user_entity_access**: 6 policies
- **user_roles**: 3 policies
- **user_session_logs**: 2 policies

### Key Security Features
- **Row Level Security**: Enabled on 12 tables
- **Role-based Access Control**: Different access levels (viewer, entity_admin, super_admin)
- **Audit Logging**: All sensitive operations are logged to security_audit_logs
- **Rate Limiting**: Protection against excessive API calls

---

## Indexes and Performance

The database includes 69 indexes for performance optimization:

### Index Summary by Type

| Index Type | Count    |
| ---------- | -------- |
| **btree**  | 69       |

---

## Usage Examples

This section provides practical examples of how to interact with the database structure:

### Common Query Patterns

#### User and Role Management
```sql
-- Get user with roles and entity access
SELECT 
  ua.email,
  ua.first_name,
  ua.last_name,
  ur.role,
  uea.access_level,
  e.entity_name
FROM user_accounts ua
JOIN user_roles ur ON ua.supabase_user_uuid = ur.user_id
LEFT JOIN user_entity_access uea ON ua.user_uuid = uea.user_uuid
LEFT JOIN entities e ON uea.entity_uuid = e.entity_uuid
WHERE ua.user_status = 'approved'
  AND uea.is_active = true;
```

#### Security Audit Queries
```sql
-- Recent security events for monitoring
SELECT 
  action,
  user_id,
  details,
  created_at
FROM security_audit_logs
WHERE created_at >= now() - interval '24 hours'
ORDER BY created_at DESC;
```

#### Report Structure Access
```sql
-- Get active report structure with line items
SELECT 
  rs.report_structure_name,
  rli.report_line_item_key,
  rli.report_line_item_description,
  rli.sort_order,
  rli.is_leaf
FROM report_structures rs
JOIN report_line_items rli ON rs.report_structure_uuid = rli.report_structure_uuid
WHERE rs.is_active = true
ORDER BY rli.sort_order;
```

### Application Integration Examples

#### Supabase Client Usage (TypeScript)
```typescript
import { supabase } from '@/integrations/supabase/client';

// Fetch user profile with roles
async function getUserProfile(userId: string) {
  const { data, error } = await supabase
    .from('user_accounts')
    .select(`
      *,
      user_roles(*),
      user_entity_access(
        access_level,
        entities(entity_name, entity_code)
      )
    `)
    .eq('supabase_user_uuid', userId)
    .single();
    
  return { data, error };
}

// Create security audit log
async function logSecurityEvent(action: string, details: any) {
  const { data, error } = await supabase
    .from('security_audit_logs')
    .insert({
      action,
      details,
      // user_id automatically set by RLS policy
    });
    
  return { data, error };
}
```

#### RLS Policy Usage Examples
```sql
-- Example of how RLS policies work in practice:

-- This query automatically filters by user's accessible entities
SELECT * FROM report_structures; 
-- RLS policy ensures user only sees structures they have access to

-- This insert automatically sets user_id from auth context
INSERT INTO security_audit_logs (action, details) 
VALUES ('user_login', '{"ip": "192.168.1.1"}');
-- RLS policy ensures user_id = auth.uid()
```

### Data Validation Examples

#### Using Database Functions
```sql
-- Check if user has admin privileges
SELECT is_admin_user_v2();

-- Get user's accessible entities  
SELECT * FROM get_user_accessible_entities('user-uuid-here');

-- Clean up old documentation files
SELECT cleanup_old_documentation_files(5); -- Keep 5 most recent
```

#### Working with Constraints
```sql
-- Primary key constraints ensure uniqueness
INSERT INTO entities (entity_name, entity_code) 
VALUES ('New Entity', 'NEW_ENTITY');
-- Will succeed if entity_code is unique

-- Foreign key constraints maintain referential integrity
INSERT INTO user_entity_access (user_uuid, entity_uuid, access_level)
VALUES ('valid-user-uuid', 'valid-entity-uuid', 'viewer');
-- Will fail if either UUID doesn't exist in parent tables

-- Check constraints enforce business rules
-- (Examples depend on specific CHECK constraints in your schema)
```

### Performance Optimization Tips

#### Using Indexes Effectively
```sql
-- Leverage indexes for faster queries:

-- Use indexed columns in WHERE clauses
SELECT * FROM security_audit_logs 
WHERE created_at >= '2024-01-01'  -- Uses timestamp index
  AND action = 'login_success';    -- Uses action index if exists

-- Sort by indexed columns for better performance
SELECT * FROM report_line_items 
WHERE report_structure_uuid = 'structure-uuid'
ORDER BY sort_order;  -- Uses sort_order index
```

#### Efficient Pagination
```typescript
// Efficient pagination using created_at cursor
const { data } = await supabase
  .from('security_audit_logs')
  .select('*')
  .order('created_at', { ascending: false })
  .limit(50);
  
// For next page, use last record's created_at as cursor
const { data: nextPage } = await supabase
  .from('security_audit_logs')
  .select('*')
  .lt('created_at', lastRecord.created_at)
  .order('created_at', { ascending: false })
  .limit(50);
```

### Error Handling Best Practices

#### Common Error Scenarios
```typescript
try {
  const { data, error } = await supabase
    .from('user_accounts')
    .insert({ email: 'user@example.com' });
    
  if (error) {
    if (error.code === '23505') { // Unique violation
      console.log('Email already exists');
    } else if (error.code === '42501') { // RLS violation
      console.log('Access denied by security policy');
    } else {
      console.log('Unexpected error:', error.message);
    }
  }
} catch (err) {
  console.error('Network or other error:', err);
}
```

---

## Conventions Used

This database follows these naming and structural conventions:

- **snake_case**: All table and column names use snake_case
- **Timestamps**: All tables include created_at and updated_at fields where applicable
- **UUIDs**: Primary keys use UUID format with gen_random_uuid() default
- **Soft Delete**: Some tables support soft delete with is_active flags
- **Audit Trail**: Important operations are logged with user attribution
- **Foreign Keys**: Proper referential integrity with named constraints
- **RLS Policies**: Comprehensive row-level security implementation

---

## Changelog

- **8/28/2025**: v07 - Initial database structure documentation generated by Thomas Schenkelberg
  - Generated comprehensive schema documentation
  - Included 12 tables, 192 columns
  - Documented 21 foreign key relationships
  - Cataloged 43 RLS policies
  - Listed 61 database functions
  - Indexed 69 performance indexes

---

*This documentation was automatically generated from the live database schema. For the most current information, regenerate this documentation from the System Administration panel.*
