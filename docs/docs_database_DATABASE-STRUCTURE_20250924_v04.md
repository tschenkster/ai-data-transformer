# Database Structure Documentation

**Generated**: 9/24/2025, 6:16:46 AM  
**Version**: v04  
**Generated By**: Thomas Schenkelberg  
**Filename**: DATABASE-STRUCTURE_20250924_v04.md

---

## Table of Contents

- [Overview](#overview)
  - [Summary Statistics](#summary-statistics)
- [Schemas Overview](#schemas-overview)
- [Tables Overview](#tables-overview)
- [Table Structures](#table-structures)
  - [auth Schema Tables](#auth-schema-tables)
    - [audit_log_entries](#audit-log-entries)
    - [flow_state](#flow-state)
    - [identities](#identities)
    - [instances](#instances)
    - [mfa_amr_claims](#mfa-amr-claims)
    - [mfa_challenges](#mfa-challenges)
    - [mfa_factors](#mfa-factors)
    - [oauth_clients](#oauth-clients)
    - [one_time_tokens](#one-time-tokens)
    - [refresh_tokens](#refresh-tokens)
    - [saml_providers](#saml-providers)
    - [saml_relay_states](#saml-relay-states)
    - [schema_migrations](#schema-migrations)
    - [sessions](#sessions)
    - [sso_domains](#sso-domains)
    - [sso_providers](#sso-providers)
    - [users](#users)
  - [data Schema Tables](#data-schema-tables)
    - [trial_balance_uploads](#trial-balance-uploads)
  - [extensions Schema Tables](#extensions-schema-tables)
    - [pg_stat_statements](#pg-stat-statements)
    - [pg_stat_statements_info](#pg-stat-statements-info)
  - [public Schema Tables](#public-schema-tables)
    - [coa_translation_sessions](#coa-translation-sessions)
    - [entities](#entities)
    - [entity_groups](#entity-groups)
    - [report_line_items](#report-line-items)
    - [report_line_items_translations](#report-line-items-translations)
    - [report_structure_change_logs](#report-structure-change-logs)
    - [report_structures](#report-structures)
    - [report_structures_translations](#report-structures-translations)
    - [security_audit_logs](#security-audit-logs)
    - [security_rate_limits](#security-rate-limits)
    - [system_languages](#system-languages)
    - [ui_translations](#ui-translations)
    - [user_accounts](#user-accounts)
    - [user_entity_access](#user-entity-access)
    - [user_roles](#user-roles)
    - [user_session_logs](#user-session-logs)
  - [realtime Schema Tables](#realtime-schema-tables)
    - [messages](#messages)
    - [schema_migrations](#schema-migrations)
    - [subscription](#subscription)
  - [storage Schema Tables](#storage-schema-tables)
    - [buckets](#buckets)
    - [buckets_analytics](#buckets-analytics)
    - [migrations](#migrations)
    - [objects](#objects)
    - [prefixes](#prefixes)
    - [s3_multipart_uploads](#s3-multipart-uploads)
    - [s3_multipart_uploads_parts](#s3-multipart-uploads-parts)
  - [supabase_migrations Schema Tables](#supabase-migrations-schema-tables)
    - [schema_migrations](#schema-migrations)
  - [vault Schema Tables](#vault-schema-tables)
    - [decrypted_secrets](#decrypted-secrets)
    - [secrets](#secrets)
- [Constraints and Validation Rules](#constraints-and-validation-rules)
- [Enums and Custom Types](#enums-and-custom-types)
- [Foreign Key Relationships Graph](#foreign-key-relationships-graph-text-based)
- [Database Functions](#database-functions)
- [Security Policies Summary](#security-policies-summary)
- [Indexes and Performance](#indexes-and-performance)
- [Usage Examples](#usage-examples)
- [Conventions Used](#conventions-used)
- [Changelog](#changelog)

---

## Overview

This document provides a comprehensive overview of the database structure for the current system.

### Summary Statistics
- **Total Schemas**: 0
- **Total Tables**: 49
- **Total Columns**: 568
- **Total Enums**: 13
- **Total Foreign Keys**: 32
- **Total RLS Policies**: 81
- **Total Database Functions**: 195
- **Total Indexes**: 179
- **Total Constraints**: 546

---

## Schemas Overview

No schemas found.

This database contains multiple schemas, each serving different purposes:
- **auth**: Authentication and user management (Supabase managed)
- **extensions**: Database extensions and additional functionality  
- **public**: Main application data and business logic
- **storage**: File storage management (Supabase managed)
- **graphql**: GraphQL API schema definitions
- **realtime**: Real-time subscriptions and messaging
- **data**: Custom data processing and analytics (if present)

---

## Tables Overview

| Schema              | Table Name                         | Type       | Columns  | Foreign Keys | RLS Policies | Indexes  |
| ------------------- | ---------------------------------- | ---------- | -------- | ------------ | ------------ | -------- |
| auth                | **audit_log_entries**              | BASE TABLE | 5        | 0            | 0            | 2        |
| auth                | **flow_state**                     | BASE TABLE | 12       | 0            | 0            | 4        |
| auth                | **identities**                     | BASE TABLE | 9        | 0            | 0            | 4        |
| auth                | **instances**                      | BASE TABLE | 5        | 0            | 0            | 1        |
| auth                | **mfa_amr_claims**                 | BASE TABLE | 5        | 0            | 0            | 2        |
| auth                | **mfa_challenges**                 | BASE TABLE | 7        | 0            | 0            | 2        |
| auth                | **mfa_factors**                    | BASE TABLE | 12       | 0            | 0            | 6        |
| auth                | **oauth_clients**                  | BASE TABLE | 12       | 0            | 0            | 4        |
| auth                | **one_time_tokens**                | BASE TABLE | 7        | 0            | 0            | 4        |
| auth                | **refresh_tokens**                 | BASE TABLE | 9        | 0            | 0            | 7        |
| auth                | **saml_providers**                 | BASE TABLE | 9        | 0            | 0            | 3        |
| auth                | **saml_relay_states**              | BASE TABLE | 8        | 0            | 0            | 4        |
| auth                | **schema_migrations**              | BASE TABLE | 8        | 0            | 0            | 4        |
| auth                | **sessions**                       | BASE TABLE | 11       | 0            | 0            | 4        |
| auth                | **sso_domains**                    | BASE TABLE | 5        | 0            | 0            | 2        |
| auth                | **sso_providers**                  | BASE TABLE | 5        | 0            | 0            | 2        |
| auth                | **users**                          | BASE TABLE | 35       | 0            | 0            | 11       |
| data                | **trial_balance_uploads**          | BASE TABLE | 22       | 0            | 4            | 2        |
| extensions          | **pg_stat_statements**             | VIEW       | 49       | 0            | 0            | 0        |
| extensions          | **pg_stat_statements_info**        | VIEW       | 2        | 0            | 0            | 0        |
| public              | **coa_translation_sessions**       | BASE TABLE | 22       | 2            | 5            | 9        |
| public              | **entities**                       | BASE TABLE | 11       | 2            | 3            | 3        |
| public              | **entity_groups**                  | BASE TABLE | 9        | 1            | 2            | 3        |
| public              | **report_line_items**              | BASE TABLE | 37       | 6            | 5            | 12       |
| public              | **report_line_items_translations** | BASE TABLE | 13       | 3            | 2            | 7        |
| public              | **report_structure_change_logs**   | BASE TABLE | 19       | 0            | 3            | 6        |
| public              | **report_structures**              | BASE TABLE | 22       | 3            | 5            | 8        |
| public              | **report_structures_translations** | BASE TABLE | 13       | 3            | 2            | 7        |
| public              | **security_audit_logs**            | BASE TABLE | 13       | 3            | 4            | 6        |
| public              | **security_rate_limits**           | BASE TABLE | 11       | 0            | 1            | 2        |
| public              | **system_languages**               | BASE TABLE | 6        | 0            | 2            | 2        |
| public              | **ui_translations**                | BASE TABLE | 13       | 2            | 2            | 4        |
| public              | **user_accounts**                  | BASE TABLE | 20       | 1            | 6            | 6        |
| public              | **user_entity_access**             | BASE TABLE | 13       | 4            | 6            | 7        |
| public              | **user_roles**                     | BASE TABLE | 8        | 2            | 3            | 4        |
| public              | **user_session_logs**              | BASE TABLE | 12       | 0            | 4            | 3        |
| realtime            | **messages**                       | BASE TABLE | 8        | 0            | 0            | 0        |
| realtime            | **schema_migrations**              | BASE TABLE | 8        | 0            | 0            | 4        |
| realtime            | **subscription**                   | BASE TABLE | 7        | 0            | 0            | 3        |
| storage             | **buckets**                        | BASE TABLE | 11       | 0            | 0            | 2        |
| storage             | **buckets_analytics**              | BASE TABLE | 5        | 0            | 0            | 1        |
| storage             | **migrations**                     | BASE TABLE | 4        | 0            | 0            | 2        |
| storage             | **objects**                        | BASE TABLE | 13       | 0            | 22           | 7        |
| storage             | **prefixes**                       | BASE TABLE | 5        | 0            | 0            | 2        |
| storage             | **s3_multipart_uploads**           | BASE TABLE | 9        | 0            | 0            | 2        |
| storage             | **s3_multipart_uploads_parts**     | BASE TABLE | 10       | 0            | 0            | 1        |
| supabase_migrations | **schema_migrations**              | BASE TABLE | 8        | 0            | 0            | 4        |
| vault               | **decrypted_secrets**              | VIEW       | 9        | 0            | 0            | 0        |
| vault               | **secrets**                        | BASE TABLE | 8        | 0            | 0            | 2        |
      table.table_type,
      String(table.column_count),
      String(table.fk_count),
      String(table.policy_count),
      String(table.index_count)
    ];
    
    return createFixedWidthRow(values, widths);
  });
  
  return [headerRow, separatorRow, ...dataRows].join('
');
})() : 'No tables found.'}

This overview provides a quick summary of all database tables with their key characteristics. Tables with RLS policies have security controls enabled, while foreign keys indicate relationships between tables.

---

## Table Structures

### audit_log_entries

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 5  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 2

#### Columns

| Column          | Type                     | Nullable | Default              |
| --------------- | ------------------------ | -------- | -------------------- |
| **instance_id** | uuid                     | Yes      | None                 |
| **id**          | uuid                     | No       | None                 |
| **payload**     | json                     | Yes      | None                 |
| **created_at**  | timestamp with time zone | Yes      | None                 |
| **ip_address**  | character varying(64)    | No       | ''::character var... |




**Timestamps**: created_at






#### Indexes

| Index Name                 | Columns     | Unique   | Primary  | Type     |
| -------------------------- | ----------- | -------- | -------- | -------- |
| audit_log_entries_pkey     | id          | Yes      | Yes      | btree    |
| audit_logs_instance_id_idx | instance_id | No       | No       | btree    |


---

### flow_state

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 12  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 4

#### Columns

| Column                     | Type                     | Nullable | Default  |
| -------------------------- | ------------------------ | -------- | -------- |
| **id**                     | uuid                     | No       | None     |
| **user_id**                | uuid                     | Yes      | None     |
| **auth_code**              | text                     | No       | None     |
| **code_challenge_method**  | USER-DEFINED             | No       | None     |
| **code_challenge**         | text                     | No       | None     |
| **provider_type**          | text                     | No       | None     |
| **provider_access_token**  | text                     | Yes      | None     |
| **provider_refresh_token** | text                     | Yes      | None     |
| **created_at**             | timestamp with time zone | Yes      | None     |
| **updated_at**             | timestamp with time zone | Yes      | None     |
| **authentication_method**  | text                     | No       | None     |
| **auth_code_issued_at**    | timestamp with time zone | Yes      | None     |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                | Columns                        | Unique   | Primary  | Type     |
| ------------------------- | ------------------------------ | -------- | -------- | -------- |
| flow_state_created_at_idx | created_at                     | No       | No       | btree    |
| flow_state_pkey           | id                             | Yes      | Yes      | btree    |
| idx_auth_code             | auth_code                      | No       | No       | btree    |
| idx_user_id_auth_method   | user_id, authentication_method | No       | No       | btree    |


---

### identities

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 9  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 4

#### Columns

| Column              | Type                     | Nullable | Default  |
| ------------------- | ------------------------ | -------- | -------- |
| **provider_id**     | text                     | No       | None     |
| **user_id**         | uuid                     | No       | None     |
| **identity_data**   | jsonb                    | No       | None     |
| **provider**        | text                     | No       | None     |
| **last_sign_in_at** | timestamp with time zone | Yes      | None     |
| **created_at**      | timestamp with time zone | Yes      | None     |
| **updated_at**      | timestamp with time zone | Yes      | None     |
| **email**           | text                     | Yes      | None     |
| **id**              | uuid                     | No       | UUID     |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                             | Columns               | Unique   | Primary  | Type     |
| -------------------------------------- | --------------------- | -------- | -------- | -------- |
| identities_email_idx                   | email                 | No       | No       | btree    |
| identities_pkey                        | id                    | Yes      | Yes      | btree    |
| identities_provider_id_provider_unique | provider_id, provider | Yes      | No       | btree    |
| identities_user_id_idx                 | user_id               | No       | No       | btree    |


---

### instances

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 5  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 1

#### Columns

| Column              | Type                     | Nullable | Default  |
| ------------------- | ------------------------ | -------- | -------- |
| **id**              | uuid                     | No       | None     |
| **uuid**            | uuid                     | Yes      | None     |
| **raw_base_config** | text                     | Yes      | None     |
| **created_at**      | timestamp with time zone | Yes      | None     |
| **updated_at**      | timestamp with time zone | Yes      | None     |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name     | Columns  | Unique   | Primary  | Type     |
| -------------- | -------- | -------- | -------- | -------- |
| instances_pkey | id       | Yes      | Yes      | btree    |


---

### mfa_amr_claims

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 5  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 2

#### Columns

| Column                    | Type                     | Nullable | Default  |
| ------------------------- | ------------------------ | -------- | -------- |
| **session_id**            | uuid                     | No       | None     |
| **created_at**            | timestamp with time zone | No       | None     |
| **updated_at**            | timestamp with time zone | No       | None     |
| **authentication_method** | text                     | No       | None     |
| **id**                    | uuid                     | No       | None     |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                                         | Columns                           | Unique   | Primary  | Type     |
| -------------------------------------------------- | --------------------------------- | -------- | -------- | -------- |
| amr_id_pk                                          | id                                | Yes      | Yes      | btree    |
| mfa_amr_claims_session_id_authentication_method... | session_id, authentication_method | Yes      | No       | btree    |


---

### mfa_challenges

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 7  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 2

#### Columns

| Column                     | Type                     | Nullable | Default  |
| -------------------------- | ------------------------ | -------- | -------- |
| **id**                     | uuid                     | No       | None     |
| **factor_id**              | uuid                     | No       | None     |
| **created_at**             | timestamp with time zone | No       | None     |
| **verified_at**            | timestamp with time zone | Yes      | None     |
| **ip_address**             | inet                     | No       | None     |
| **otp_code**               | text                     | Yes      | None     |
| **web_authn_session_data** | jsonb                    | Yes      | None     |




**Timestamps**: created_at






#### Indexes

| Index Name                   | Columns    | Unique   | Primary  | Type     |
| ---------------------------- | ---------- | -------- | -------- | -------- |
| mfa_challenge_created_at_idx | created_at | No       | No       | btree    |
| mfa_challenges_pkey          | id         | Yes      | Yes      | btree    |


---

### mfa_factors

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 12  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 6

#### Columns

| Column                   | Type                     | Nullable | Default  |
| ------------------------ | ------------------------ | -------- | -------- |
| **id**                   | uuid                     | No       | None     |
| **user_id**              | uuid                     | No       | None     |
| **friendly_name**        | text                     | Yes      | None     |
| **factor_type**          | USER-DEFINED             | No       | None     |
| **status**               | USER-DEFINED             | No       | None     |
| **created_at**           | timestamp with time zone | No       | None     |
| **updated_at**           | timestamp with time zone | No       | None     |
| **secret**               | text                     | Yes      | None     |
| **phone**                | text                     | Yes      | None     |
| **last_challenged_at**   | timestamp with time zone | Yes      | None     |
| **web_authn_credential** | jsonb                    | Yes      | None     |
| **web_authn_aaguid**     | uuid                     | Yes      | None     |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                            | Columns                | Unique   | Primary  | Type     |
| ------------------------------------- | ---------------------- | -------- | -------- | -------- |
| factor_id_created_at_idx              | user_id, created_at    | No       | No       | btree    |
| mfa_factors_last_challenged_at_key    | last_challenged_at     | Yes      | No       | btree    |
| mfa_factors_pkey                      | id                     | Yes      | Yes      | btree    |
| mfa_factors_user_friendly_name_unique | user_id, friendly_name | Yes      | No       | btree    |
| mfa_factors_user_id_idx               | user_id                | No       | No       | btree    |
| unique_phone_factor_per_user          | user_id, phone         | Yes      | No       | btree    |


---

### oauth_clients

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 12  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 4

#### Columns

| Column                 | Type                     | Nullable | Default      |
| ---------------------- | ------------------------ | -------- | ------------ |
| **id**                 | uuid                     | No       | None         |
| **client_id**          | text                     | No       | None         |
| **client_secret_hash** | text                     | No       | None         |
| **registration_type**  | USER-DEFINED             | No       | None         |
| **redirect_uris**      | text                     | No       | None         |
| **grant_types**        | text                     | No       | None         |
| **client_name**        | text                     | Yes      | None         |
| **client_uri**         | text                     | Yes      | None         |
| **logo_uri**           | text                     | Yes      | None         |
| **created_at**         | timestamp with time zone | No       | Current Time |
| **updated_at**         | timestamp with time zone | No       | Current Time |
| **deleted_at**         | timestamp with time zone | Yes      | None         |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                   | Columns    | Unique   | Primary  | Type     |
| ---------------------------- | ---------- | -------- | -------- | -------- |
| oauth_clients_client_id_idx  | client_id  | No       | No       | btree    |
| oauth_clients_client_id_key  | client_id  | Yes      | No       | btree    |
| oauth_clients_deleted_at_idx | deleted_at | No       | No       | btree    |
| oauth_clients_pkey           | id         | Yes      | Yes      | btree    |


---

### one_time_tokens

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 7  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 4

#### Columns

| Column         | Type                        | Nullable | Default      |
| -------------- | --------------------------- | -------- | ------------ |
| **id**         | uuid                        | No       | None         |
| **user_id**    | uuid                        | No       | None         |
| **token_type** | USER-DEFINED                | No       | None         |
| **token_hash** | text                        | No       | None         |
| **relates_to** | text                        | No       | None         |
| **created_at** | timestamp without time zone | No       | Current Time |
| **updated_at** | timestamp without time zone | No       | Current Time |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                             | Columns             | Unique   | Primary  | Type     |
| -------------------------------------- | ------------------- | -------- | -------- | -------- |
| one_time_tokens_pkey                   | id                  | Yes      | Yes      | btree    |
| one_time_tokens_relates_to_hash_idx    | relates_to          | No       | No       | hash     |
| one_time_tokens_token_hash_hash_idx    | token_hash          | No       | No       | hash     |
| one_time_tokens_user_id_token_type_key | user_id, token_type | Yes      | No       | btree    |


---

### refresh_tokens

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 9  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 7

#### Columns

| Column          | Type                     | Nullable | Default              |
| --------------- | ------------------------ | -------- | -------------------- |
| **instance_id** | uuid                     | Yes      | None                 |
| **id**          | bigint                   | No       | nextval('auth.ref... |
| **token**       | character varying(255)   | Yes      | None                 |
| **user_id**     | character varying(255)   | Yes      | None                 |
| **revoked**     | boolean                  | Yes      | None                 |
| **created_at**  | timestamp with time zone | Yes      | None                 |
| **updated_at**  | timestamp with time zone | Yes      | None                 |
| **parent**      | character varying(255)   | Yes      | None                 |
| **session_id**  | uuid                     | Yes      | None                 |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                             | Columns              | Unique   | Primary  | Type     |
| -------------------------------------- | -------------------- | -------- | -------- | -------- |
| refresh_tokens_instance_id_idx         | instance_id          | No       | No       | btree    |
| refresh_tokens_instance_id_user_id_idx | instance_id, user_id | No       | No       | btree    |
| refresh_tokens_parent_idx              | parent               | No       | No       | btree    |
| refresh_tokens_pkey                    | id                   | Yes      | Yes      | btree    |
| refresh_tokens_session_id_revoked_idx  | revoked, session_id  | No       | No       | btree    |
| refresh_tokens_token_unique            | token                | Yes      | No       | btree    |
| refresh_tokens_updated_at_idx          | updated_at           | No       | No       | btree    |


---

### saml_providers

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 9  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 3

#### Columns

| Column                | Type                     | Nullable | Default  |
| --------------------- | ------------------------ | -------- | -------- |
| **id**                | uuid                     | No       | None     |
| **sso_provider_id**   | uuid                     | No       | None     |
| **entity_id**         | text                     | No       | None     |
| **metadata_xml**      | text                     | No       | None     |
| **metadata_url**      | text                     | Yes      | None     |
| **attribute_mapping** | jsonb                    | Yes      | None     |
| **created_at**        | timestamp with time zone | Yes      | None     |
| **updated_at**        | timestamp with time zone | Yes      | None     |
| **name_id_format**    | text                     | Yes      | None     |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                         | Columns         | Unique   | Primary  | Type     |
| ---------------------------------- | --------------- | -------- | -------- | -------- |
| saml_providers_entity_id_key       | entity_id       | Yes      | No       | btree    |
| saml_providers_pkey                | id              | Yes      | Yes      | btree    |
| saml_providers_sso_provider_id_idx | sso_provider_id | No       | No       | btree    |


---

### saml_relay_states

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 8  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 4

#### Columns

| Column              | Type                     | Nullable | Default  |
| ------------------- | ------------------------ | -------- | -------- |
| **id**              | uuid                     | No       | None     |
| **sso_provider_id** | uuid                     | No       | None     |
| **request_id**      | text                     | No       | None     |
| **for_email**       | text                     | Yes      | None     |
| **redirect_to**     | text                     | Yes      | None     |
| **created_at**      | timestamp with time zone | Yes      | None     |
| **updated_at**      | timestamp with time zone | Yes      | None     |
| **flow_state_id**   | uuid                     | Yes      | None     |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                            | Columns         | Unique   | Primary  | Type     |
| ------------------------------------- | --------------- | -------- | -------- | -------- |
| saml_relay_states_created_at_idx      | created_at      | No       | No       | btree    |
| saml_relay_states_for_email_idx       | for_email       | No       | No       | btree    |
| saml_relay_states_pkey                | id              | Yes      | Yes      | btree    |
| saml_relay_states_sso_provider_id_idx | sso_provider_id | No       | No       | btree    |


---

### schema_migrations

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 8  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 4

#### Columns

| Column              | Type                        | Nullable | Default  |
| ------------------- | --------------------------- | -------- | -------- |
| **version**         | character varying(255)      | No       | None     |
| **version**         | bigint                      | No       | None     |
| **inserted_at**     | timestamp without time zone | Yes      | None     |
| **version**         | text                        | No       | None     |
| **statements**      | ARRAY                       | Yes      | None     |
| **name**            | text                        | Yes      | None     |
| **created_by**      | text                        | Yes      | None     |
| **idempotency_key** | text                        | Yes      | None     |









#### Indexes

| Index Name                            | Columns         | Unique   | Primary  | Type     |
| ------------------------------------- | --------------- | -------- | -------- | -------- |
| schema_migrations_pkey                | version         | Yes      | Yes      | btree    |
| schema_migrations_pkey                | version         | Yes      | Yes      | btree    |
| schema_migrations_idempotency_key_key | idempotency_key | Yes      | No       | btree    |
| schema_migrations_pkey                | version         | Yes      | Yes      | btree    |


---

### sessions

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 11  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 4

#### Columns

| Column           | Type                        | Nullable | Default  |
| ---------------- | --------------------------- | -------- | -------- |
| **id**           | uuid                        | No       | None     |
| **user_id**      | uuid                        | No       | None     |
| **created_at**   | timestamp with time zone    | Yes      | None     |
| **updated_at**   | timestamp with time zone    | Yes      | None     |
| **factor_id**    | uuid                        | Yes      | None     |
| **aal**          | USER-DEFINED                | Yes      | None     |
| **not_after**    | timestamp with time zone    | Yes      | None     |
| **refreshed_at** | timestamp without time zone | Yes      | None     |
| **user_agent**   | text                        | Yes      | None     |
| **ip**           | inet                        | Yes      | None     |
| **tag**          | text                        | Yes      | None     |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name             | Columns             | Unique   | Primary  | Type     |
| ---------------------- | ------------------- | -------- | -------- | -------- |
| sessions_not_after_idx | not_after           | No       | No       | btree    |
| sessions_pkey          | id                  | Yes      | Yes      | btree    |
| sessions_user_id_idx   | user_id             | No       | No       | btree    |
| user_id_created_at_idx | user_id, created_at | No       | No       | btree    |


---

### sso_domains

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 5  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 2

#### Columns

| Column              | Type                     | Nullable | Default  |
| ------------------- | ------------------------ | -------- | -------- |
| **id**              | uuid                     | No       | None     |
| **sso_provider_id** | uuid                     | No       | None     |
| **domain**          | text                     | No       | None     |
| **created_at**      | timestamp with time zone | Yes      | None     |
| **updated_at**      | timestamp with time zone | Yes      | None     |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                      | Columns         | Unique   | Primary  | Type     |
| ------------------------------- | --------------- | -------- | -------- | -------- |
| sso_domains_pkey                | id              | Yes      | Yes      | btree    |
| sso_domains_sso_provider_id_idx | sso_provider_id | No       | No       | btree    |


---

### sso_providers

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 5  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 2

#### Columns

| Column          | Type                     | Nullable | Default  |
| --------------- | ------------------------ | -------- | -------- |
| **id**          | uuid                     | No       | None     |
| **resource_id** | text                     | Yes      | None     |
| **created_at**  | timestamp with time zone | Yes      | None     |
| **updated_at**  | timestamp with time zone | Yes      | None     |
| **disabled**    | boolean                  | Yes      | None     |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                            | Columns     | Unique   | Primary  | Type     |
| ------------------------------------- | ----------- | -------- | -------- | -------- |
| sso_providers_pkey                    | id          | Yes      | Yes      | btree    |
| sso_providers_resource_id_pattern_idx | resource_id | No       | No       | btree    |


---

### users

**Type**: BASE TABLE  
**Schema**: auth  
**Columns**: 35  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 11

#### Columns

| Column                          | Type                     | Nullable | Default              |
| ------------------------------- | ------------------------ | -------- | -------------------- |
| **instance_id**                 | uuid                     | Yes      | None                 |
| **id**                          | uuid                     | No       | None                 |
| **aud**                         | character varying(255)   | Yes      | None                 |
| **role**                        | character varying(255)   | Yes      | None                 |
| **email**                       | character varying(255)   | Yes      | None                 |
| **encrypted_password**          | character varying(255)   | Yes      | None                 |
| **email_confirmed_at**          | timestamp with time zone | Yes      | None                 |
| **invited_at**                  | timestamp with time zone | Yes      | None                 |
| **confirmation_token**          | character varying(255)   | Yes      | None                 |
| **confirmation_sent_at**        | timestamp with time zone | Yes      | None                 |
| **recovery_token**              | character varying(255)   | Yes      | None                 |
| **recovery_sent_at**            | timestamp with time zone | Yes      | None                 |
| **email_change_token_new**      | character varying(255)   | Yes      | None                 |
| **email_change**                | character varying(255)   | Yes      | None                 |
| **email_change_sent_at**        | timestamp with time zone | Yes      | None                 |
| **last_sign_in_at**             | timestamp with time zone | Yes      | None                 |
| **raw_app_meta_data**           | jsonb                    | Yes      | None                 |
| **raw_user_meta_data**          | jsonb                    | Yes      | None                 |
| **is_super_admin**              | boolean                  | Yes      | None                 |
| **created_at**                  | timestamp with time zone | Yes      | None                 |
| **updated_at**                  | timestamp with time zone | Yes      | None                 |
| **phone**                       | text                     | Yes      | NULL::character v... |
| **phone_confirmed_at**          | timestamp with time zone | Yes      | None                 |
| **phone_change**                | text                     | Yes      | ''::character var... |
| **phone_change_token**          | character varying(255)   | Yes      | ''::character var... |
| **phone_change_sent_at**        | timestamp with time zone | Yes      | None                 |
| **confirmed_at**                | timestamp with time zone | Yes      | None                 |
| **email_change_token_current**  | character varying(255)   | Yes      | ''::character var... |
| **email_change_confirm_status** | smallint                 | Yes      | 0                    |
| **banned_until**                | timestamp with time zone | Yes      | None                 |
| **reauthentication_token**      | character varying(255)   | Yes      | ''::character var... |
| **reauthentication_sent_at**    | timestamp with time zone | Yes      | None                 |
| **is_sso_user**                 | boolean                  | No       | false                |
| **deleted_at**                  | timestamp with time zone | Yes      | None                 |
| **is_anonymous**                | boolean                  | No       | false                |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name                     | Columns                    | Unique   | Primary  | Type     |
| ------------------------------ | -------------------------- | -------- | -------- | -------- |
| confirmation_token_idx         | confirmation_token         | Yes      | No       | btree    |
| email_change_token_current_idx | email_change_token_current | Yes      | No       | btree    |
| email_change_token_new_idx     | email_change_token_new     | Yes      | No       | btree    |
| reauthentication_token_idx     | reauthentication_token     | Yes      | No       | btree    |
| recovery_token_idx             | recovery_token             | Yes      | No       | btree    |
| users_email_partial_key        | email                      | Yes      | No       | btree    |
| users_instance_id_email_idx    | instance_id                | No       | No       | btree    |
| users_instance_id_idx          | instance_id                | No       | No       | btree    |
| users_is_anonymous_idx         | is_anonymous               | No       | No       | btree    |
| users_phone_key                | phone                      | Yes      | No       | btree    |
| users_pkey                     | id                         | Yes      | Yes      | btree    |


---

### trial_balance_uploads

**Type**: BASE TABLE  
**Schema**: data  
**Columns**: 22  
**Foreign Keys**: 0  
**RLS Policies**: 4  
**Indexes**: 2

#### Columns

| Column                        | Type                     | Nullable | Default              |
| ----------------------------- | ------------------------ | -------- | -------------------- |
| **trial_balance_upload_uuid** | uuid                     | No       | UUID                 |
| **entity_uuid**               | uuid                     | No       | None                 |
| **account_number**            | text                     | No       | None                 |
| **account_description**       | text                     | Yes      | None                 |
| **account_type**              | USER-DEFINED             | No       | None                 |
| **amount_periodicity**        | USER-DEFINED             | No       | None                 |
| **amount_type**               | USER-DEFINED             | No       | None                 |
| **amount_time_basis**         | USER-DEFINED             | Yes      | None                 |
| **aggregation_scope**         | USER-DEFINED             | No       | 'period'::aggrega... |
| **period_key_yyyymm**         | integer                  | No       | None                 |
| **period_start_date**         | date                     | No       | None                 |
| **period_end_date**           | date                     | No       | None                 |
| **as_of_date**                | date                     | No       | None                 |
| **amount**                    | numeric                  | No       | None                 |
| **currency_code**             | character(3)             | No       | None                 |
| **source_system**             | text                     | No       | None                 |
| **source_file_name**          | text                     | No       | None                 |
| **source_row_number**         | integer                  | No       | None                 |
| **source_hash**               | text                     | No       | None                 |
| **created_at**                | timestamp with time zone | No       | Current Time         |
| **updated_at**                | timestamp with time zone | No       | Current Time         |
| **trial_balance_upload_id**   | integer                  | No       | None                 |


**Primary Keys**: trial_balance_upload_uuid, entity_uuid



**Timestamps**: created_at, updated_at




#### Row Level Security Policies

**Super admins can manage all trial balances**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_super_admin_user()  
- **With Check Expression**: N/A  

**Users can delete trial balances for accessible entities**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM user_entity_access uea
  WHERE ((uea.user_uuid = ( SELECT user_accounts.user_uuid
           FROM user_accounts
          WHERE (user_accounts.supabase_user_uuid = auth.uid()))) AND (uea.entity_uuid = trial_balance_uploads.entity_uuid) AND (uea.is_active = true))))  
- **With Check Expression**: N/A  

**Users can insert trial balances for accessible entities**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: (EXISTS ( SELECT 1
   FROM user_entity_access uea
  WHERE ((uea.user_uuid = ( SELECT user_accounts.user_uuid
           FROM user_accounts
          WHERE (user_accounts.supabase_user_uuid = auth.uid()))) AND (uea.entity_uuid = trial_balance_uploads.entity_uuid) AND (uea.is_active = true))))  

**Users can view accessible entity trial balances**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM user_entity_access uea
  WHERE ((uea.user_uuid = ( SELECT user_accounts.user_uuid
           FROM user_accounts
          WHERE (user_accounts.supabase_user_uuid = auth.uid()))) AND (uea.entity_uuid = trial_balance_uploads.entity_uuid) AND (uea.is_active = true))))  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                   | Columns                                            | Unique   | Primary  | Type     |
| ---------------------------- | -------------------------------------------------- | -------- | -------- | -------- |
| trial_balances_uploaded_pkey | trial_balance_upload_uuid                          | Yes      | Yes      | btree    |
| uq_trial_balance_uploads     | entity_uuid, account_number, amount_periodicity... | Yes      | No       | btree    |


---

### pg_stat_statements

**Type**: VIEW  
**Schema**: extensions  
**Columns**: 49  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 0

#### Columns

| Column                     | Type                     | Nullable | Default  |
| -------------------------- | ------------------------ | -------- | -------- |
| **userid**                 | oid                      | Yes      | None     |
| **dbid**                   | oid                      | Yes      | None     |
| **toplevel**               | boolean                  | Yes      | None     |
| **queryid**                | bigint                   | Yes      | None     |
| **query**                  | text                     | Yes      | None     |
| **plans**                  | bigint                   | Yes      | None     |
| **total_plan_time**        | double precision         | Yes      | None     |
| **min_plan_time**          | double precision         | Yes      | None     |
| **max_plan_time**          | double precision         | Yes      | None     |
| **mean_plan_time**         | double precision         | Yes      | None     |
| **stddev_plan_time**       | double precision         | Yes      | None     |
| **calls**                  | bigint                   | Yes      | None     |
| **total_exec_time**        | double precision         | Yes      | None     |
| **min_exec_time**          | double precision         | Yes      | None     |
| **max_exec_time**          | double precision         | Yes      | None     |
| **mean_exec_time**         | double precision         | Yes      | None     |
| **stddev_exec_time**       | double precision         | Yes      | None     |
| **rows**                   | bigint                   | Yes      | None     |
| **shared_blks_hit**        | bigint                   | Yes      | None     |
| **shared_blks_read**       | bigint                   | Yes      | None     |
| **shared_blks_dirtied**    | bigint                   | Yes      | None     |
| **shared_blks_written**    | bigint                   | Yes      | None     |
| **local_blks_hit**         | bigint                   | Yes      | None     |
| **local_blks_read**        | bigint                   | Yes      | None     |
| **local_blks_dirtied**     | bigint                   | Yes      | None     |
| **local_blks_written**     | bigint                   | Yes      | None     |
| **temp_blks_read**         | bigint                   | Yes      | None     |
| **temp_blks_written**      | bigint                   | Yes      | None     |
| **shared_blk_read_time**   | double precision         | Yes      | None     |
| **shared_blk_write_time**  | double precision         | Yes      | None     |
| **local_blk_read_time**    | double precision         | Yes      | None     |
| **local_blk_write_time**   | double precision         | Yes      | None     |
| **temp_blk_read_time**     | double precision         | Yes      | None     |
| **temp_blk_write_time**    | double precision         | Yes      | None     |
| **wal_records**            | bigint                   | Yes      | None     |
| **wal_fpi**                | bigint                   | Yes      | None     |
| **wal_bytes**              | numeric                  | Yes      | None     |
| **jit_functions**          | bigint                   | Yes      | None     |
| **jit_generation_time**    | double precision         | Yes      | None     |
| **jit_inlining_count**     | bigint                   | Yes      | None     |
| **jit_inlining_time**      | double precision         | Yes      | None     |
| **jit_optimization_count** | bigint                   | Yes      | None     |
| **jit_optimization_time**  | double precision         | Yes      | None     |
| **jit_emission_count**     | bigint                   | Yes      | None     |
| **jit_emission_time**      | double precision         | Yes      | None     |
| **jit_deform_count**       | bigint                   | Yes      | None     |
| **jit_deform_time**        | double precision         | Yes      | None     |
| **stats_since**            | timestamp with time zone | Yes      | None     |
| **minmax_stats_since**     | timestamp with time zone | Yes      | None     |











---

### pg_stat_statements_info

**Type**: VIEW  
**Schema**: extensions  
**Columns**: 2  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 0

#### Columns

| Column          | Type                     | Nullable | Default  |
| --------------- | ------------------------ | -------- | -------- |
| **dealloc**     | bigint                   | Yes      | None     |
| **stats_reset** | timestamp with time zone | Yes      | None     |











---

### coa_translation_sessions

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 22  
**Foreign Keys**: 2  
**RLS Policies**: 5  
**Indexes**: 9

#### Columns

| Column                           | Type                     | Nullable | Default              |
| -------------------------------- | ------------------------ | -------- | -------------------- |
| **coa_translation_session_uuid** | uuid                     | No       | UUID                 |
| **session_id**                   | uuid                     | No       | UUID                 |
| **user_id**                      | uuid                     | No       | None                 |
| **filename**                     | text                     | No       | None                 |
| **total_accounts**               | integer                  | No       | None                 |
| **processed_accounts**           | integer                  | Yes      | 0                    |
| **source_language**              | text                     | Yes      | None                 |
| **target_language**              | text                     | No       | None                 |
| **session_data**                 | jsonb                    | No       | '{}'::jsonb          |
| **status**                       | text                     | No       | 'processing'::text   |
| **created_at**                   | timestamp with time zone | No       | Current Time         |
| **completed_at**                 | timestamp with time zone | Yes      | None                 |
| **updated_at**                   | timestamp with time zone | No       | Current Time         |
| **error_details**                | jsonb                    | Yes      | None                 |
| **retry_count**                  | integer                  | Yes      | 0                    |
| **progress_percentage**          | numeric                  | Yes      | 0.00                 |
| **estimated_completion_at**      | timestamp with time zone | Yes      | None                 |
| **user_uuid**                    | uuid                     | Yes      | None                 |
| **status_enum**                  | USER-DEFINED             | No       | 'pending'::transl... |
| **coa_translation_session_id**   | integer                  | No       | None                 |
| **entity_uuid**                  | uuid                     | Yes      | None                 |
| **entity_id**                    | integer                  | Yes      | None                 |


**Primary Keys**: coa_translation_session_uuid, user_uuid, entity_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column      | References                     | Constraint Name                          |
| ----------- | ------------------------------ | ---------------------------------------- |
| entity_uuid | public.entities.entity_uuid    | fk_coa_translation_sessions_entity       |
| user_uuid   | public.user_accounts.user_uuid | fk_coa_translation_sessions_user_account |


#### Row Level Security Policies

**Admins can view all translation sessions**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Users can delete their own translation sessions**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (auth.uid() = user_id)  
- **With Check Expression**: N/A  

**Users can insert their own translation sessions**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: (auth.uid() = user_id)  

**Users can update their own translation sessions**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (auth.uid() = user_id)  
- **With Check Expression**: N/A  

**Users can view their own translation sessions**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (auth.uid() = user_id)  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                                  | Columns                      | Unique   | Primary  | Type     |
| ------------------------------------------- | ---------------------------- | -------- | -------- | -------- |
| idx_coa_translation_sessions_created_at     | created_at                   | No       | No       | btree    |
| idx_coa_translation_sessions_status         | status                       | No       | No       | btree    |
| idx_coa_translation_sessions_status_enum    | status_enum                  | No       | No       | btree    |
| idx_coa_translation_sessions_status_updated | updated_at, status_enum      | No       | No       | btree    |
| idx_coa_translation_sessions_user_account   | user_uuid                    | No       | No       | btree    |
| idx_coa_translation_sessions_user_id        | user_id                      | No       | No       | btree    |
| pk_coa_translation_sessions                 | coa_translation_session_uuid | Yes      | Yes      | btree    |
| uq_coa_translation_sessions_id              | coa_translation_session_id   | Yes      | No       | btree    |
| uq_coa_translation_sessions_session_id      | session_id                   | Yes      | No       | btree    |


---

### entities

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 11  
**Foreign Keys**: 2  
**RLS Policies**: 3  
**Indexes**: 3

#### Columns

| Column                   | Type                     | Nullable | Default      |
| ------------------------ | ------------------------ | -------- | ------------ |
| **entity_uuid**          | uuid                     | No       | UUID         |
| **entity_id**            | integer                  | No       | None         |
| **entity_name**          | text                     | No       | None         |
| **entity_code**          | text                     | No       | None         |
| **entity_group_uuid**    | uuid                     | No       | None         |
| **entity_group_id**      | integer                  | No       | None         |
| **description**          | text                     | Yes      | None         |
| **is_active**            | boolean                  | No       | true         |
| **created_at**           | timestamp with time zone | No       | Current Time |
| **updated_at**           | timestamp with time zone | No       | Current Time |
| **created_by_user_uuid** | uuid                     | Yes      | None         |


**Primary Keys**: entity_uuid, entity_group_uuid, created_by_user_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column               | References                             | Constraint Name          |
| -------------------- | -------------------------------------- | ------------------------ |
| created_by_user_uuid | public.user_accounts.user_uuid         | fk_entities_created_by   |
| entity_group_uuid    | public.entity_groups.entity_group_uuid | fk_entities_entity_group |


#### Row Level Security Policies

**Entity admins can update their entities**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM user_entity_access uea
  WHERE ((uea.user_uuid = ( SELECT user_accounts.user_uuid
           FROM user_accounts
          WHERE (user_accounts.supabase_user_uuid = auth.uid()))) AND ((uea.entity_uuid = entities.entity_uuid) OR (uea.entity_group_uuid = entities.entity_group_uuid)) AND (uea.is_active = true) AND (uea.access_level = 'entity_admin'::access_level))))  
- **With Check Expression**: N/A  

**Super admins can manage all entities**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_super_admin_user()  
- **With Check Expression**: N/A  

**Users can view entities they have access to**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM user_entity_access uea
  WHERE ((uea.user_uuid = ( SELECT user_accounts.user_uuid
           FROM user_accounts
          WHERE (user_accounts.supabase_user_uuid = auth.uid()))) AND ((uea.entity_uuid = entities.entity_uuid) OR (uea.entity_group_uuid = entities.entity_group_uuid)) AND (uea.is_active = true))))  
- **With Check Expression**: N/A  



#### Indexes

| Index Name       | Columns     | Unique   | Primary  | Type     |
| ---------------- | ----------- | -------- | -------- | -------- |
| pk_entities      | entity_uuid | Yes      | Yes      | btree    |
| uq_entities_code | entity_code | Yes      | No       | btree    |
| uq_entities_id   | entity_id   | Yes      | No       | btree    |


---

### entity_groups

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 9  
**Foreign Keys**: 1  
**RLS Policies**: 2  
**Indexes**: 3

#### Columns

| Column                   | Type                     | Nullable | Default      |
| ------------------------ | ------------------------ | -------- | ------------ |
| **entity_group_uuid**    | uuid                     | No       | UUID         |
| **entity_group_id**      | integer                  | No       | None         |
| **entity_group_name**    | text                     | No       | None         |
| **entity_group_code**    | text                     | No       | None         |
| **description**          | text                     | Yes      | None         |
| **is_active**            | boolean                  | No       | true         |
| **created_at**           | timestamp with time zone | No       | Current Time |
| **updated_at**           | timestamp with time zone | No       | Current Time |
| **created_by_user_uuid** | uuid                     | Yes      | None         |


**Primary Keys**: entity_group_uuid, created_by_user_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column               | References                     | Constraint Name             |
| -------------------- | ------------------------------ | --------------------------- |
| created_by_user_uuid | public.user_accounts.user_uuid | fk_entity_groups_created_by |


#### Row Level Security Policies

**Entity admins can view their entity groups**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM (user_entity_access uea
     JOIN entities e ON ((e.entity_group_uuid = entity_groups.entity_group_uuid)))
  WHERE ((uea.user_uuid = ( SELECT user_accounts.user_uuid
           FROM user_accounts
          WHERE (user_accounts.supabase_user_uuid = auth.uid()))) AND (uea.entity_uuid = e.entity_uuid) AND (uea.is_active = true) AND (uea.access_level = 'entity_admin'::access_level))))  
- **With Check Expression**: N/A  

**Super admins can manage all entity groups**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_super_admin_user()  
- **With Check Expression**: N/A  



#### Indexes

| Index Name            | Columns           | Unique   | Primary  | Type     |
| --------------------- | ----------------- | -------- | -------- | -------- |
| pk_entity_groups      | entity_group_uuid | Yes      | Yes      | btree    |
| uq_entity_groups_code | entity_group_code | Yes      | No       | btree    |
| uq_entity_groups_id   | entity_group_id   | Yes      | No       | btree    |


---

### report_line_items

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 37  
**Foreign Keys**: 6  
**RLS Policies**: 5  
**Indexes**: 12

#### Columns

| Column                            | Type                     | Nullable | Default      |
| --------------------------------- | ------------------------ | -------- | ------------ |
| **report_line_item_uuid**         | uuid                     | No       | UUID         |
| **report_line_item_id**           | integer                  | No       | None         |
| **report_line_item_description**  | text                     | Yes      | None         |
| **report_structure_id**           | integer                  | No       | None         |
| **report_structure_uuid**         | uuid                     | No       | None         |
| **report_structure_name**         | text                     | No       | None         |
| **report_line_item_key**          | text                     | No       | None         |
| **parent_report_line_item_key**   | text                     | Yes      | None         |
| **parent_report_line_item_uuid**  | uuid                     | Yes      | None         |
| **is_parent_key_existing**        | boolean                  | Yes      | false        |
| **sort_order**                    | integer                  | No       | 0            |
| **hierarchy_path**                | text                     | Yes      | None         |
| **level_1_line_item_description** | text                     | Yes      | None         |
| **level_2_line_item_description** | text                     | Yes      | None         |
| **level_3_line_item_description** | text                     | Yes      | None         |
| **level_4_line_item_description** | text                     | Yes      | None         |
| **level_5_line_item_description** | text                     | Yes      | None         |
| **level_6_line_item_description** | text                     | Yes      | None         |
| **level_7_line_item_description** | text                     | Yes      | None         |
| **line_item_type**                | text                     | Yes      | None         |
| **description_of_leaf**           | text                     | Yes      | None         |
| **is_leaf**                       | boolean                  | Yes      | false        |
| **is_calculated**                 | boolean                  | Yes      | false        |
| **display**                       | boolean                  | Yes      | true         |
| **data_source**                   | text                     | Yes      | None         |
| **comment**                       | text                     | Yes      | None         |
| **created_at**                    | timestamp with time zone | Yes      | Current Time |
| **updated_at**                    | timestamp with time zone | Yes      | Current Time |
| **created_by**                    | uuid                     | Yes      | None         |
| **updated_by**                    | uuid                     | Yes      | None         |
| **tags**                          | ARRAY                    | Yes      | None         |
| **metadata**                      | jsonb                    | Yes      | '{}'::jsonb  |
| **created_by_user_uuid**          | uuid                     | Yes      | None         |
| **updated_by_user_uuid**          | uuid                     | Yes      | None         |
| **entity_uuid**                   | uuid                     | Yes      | None         |
| **entity_id**                     | integer                  | Yes      | None         |
| **source_language_code**          | character(2)             | Yes      | None         |


**Primary Keys**: report_line_item_uuid, report_structure_uuid, parent_report_line_item_uuid, created_by_user_uuid, updated_by_user_uuid, entity_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column                | References                                     | Constraint Name                              |
| --------------------- | ---------------------------------------------- | -------------------------------------------- |
| created_by_user_uuid  | public.user_accounts.user_uuid                 | fk_report_line_items_created_by_user_account |
| entity_uuid           | public.entities.entity_uuid                    | fk_report_line_items_entity                  |
| report_structure_id   | public.report_structures.report_structure_id   | report_line_items_report_structure_id_fkey   |
| report_structure_uuid | public.report_structures.report_structure_uuid | report_line_items_report_structure_uuid_fkey |
| source_language_code  | public.system_languages.language_code          | report_line_items_source_language_code_fkey  |
| updated_by_user_uuid  | public.user_accounts.user_uuid                 | fk_report_line_items_updated_by_user_account |


#### Row Level Security Policies

**Admins can delete report line items**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Admins can insert report line items**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: is_admin_user()  

**Admins can update report line items**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Admins can view all report line items**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Authenticated users can view line items from active structures**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM report_structures
  WHERE ((report_structures.report_structure_uuid = report_line_items.report_structure_uuid) AND (report_structures.is_active = true))))  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                                    | Columns                                            | Unique   | Primary  | Type     |
| --------------------------------------------- | -------------------------------------------------- | -------- | -------- | -------- |
| idx_report_line_items_created_by_user_account | created_by_user_uuid                               | No       | No       | btree    |
| idx_report_line_items_key                     | report_line_item_key                               | No       | No       | btree    |
| idx_report_line_items_parent_uuid             | parent_report_line_item_uuid                       | No       | No       | btree    |
| idx_report_line_items_sort_order              | report_structure_uuid, sort_order                  | No       | No       | btree    |
| idx_report_line_items_structure_id            | report_structure_id                                | No       | No       | btree    |
| idx_report_line_items_structure_parent        | report_structure_uuid, parent_report_line_item_... | No       | No       | btree    |
| idx_report_line_items_structure_sort          | report_structure_uuid, sort_order                  | No       | No       | btree    |
| idx_report_line_items_structure_uuid          | report_structure_uuid                              | No       | No       | btree    |
| idx_report_line_items_updated_by_user_account | updated_by_user_uuid                               | No       | No       | btree    |
| pk_report_line_items                          | report_line_item_uuid                              | Yes      | Yes      | btree    |
| uq_report_line_items_id                       | report_line_item_id                                | Yes      | No       | btree    |
| uq_report_line_items_structure_sort_order     | report_structure_uuid, sort_order                  | Yes      | No       | btree    |


---

### report_line_items_translations

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 13  
**Foreign Keys**: 3  
**RLS Policies**: 2  
**Indexes**: 7

#### Columns

| Column                                | Type                     | Nullable | Default        |
| ------------------------------------- | ------------------------ | -------- | -------------- |
| **report_line_item_translation_uuid** | uuid                     | No       | UUID           |
| **report_line_item_translation_id**   | integer                  | No       | None           |
| **report_line_item_uuid**             | uuid                     | No       | None           |
| **language_code_target**              | character(2)             | No       | None           |
| **source_field_name**                 | text                     | No       | None           |
| **translated_text**                   | text                     | Yes      | None           |
| **source**                            | text                     | No       | 'manual'::text |
| **created_at**                        | timestamp with time zone | No       | Current Time   |
| **updated_at**                        | timestamp with time zone | No       | Current Time   |
| **created_by**                        | uuid                     | No       | None           |
| **updated_by**                        | uuid                     | No       | None           |
| **language_code_original**            | character(2)             | No       | None           |
| **original_text**                     | text                     | No       | None           |


**Primary Keys**: report_line_item_translation_uuid, report_line_item_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column                 | References                                     | Constraint Name                                    |
| ---------------------- | ---------------------------------------------- | -------------------------------------------------- |
| language_code_original | public.system_languages.language_code          | report_line_items_translations_language_code_or... |
| language_code_target   | public.system_languages.language_code          | fk_report_line_items_translations_language         |
| report_line_item_uuid  | public.report_line_items.report_line_item_uuid | fk_report_line_items_translations_item             |


#### Row Level Security Policies

**Admins can manage line item translations**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Users can view translations for accessible line items**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM report_line_items rli
  WHERE (rli.report_line_item_uuid = report_line_items_translations.report_line_item_uuid)))  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                                         | Columns                                            | Unique   | Primary  | Type     |
| -------------------------------------------------- | -------------------------------------------------- | -------- | -------- | -------- |
| idx_report_line_items_translations_field           | source_field_name                                  | No       | No       | btree    |
| idx_report_line_items_translations_lookup          | report_line_item_uuid, language_code_target        | No       | No       | btree    |
| report_line_items_translation_report_line_item_... | report_line_item_translation_id                    | Yes      | No       | btree    |
| report_line_items_translations_pkey                | report_line_item_translation_uuid                  | Yes      | Yes      | btree    |
| report_line_items_translations_unique              | report_line_item_uuid, language_code_target, so... | Yes      | No       | btree    |
| unique_line_item_translation                       | report_line_item_uuid, language_code_target, so... | Yes      | No       | btree    |
| uq_report_line_items_translations_unique           | report_line_item_uuid, language_code_target, so... | Yes      | No       | btree    |


---

### report_structure_change_logs

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 19  
**Foreign Keys**: 0  
**RLS Policies**: 3  
**Indexes**: 6

#### Columns

| Column                    | Type                     | Nullable | Default              |
| ------------------------- | ------------------------ | -------- | -------------------- |
| **change_uuid**           | uuid                     | No       | UUID                 |
| **change_id**             | integer                  | No       | nextval('report_s... |
| **user_uuid**             | uuid                     | No       | None                 |
| **user_first_name**       | text                     | Yes      | None                 |
| **user_last_name**        | text                     | Yes      | None                 |
| **user_email**            | text                     | Yes      | None                 |
| **structure_uuid**        | uuid                     | No       | None                 |
| **structure_id**          | integer                  | No       | None                 |
| **line_item_uuid**        | uuid                     | Yes      | None                 |
| **line_item_id**          | integer                  | Yes      | None                 |
| **action_type**           | USER-DEFINED             | No       | None                 |
| **line_item_key**         | text                     | No       | None                 |
| **line_item_description** | text                     | Yes      | None                 |
| **previous_state**        | jsonb                    | Yes      | None                 |
| **new_state**             | jsonb                    | Yes      | None                 |
| **timestamp**             | timestamp with time zone | No       | Current Time         |
| **is_undone**             | boolean                  | No       | false                |
| **undone_at**             | timestamp with time zone | Yes      | None                 |
| **undone_by_uuid**        | uuid                     | Yes      | None                 |


**Primary Keys**: change_uuid, user_uuid, structure_uuid, line_item_uuid, undone_by_uuid






#### Row Level Security Policies

**Admins can view all change logs**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Users can insert their own change logs**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: (auth.uid() = user_uuid)  

**Users can update their own change logs for undo**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((auth.uid() = user_uuid) OR is_admin_user())  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                                | Columns        | Unique   | Primary  | Type     |
| ----------------------------------------- | -------------- | -------- | -------- | -------- |
| idx_change_log_is_undone                  | is_undone      | No       | No       | btree    |
| idx_change_log_structure_uuid             | structure_uuid | No       | No       | btree    |
| idx_change_log_timestamp                  | timestamp      | No       | No       | btree    |
| idx_change_log_user_uuid                  | user_uuid      | No       | No       | btree    |
| pk_report_structure_change_logs           | change_uuid    | Yes      | Yes      | btree    |
| uq_report_structure_change_logs_change_id | change_id      | Yes      | No       | btree    |


---

### report_structures

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 22  
**Foreign Keys**: 3  
**RLS Policies**: 5  
**Indexes**: 8

#### Columns

| Column                            | Type                     | Nullable | Default              |
| --------------------------------- | ------------------------ | -------- | -------------------- |
| **report_structure_uuid**         | uuid                     | No       | UUID                 |
| **report_structure_id**           | integer                  | No       | None                 |
| **report_structure_name**         | text                     | No       | None                 |
| **is_active**                     | boolean                  | No       | false                |
| **created_at**                    | timestamp with time zone | No       | Current Time         |
| **updated_at**                    | timestamp with time zone | No       | Current Time         |
| **created_by_supabase_user_uuid** | uuid                     | No       | None                 |
| **created_by_user_name**          | text                     | No       | None                 |
| **version**                       | integer                  | No       | 1                    |
| **name_of_import_file**           | text                     | Yes      | None                 |
| **imported_structure_id**         | text                     | Yes      | None                 |
| **description**                   | text                     | Yes      | None                 |
| **tags**                          | ARRAY                    | Yes      | None                 |
| **metadata**                      | jsonb                    | Yes      | '{}'::jsonb          |
| **archived_at**                   | timestamp with time zone | Yes      | None                 |
| **archived_by**                   | uuid                     | Yes      | None                 |
| **archived_by_user_uuid**         | uuid                     | Yes      | None                 |
| **lifecycle_status**              | USER-DEFINED             | No       | 'draft'::report_s... |
| **entity_uuid**                   | uuid                     | Yes      | None                 |
| **entity_id**                     | integer                  | Yes      | None                 |
| **source_language_code**          | character(2)             | Yes      | None                 |
| **uploaded_file_path**            | text                     | Yes      | None                 |


**Primary Keys**: report_structure_uuid, created_by_supabase_user_uuid, archived_by_user_uuid, entity_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column                | References                            | Constraint Name                               |
| --------------------- | ------------------------------------- | --------------------------------------------- |
| archived_by_user_uuid | public.user_accounts.user_uuid        | fk_report_structures_archived_by_user_account |
| entity_uuid           | public.entities.entity_uuid           | fk_report_structures_entity                   |
| source_language_code  | public.system_languages.language_code | report_structures_source_language_code_fkey   |


#### Row Level Security Policies

**Admins can delete report structures**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Admins can insert report structures**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: is_admin_user()  

**Admins can update report structures**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Admins can view all report structures**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Authenticated users can view active report structures**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (is_active = true)  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                                     | Columns                       | Unique   | Primary  | Type     |
| ---------------------------------------------- | ----------------------------- | -------- | -------- | -------- |
| idx_report_structures_active_created           | is_active, created_at         | No       | No       | btree    |
| idx_report_structures_archived_by_user_account | archived_by_user_uuid         | No       | No       | btree    |
| idx_report_structures_created_by_user          | created_by_supabase_user_uuid | No       | No       | btree    |
| idx_report_structures_is_active                | is_active                     | No       | No       | btree    |
| idx_report_structures_lifecycle_active         | is_active, lifecycle_status   | No       | No       | btree    |
| idx_report_structures_lifecycle_status         | lifecycle_status              | No       | No       | btree    |
| pk_report_structures                           | report_structure_uuid         | Yes      | Yes      | btree    |
| uq_report_structures_id                        | report_structure_id           | Yes      | No       | btree    |


---

### report_structures_translations

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 13  
**Foreign Keys**: 3  
**RLS Policies**: 2  
**Indexes**: 7

#### Columns

| Column                                | Type                     | Nullable | Default        |
| ------------------------------------- | ------------------------ | -------- | -------------- |
| **report_structure_translation_uuid** | uuid                     | No       | UUID           |
| **report_structure_translation_id**   | integer                  | No       | None           |
| **report_structure_uuid**             | uuid                     | No       | None           |
| **language_code_target**              | character(2)             | No       | None           |
| **source_field_name**                 | text                     | No       | None           |
| **translated_text**                   | text                     | Yes      | None           |
| **source**                            | text                     | No       | 'manual'::text |
| **created_at**                        | timestamp with time zone | No       | Current Time   |
| **updated_at**                        | timestamp with time zone | No       | Current Time   |
| **created_by**                        | uuid                     | No       | None           |
| **updated_by**                        | uuid                     | No       | None           |
| **language_code_original**            | character(2)             | No       | None           |
| **original_text**                     | text                     | No       | None           |


**Primary Keys**: report_structure_translation_uuid, report_structure_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column                 | References                                     | Constraint Name                                    |
| ---------------------- | ---------------------------------------------- | -------------------------------------------------- |
| language_code_original | public.system_languages.language_code          | report_structures_translations_language_code_or... |
| language_code_target   | public.system_languages.language_code          | fk_report_structures_translations_language         |
| report_structure_uuid  | public.report_structures.report_structure_uuid | fk_report_structures_translations_structure        |


#### Row Level Security Policies

**Admins can manage structure translations**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Users can view translations for accessible structures**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (EXISTS ( SELECT 1
   FROM report_structures rs
  WHERE (rs.report_structure_uuid = report_structures_translations.report_structure_uuid)))  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                                         | Columns                                            | Unique   | Primary  | Type     |
| -------------------------------------------------- | -------------------------------------------------- | -------- | -------- | -------- |
| idx_report_structures_translations_field           | source_field_name                                  | No       | No       | btree    |
| idx_report_structures_translations_lookup          | report_structure_uuid, language_code_target        | No       | No       | btree    |
| report_structures_translation_report_structure_... | report_structure_translation_id                    | Yes      | No       | btree    |
| report_structures_translations_pkey                | report_structure_translation_uuid                  | Yes      | Yes      | btree    |
| report_structures_translations_unique              | report_structure_uuid, language_code_target, so... | Yes      | No       | btree    |
| unique_structure_translation                       | report_structure_uuid, language_code_target, so... | Yes      | No       | btree    |
| uq_report_structures_translations_unique           | report_structure_uuid, language_code_target, so... | Yes      | No       | btree    |


---

### security_audit_logs

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 13  
**Foreign Keys**: 3  
**RLS Policies**: 4  
**Indexes**: 6

#### Columns

| Column                      | Type                     | Nullable | Default      |
| --------------------------- | ------------------------ | -------- | ------------ |
| **security_audit_log_uuid** | uuid                     | No       | UUID         |
| **user_id**                 | uuid                     | Yes      | None         |
| **action**                  | text                     | No       | None         |
| **target_user_id**          | uuid                     | Yes      | None         |
| **details**                 | jsonb                    | Yes      | None         |
| **ip_address**              | inet                     | Yes      | None         |
| **user_agent**              | text                     | Yes      | None         |
| **created_at**              | timestamp with time zone | No       | Current Time |
| **user_uuid**               | uuid                     | Yes      | None         |
| **target_user_uuid**        | uuid                     | Yes      | None         |
| **security_audit_log_id**   | integer                  | No       | None         |
| **entity_uuid**             | uuid                     | Yes      | None         |
| **entity_id**               | integer                  | Yes      | None         |


**Primary Keys**: security_audit_log_uuid, user_uuid, target_user_uuid, entity_uuid



**Timestamps**: created_at


#### Foreign Key Relationships

| Column           | References                     | Constraint Name                            |
| ---------------- | ------------------------------ | ------------------------------------------ |
| entity_uuid      | public.entities.entity_uuid    | fk_security_audit_logs_entity              |
| target_user_uuid | public.user_accounts.user_uuid | fk_security_audit_logs_target_user_account |
| user_uuid        | public.user_accounts.user_uuid | fk_security_audit_logs_user_account        |


#### Row Level Security Policies

**Audit logs are immutable**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: false  
- **With Check Expression**: N/A  

**Audit logs cannot be deleted**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: false  
- **With Check Expression**: N/A  

**Super admin only audit log access**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: is_super_admin_user_secure()  
- **With Check Expression**: N/A  

**System functions only can insert audit logs**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: N/A  
- **With Check Expression**: false  



#### Indexes

| Index Name                                  | Columns                 | Unique   | Primary  | Type     |
| ------------------------------------------- | ----------------------- | -------- | -------- | -------- |
| idx_security_audit_logs_action_created      | action, created_at      | No       | No       | btree    |
| idx_security_audit_logs_target_user_account | target_user_uuid        | No       | No       | btree    |
| idx_security_audit_logs_user_account        | user_uuid               | No       | No       | btree    |
| idx_security_audit_logs_user_created        | user_id, created_at     | No       | No       | btree    |
| pk_security_audit_logs                      | security_audit_log_uuid | Yes      | Yes      | btree    |
| uq_security_audit_logs_id                   | security_audit_log_id   | Yes      | No       | btree    |


---

### security_rate_limits

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 11  
**Foreign Keys**: 0  
**RLS Policies**: 1  
**Indexes**: 2

#### Columns

| Column                       | Type                     | Nullable | Default      |
| ---------------------------- | ------------------------ | -------- | ------------ |
| **security_rate_limit_uuid** | uuid                     | No       | UUID         |
| **security_rate_limit_id**   | integer                  | No       | None         |
| **operation_type**           | text                     | No       | None         |
| **identifier**               | text                     | No       | None         |
| **attempt_count**            | integer                  | No       | 1            |
| **window_start_at**          | timestamp with time zone | No       | Current Time |
| **last_attempt_at**          | timestamp with time zone | No       | Current Time |
| **is_blocked**               | boolean                  | No       | false        |
| **blocked_until_at**         | timestamp with time zone | Yes      | None         |
| **created_at**               | timestamp with time zone | No       | Current Time |
| **updated_at**               | timestamp with time zone | No       | Current Time |


**Primary Keys**: security_rate_limit_uuid



**Timestamps**: created_at, updated_at




#### Row Level Security Policies

**Admins can manage rate limits**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user_v2()  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                      | Columns                                     | Unique   | Primary  | Type     |
| ------------------------------- | ------------------------------------------- | -------- | -------- | -------- |
| idx_security_rate_limits_lookup | operation_type, identifier, window_start_at | No       | No       | btree    |
| security_rate_limits_pkey       | security_rate_limit_uuid                    | Yes      | Yes      | btree    |


---

### system_languages

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 6  
**Foreign Keys**: 0  
**RLS Policies**: 2  
**Indexes**: 2

#### Columns

| Column            | Type                     | Nullable | Default      |
| ----------------- | ------------------------ | -------- | ------------ |
| **language_code** | character(2)             | No       | None         |
| **language_name** | text                     | No       | None         |
| **is_default**    | boolean                  | No       | false        |
| **is_enabled**    | boolean                  | No       | true         |
| **created_at**    | timestamp with time zone | No       | Current Time |
| **updated_at**    | timestamp with time zone | No       | Current Time |




**Timestamps**: created_at, updated_at




#### Row Level Security Policies

**Admins can manage languages**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Authenticated users can view enabled languages**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (is_enabled = true)  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                   | Columns       | Unique   | Primary  | Type     |
| ---------------------------- | ------------- | -------- | -------- | -------- |
| idx_system_languages_default | is_default    | Yes      | No       | btree    |
| system_languages_pkey        | language_code | Yes      | Yes      | btree    |


---

### ui_translations

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 13  
**Foreign Keys**: 2  
**RLS Policies**: 2  
**Indexes**: 4

#### Columns

| Column                     | Type                     | Nullable | Default        |
| -------------------------- | ------------------------ | -------- | -------------- |
| **ui_translation_uuid**    | uuid                     | No       | UUID           |
| **ui_translation_id**      | integer                  | No       | None           |
| **ui_key**                 | text                     | No       | None           |
| **language_code_original** | character(2)             | No       | None           |
| **language_code_target**   | character(2)             | No       | None           |
| **source_field_name**      | text                     | No       | 'text'::text   |
| **original_text**          | text                     | No       | None           |
| **translated_text**        | text                     | Yes      | None           |
| **source**                 | text                     | No       | 'manual'::text |
| **created_at**             | timestamp with time zone | No       | Current Time   |
| **updated_at**             | timestamp with time zone | No       | Current Time   |
| **created_by**             | uuid                     | No       | None           |
| **updated_by**             | uuid                     | No       | None           |


**Primary Keys**: ui_translation_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column                 | References                            | Constraint Name                             |
| ---------------------- | ------------------------------------- | ------------------------------------------- |
| language_code_original | public.system_languages.language_code | ui_translations_language_code_original_fkey |
| language_code_target   | public.system_languages.language_code | ui_translations_language_code_target_fkey   |


#### Row Level Security Policies

**Admins can manage UI translations**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user()  
- **With Check Expression**: N/A  

**Authenticated users can view UI translations**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: true  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                 | Columns                                         | Unique   | Primary  | Type     |
| -------------------------- | ----------------------------------------------- | -------- | -------- | -------- |
| idx_ui_translations_lookup | ui_key, language_code_target                    | No       | No       | btree    |
| ui_translations_pkey       | ui_translation_uuid                             | Yes      | Yes      | btree    |
| ui_translations_unique     | ui_key, language_code_target, source_field_name | Yes      | No       | btree    |
| unique_ui_translation      | ui_key, language_code_target, source_field_name | Yes      | No       | btree    |


---

### user_accounts

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 20  
**Foreign Keys**: 1  
**RLS Policies**: 6  
**Indexes**: 6

#### Columns

| Column                         | Type                     | Nullable | Default              |
| ------------------------------ | ------------------------ | -------- | -------------------- |
| **user_uuid**                  | uuid                     | No       | UUID                 |
| **user_id**                    | integer                  | No       | None                 |
| **supabase_user_uuid**         | uuid                     | No       | None                 |
| **email**                      | text                     | No       | None                 |
| **first_name**                 | text                     | Yes      | None                 |
| **last_name**                  | text                     | Yes      | None                 |
| **created_at**                 | timestamp with time zone | No       | Current Time         |
| **approved_at**                | timestamp with time zone | Yes      | None                 |
| **approved_by**                | uuid                     | Yes      | None                 |
| **phone_number**               | text                     | Yes      | None                 |
| **timezone**                   | text                     | Yes      | 'UTC'::text          |
| **locale**                     | text                     | Yes      | 'en-US'::text        |
| **last_login_at**              | timestamp with time zone | Yes      | None                 |
| **password_changed_at**        | timestamp with time zone | Yes      | None                 |
| **failed_login_attempts**      | integer                  | Yes      | 0                    |
| **locked_until**               | timestamp with time zone | Yes      | None                 |
| **updated_at**                 | timestamp with time zone | Yes      | Current Time         |
| **user_status**                | USER-DEFINED             | No       | 'pending'::user_a... |
| **preferred_ui_language**      | character(2)             | Yes      | 'de'::bpchar         |
| **preferred_content_language** | character(2)             | Yes      | 'de'::bpchar         |


**Primary Keys**: user_uuid



**Timestamps**: created_at, updated_at


#### Foreign Key Relationships

| Column                | References                            | Constraint Name                          |
| --------------------- | ------------------------------------- | ---------------------------------------- |
| preferred_ui_language | public.system_languages.language_code | user_accounts_preferred_ui_language_fkey |


#### Row Level Security Policies

**Super admins can delete accounts**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: is_super_admin_user_secure()  
- **With Check Expression**: N/A  

**Super admins can update all accounts**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: is_super_admin_user_secure()  
- **With Check Expression**: N/A  

**Super admins can view all accounts**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: is_super_admin_user_secure()  
- **With Check Expression**: N/A  

**Users can insert own account only**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: N/A  
- **With Check Expression**: (auth.uid() = supabase_user_uuid)  

**Users can update own account only**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (auth.uid() = supabase_user_uuid)  
- **With Check Expression**: (auth.uid() = supabase_user_uuid)  

**Users can view own account only**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (auth.uid() = supabase_user_uuid)  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                          | Columns            | Unique   | Primary  | Type     |
| ----------------------------------- | ------------------ | -------- | -------- | -------- |
| idx_user_accounts_last_login        | last_login_at      | No       | No       | btree    |
| idx_user_accounts_status_enum       | user_status        | No       | No       | btree    |
| pk_user_accounts                    | user_uuid          | Yes      | Yes      | btree    |
| uq_user_accounts_email              | email              | Yes      | No       | btree    |
| uq_user_accounts_id                 | user_id            | Yes      | No       | btree    |
| uq_user_accounts_supabase_user_uuid | supabase_user_uuid | Yes      | No       | btree    |


---

### user_entity_access

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 13  
**Foreign Keys**: 4  
**RLS Policies**: 6  
**Indexes**: 7

#### Columns

| Column                      | Type                     | Nullable | Default      |
| --------------------------- | ------------------------ | -------- | ------------ |
| **user_entity_access_uuid** | uuid                     | No       | UUID         |
| **user_entity_access_id**   | integer                  | No       | None         |
| **user_uuid**               | uuid                     | No       | None         |
| **user_id**                 | integer                  | No       | None         |
| **entity_uuid**             | uuid                     | Yes      | None         |
| **entity_id**               | integer                  | Yes      | None         |
| **entity_group_uuid**       | uuid                     | Yes      | None         |
| **entity_group_id**         | integer                  | Yes      | None         |
| **access_level**            | USER-DEFINED             | No       | None         |
| **granted_by_user_uuid**    | uuid                     | Yes      | None         |
| **granted_at**              | timestamp with time zone | No       | Current Time |
| **revoked_at**              | timestamp with time zone | Yes      | None         |
| **is_active**               | boolean                  | No       | true         |


**Primary Keys**: user_entity_access_uuid, user_uuid, entity_uuid, entity_group_uuid, granted_by_user_uuid




#### Foreign Key Relationships

| Column               | References                             | Constraint Name                    |
| -------------------- | -------------------------------------- | ---------------------------------- |
| entity_group_uuid    | public.entity_groups.entity_group_uuid | fk_user_entity_access_entity_group |
| entity_uuid          | public.entities.entity_uuid            | fk_user_entity_access_entity       |
| granted_by_user_uuid | public.user_accounts.user_uuid         | fk_user_entity_access_granted_by   |
| user_uuid            | public.user_accounts.user_uuid         | fk_user_entity_access_user         |


#### Row Level Security Policies

**Entity admins can delete access grants in their scope v2**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (is_super_admin_user() OR is_entity_admin_for_scope(( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid())), entity_uuid, entity_group_uuid))  
- **With Check Expression**: N/A  

**Entity admins can insert access grants in their scope v2**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: N/A  
- **With Check Expression**: (is_super_admin_user() OR is_entity_admin_for_scope(( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid())), entity_uuid, entity_group_uuid))  

**Entity admins can update access grants in their scope v2**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (is_super_admin_user() OR is_entity_admin_for_scope(( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid())), entity_uuid, entity_group_uuid))  
- **With Check Expression**: N/A  

**Entity admins can view access grants in their scope v2**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: (is_super_admin_user() OR (user_uuid = ( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid()))) OR is_entity_admin_for_scope(( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid())), entity_uuid, entity_group_uuid))  
- **With Check Expression**: N/A  

**Super admins can manage all user entity access**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_super_admin_user()  
- **With Check Expression**: N/A  

**Users can view their own access grants**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (user_uuid = ( SELECT user_accounts.user_uuid
   FROM user_accounts
  WHERE (user_accounts.supabase_user_uuid = auth.uid())))  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                           | Columns                            | Unique   | Primary  | Type     |
| ------------------------------------ | ---------------------------------- | -------- | -------- | -------- |
| idx_user_entity_access_active_entity | user_uuid, entity_uuid             | Yes      | No       | btree    |
| idx_user_entity_access_active_group  | user_uuid, entity_group_uuid       | Yes      | No       | btree    |
| idx_user_entity_access_admin_lookup  | user_uuid, access_level, is_active | No       | No       | btree    |
| pk_user_entity_access                | user_entity_access_uuid            | Yes      | Yes      | btree    |
| uea_unique_active_entity             | user_uuid, entity_uuid             | Yes      | No       | btree    |
| uea_unique_active_entity_group       | user_uuid, entity_group_uuid       | Yes      | No       | btree    |
| uq_user_entity_access_id             | user_entity_access_id              | Yes      | No       | btree    |


---

### user_roles

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 8  
**Foreign Keys**: 2  
**RLS Policies**: 3  
**Indexes**: 4

#### Columns

| Column                            | Type                     | Nullable | Default            |
| --------------------------------- | ------------------------ | -------- | ------------------ |
| **user_role_uuid**                | uuid                     | No       | UUID               |
| **user_id**                       | uuid                     | No       | None               |
| **assigned_by**                   | uuid                     | Yes      | None               |
| **assigned_at**                   | timestamp with time zone | No       | Current Time       |
| **assigned_by_user_account_uuid** | uuid                     | Yes      | None               |
| **user_uuid**                     | uuid                     | Yes      | None               |
| **user_role_id**                  | integer                  | No       | None               |
| **role**                          | USER-DEFINED             | Yes      | 'viewer'::app_role |


**Primary Keys**: user_role_uuid, assigned_by_user_account_uuid, user_uuid




#### Foreign Key Relationships

| Column                        | References                     | Constraint Name                        |
| ----------------------------- | ------------------------------ | -------------------------------------- |
| assigned_by_user_account_uuid | public.user_accounts.user_uuid | fk_user_roles_assigned_by_user_account |
| user_uuid                     | public.user_accounts.user_uuid | fk_user_roles_user_account             |


#### Row Level Security Policies

**Admins can view all roles**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_admin_user_v2()  
- **With Check Expression**: N/A  

**Super admins can manage all roles**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: is_super_admin_user()  
- **With Check Expression**: N/A  

**Users can view their own roles**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: (user_id = auth.uid())  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                              | Columns                       | Unique   | Primary  | Type     |
| --------------------------------------- | ----------------------------- | -------- | -------- | -------- |
| idx_user_roles_assigned_by_user_account | assigned_by_user_account_uuid | No       | No       | btree    |
| idx_user_roles_user_account             | user_uuid                     | No       | No       | btree    |
| pk_user_roles                           | user_role_uuid                | Yes      | Yes      | btree    |
| uq_user_roles_id                        | user_role_id                  | Yes      | No       | btree    |


---

### user_session_logs

**Type**: BASE TABLE  
**Schema**: public  
**Columns**: 12  
**Foreign Keys**: 0  
**RLS Policies**: 4  
**Indexes**: 3

#### Columns

| Column                    | Type                     | Nullable | Default      |
| ------------------------- | ------------------------ | -------- | ------------ |
| **user_session_log_uuid** | uuid                     | No       | UUID         |
| **user_session_log_id**   | integer                  | No       | None         |
| **user_id**               | uuid                     | No       | None         |
| **session_token**         | text                     | No       | None         |
| **ip_address**            | inet                     | Yes      | None         |
| **user_agent**            | text                     | Yes      | None         |
| **created_at**            | timestamp with time zone | No       | Current Time |
| **expires_at**            | timestamp with time zone | No       | None         |
| **last_activity_at**      | timestamp with time zone | No       | Current Time |
| **ended_at**              | timestamp with time zone | Yes      | None         |
| **is_active**             | boolean                  | No       | true         |
| **session_metadata**      | jsonb                    | Yes      | '{}'::jsonb  |


**Primary Keys**: user_session_log_uuid



**Timestamps**: created_at




#### Row Level Security Policies

**Prevent all session log updates**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: false  
- **With Check Expression**: N/A  

**Super admins only can delete session logs**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: is_super_admin_user_secure()  
- **With Check Expression**: N/A  

**Super admins only can view session logs**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: is_super_admin_user_secure()  
- **With Check Expression**: N/A  

**System only can insert session logs**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: authenticated  
- **Using Expression**: N/A  
- **With Check Expression**: false  



#### Indexes

| Index Name                    | Columns               | Unique   | Primary  | Type     |
| ----------------------------- | --------------------- | -------- | -------- | -------- |
| idx_user_session_logs_active  | expires_at, is_active | No       | No       | btree    |
| idx_user_session_logs_user_id | user_id               | No       | No       | btree    |
| user_session_logs_pkey        | user_session_log_uuid | Yes      | Yes      | btree    |


---

### messages

**Type**: BASE TABLE  
**Schema**: realtime  
**Columns**: 8  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 0

#### Columns

| Column          | Type                        | Nullable | Default      |
| --------------- | --------------------------- | -------- | ------------ |
| **topic**       | text                        | No       | None         |
| **extension**   | text                        | No       | None         |
| **payload**     | jsonb                       | Yes      | None         |
| **event**       | text                        | Yes      | None         |
| **private**     | boolean                     | Yes      | false        |
| **updated_at**  | timestamp without time zone | No       | Current Time |
| **inserted_at** | timestamp without time zone | No       | Current Time |
| **id**          | uuid                        | No       | UUID         |




**Timestamps**: updated_at








---

### schema_migrations

**Type**: BASE TABLE  
**Schema**: realtime  
**Columns**: 8  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 4

#### Columns

| Column              | Type                        | Nullable | Default  |
| ------------------- | --------------------------- | -------- | -------- |
| **version**         | character varying(255)      | No       | None     |
| **version**         | bigint                      | No       | None     |
| **inserted_at**     | timestamp without time zone | Yes      | None     |
| **version**         | text                        | No       | None     |
| **statements**      | ARRAY                       | Yes      | None     |
| **name**            | text                        | Yes      | None     |
| **created_by**      | text                        | Yes      | None     |
| **idempotency_key** | text                        | Yes      | None     |









#### Indexes

| Index Name                            | Columns         | Unique   | Primary  | Type     |
| ------------------------------------- | --------------- | -------- | -------- | -------- |
| schema_migrations_pkey                | version         | Yes      | Yes      | btree    |
| schema_migrations_pkey                | version         | Yes      | Yes      | btree    |
| schema_migrations_idempotency_key_key | idempotency_key | Yes      | No       | btree    |
| schema_migrations_pkey                | version         | Yes      | Yes      | btree    |


---

### subscription

**Type**: BASE TABLE  
**Schema**: realtime  
**Columns**: 7  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 3

#### Columns

| Column              | Type                        | Nullable | Default              |
| ------------------- | --------------------------- | -------- | -------------------- |
| **id**              | bigint                      | No       | None                 |
| **subscription_id** | uuid                        | No       | None                 |
| **entity**          | regclass                    | No       | None                 |
| **filters**         | ARRAY                       | No       | '{}'::realtime.us... |
| **claims**          | jsonb                       | No       | None                 |
| **claims_role**     | regrole                     | No       | None                 |
| **created_at**      | timestamp without time zone | No       | Current Time         |




**Timestamps**: created_at






#### Indexes

| Index Name                                      | Columns                          | Unique   | Primary  | Type     |
| ----------------------------------------------- | -------------------------------- | -------- | -------- | -------- |
| ix_realtime_subscription_entity                 | entity                           | No       | No       | btree    |
| pk_subscription                                 | id                               | Yes      | Yes      | btree    |
| subscription_subscription_id_entity_filters_key | subscription_id, entity, filters | Yes      | No       | btree    |


---

### buckets

**Type**: BASE TABLE  
**Schema**: storage  
**Columns**: 11  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 2

#### Columns

| Column                 | Type                     | Nullable | Default              |
| ---------------------- | ------------------------ | -------- | -------------------- |
| **id**                 | text                     | No       | None                 |
| **name**               | text                     | No       | None                 |
| **owner**              | uuid                     | Yes      | None                 |
| **created_at**         | timestamp with time zone | Yes      | Current Time         |
| **updated_at**         | timestamp with time zone | Yes      | Current Time         |
| **public**             | boolean                  | Yes      | false                |
| **avif_autodetection** | boolean                  | Yes      | false                |
| **file_size_limit**    | bigint                   | Yes      | None                 |
| **allowed_mime_types** | ARRAY                    | Yes      | None                 |
| **owner_id**           | text                     | Yes      | None                 |
| **type**               | USER-DEFINED             | No       | 'STANDARD'::stora... |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name   | Columns  | Unique   | Primary  | Type     |
| ------------ | -------- | -------- | -------- | -------- |
| bname        | name     | Yes      | No       | btree    |
| buckets_pkey | id       | Yes      | Yes      | btree    |


---

### buckets_analytics

**Type**: BASE TABLE  
**Schema**: storage  
**Columns**: 5  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 1

#### Columns

| Column         | Type                     | Nullable | Default              |
| -------------- | ------------------------ | -------- | -------------------- |
| **id**         | text                     | No       | None                 |
| **type**       | USER-DEFINED             | No       | 'ANALYTICS'::stor... |
| **format**     | text                     | No       | 'ICEBERG'::text      |
| **created_at** | timestamp with time zone | No       | Current Time         |
| **updated_at** | timestamp with time zone | No       | Current Time         |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name             | Columns  | Unique   | Primary  | Type     |
| ---------------------- | -------- | -------- | -------- | -------- |
| buckets_analytics_pkey | id       | Yes      | Yes      | btree    |


---

### migrations

**Type**: BASE TABLE  
**Schema**: storage  
**Columns**: 4  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 2

#### Columns

| Column          | Type                        | Nullable | Default           |
| --------------- | --------------------------- | -------- | ----------------- |
| **id**          | integer                     | No       | None              |
| **name**        | character varying(100)      | No       | None              |
| **hash**        | character varying(40)       | No       | None              |
| **executed_at** | timestamp without time zone | Yes      | CURRENT_TIMESTAMP |









#### Indexes

| Index Name          | Columns  | Unique   | Primary  | Type     |
| ------------------- | -------- | -------- | -------- | -------- |
| migrations_name_key | name     | Yes      | No       | btree    |
| migrations_pkey     | id       | Yes      | Yes      | btree    |


---

### objects

**Type**: BASE TABLE  
**Schema**: storage  
**Columns**: 13  
**Foreign Keys**: 0  
**RLS Policies**: 22  
**Indexes**: 7

#### Columns

| Column               | Type                     | Nullable | Default      |
| -------------------- | ------------------------ | -------- | ------------ |
| **id**               | uuid                     | No       | UUID         |
| **bucket_id**        | text                     | Yes      | None         |
| **name**             | text                     | Yes      | None         |
| **owner**            | uuid                     | Yes      | None         |
| **created_at**       | timestamp with time zone | Yes      | Current Time |
| **updated_at**       | timestamp with time zone | Yes      | Current Time |
| **last_accessed_at** | timestamp with time zone | Yes      | Current Time |
| **metadata**         | jsonb                    | Yes      | None         |
| **path_tokens**      | ARRAY                    | Yes      | None         |
| **version**          | text                     | Yes      | None         |
| **owner_id**         | text                     | Yes      | None         |
| **user_metadata**    | jsonb                    | Yes      | None         |
| **level**            | integer                  | Yes      | None         |




**Timestamps**: created_at, updated_at




#### Row Level Security Policies

**Admins can delete database documentation files**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'database-docs'::text) AND is_admin_user_v2())  
- **With Check Expression**: N/A  

**Admins can delete report structure files**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'user-uploads-report-structures'::text) AND is_admin_user())  
- **With Check Expression**: N/A  

**Admins can manage all trial balance files**  
- **Command**: ALL  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'user-uploads-trial-balances'::text) AND is_admin_user())  
- **With Check Expression**: N/A  

**Admins can update database documentation files**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'database-docs'::text) AND is_admin_user_v2())  
- **With Check Expression**: N/A  

**Admins can update report structure files**  
- **Command**: UPDATE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'user-uploads-report-structures'::text) AND is_admin_user())  
- **With Check Expression**: N/A  

**Admins can upload database documentation files**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: ((bucket_id = 'database-docs'::text) AND is_admin_user_v2())  

**Admins can upload report structure files**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: ((bucket_id = 'user-uploads-report-structures'::text) AND is_admin_user())  

**Admins can view all report structure files**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'user-uploads-report-structures'::text) AND is_admin_user())  
- **With Check Expression**: N/A  

**Admins can view database documentation files**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'database-docs'::text) AND is_admin_user_v2())  
- **With Check Expression**: N/A  

**Super admins can delete old codebase docs**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'codebase-docs'::text) AND is_super_admin_user())  
- **With Check Expression**: N/A  

**Super admins can delete old export files**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'system-tools-deletions'::text) AND is_super_admin_user())  
- **With Check Expression**: N/A  

**Super admins can read from system-tools-deletions**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'system-tools-deletions'::text) AND is_super_admin_user_secure())  
- **With Check Expression**: N/A  

**Super admins can upload codebase docs**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: ((bucket_id = 'codebase-docs'::text) AND is_super_admin_user())  

**Super admins can upload deletion exports**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: ((bucket_id = 'system-tools-deletions'::text) AND is_super_admin_user())  

**Super admins can upload to system-tools-deletions**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: ((bucket_id = 'system-tools-deletions'::text) AND is_super_admin_user_secure())  

**Super admins can view codebase docs**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'codebase-docs'::text) AND is_super_admin_user())  
- **With Check Expression**: N/A  

**Super admins can view deletion exports**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'system-tools-deletions'::text) AND is_super_admin_user())  
- **With Check Expression**: N/A  

**Users can delete their own trial balance files**  
- **Command**: DELETE  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'user-uploads-trial-balances'::text) AND ((auth.uid())::text = (storage.foldername(name))[1]))  
- **With Check Expression**: N/A  

**Users can upload their own trial balance files**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: ((bucket_id = 'user-uploads-trial-balances'::text) AND ((auth.uid())::text = (storage.foldername(name))[1]))  

**Users can upload trial balance files**  
- **Command**: INSERT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: N/A  
- **With Check Expression**: ((bucket_id = 'user-uploads-trial-balances'::text) AND ((auth.uid())::text = (storage.foldername(name))[1]))  

**Users can view their own trial balance files**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'user-uploads-trial-balances'::text) AND ((auth.uid())::text = (storage.foldername(name))[1]))  
- **With Check Expression**: N/A  

**Users can view their trial balance files**  
- **Command**: SELECT  
- **Permissive**: PERMISSIVE  
- **Roles**: public  
- **Using Expression**: ((bucket_id = 'user-uploads-trial-balances'::text) AND ((auth.uid())::text = (storage.foldername(name))[1]))  
- **With Check Expression**: N/A  



#### Indexes

| Index Name                   | Columns                | Unique   | Primary  | Type     |
| ---------------------------- | ---------------------- | -------- | -------- | -------- |
| bucketid_objname             | bucket_id, name        | Yes      | No       | btree    |
| idx_name_bucket_level_unique | bucket_id, name, level | Yes      | No       | btree    |
| idx_objects_bucket_id_name   | bucket_id, name        | No       | No       | btree    |
| idx_objects_lower_name       | bucket_id, level       | No       | No       | btree    |
| name_prefix_search           | name                   | No       | No       | btree    |
| objects_bucket_id_level_idx  | bucket_id, name, level | Yes      | No       | btree    |
| objects_pkey                 | id                     | Yes      | Yes      | btree    |


---

### prefixes

**Type**: BASE TABLE  
**Schema**: storage  
**Columns**: 5  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 2

#### Columns

| Column         | Type                     | Nullable | Default      |
| -------------- | ------------------------ | -------- | ------------ |
| **bucket_id**  | text                     | No       | None         |
| **name**       | text                     | No       | None         |
| **level**      | integer                  | No       | None         |
| **created_at** | timestamp with time zone | Yes      | Current Time |
| **updated_at** | timestamp with time zone | Yes      | Current Time |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name              | Columns                | Unique   | Primary  | Type     |
| ----------------------- | ---------------------- | -------- | -------- | -------- |
| idx_prefixes_lower_name | bucket_id, level       | No       | No       | btree    |
| prefixes_pkey           | bucket_id, name, level | Yes      | Yes      | btree    |


---

### s3_multipart_uploads

**Type**: BASE TABLE  
**Schema**: storage  
**Columns**: 9  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 2

#### Columns

| Column               | Type                     | Nullable | Default      |
| -------------------- | ------------------------ | -------- | ------------ |
| **id**               | text                     | No       | None         |
| **in_progress_size** | bigint                   | No       | 0            |
| **upload_signature** | text                     | No       | None         |
| **bucket_id**        | text                     | No       | None         |
| **key**              | text                     | No       | None         |
| **version**          | text                     | No       | None         |
| **owner_id**         | text                     | Yes      | None         |
| **created_at**       | timestamp with time zone | No       | Current Time |
| **user_metadata**    | jsonb                    | Yes      | None         |




**Timestamps**: created_at






#### Indexes

| Index Name                 | Columns                    | Unique   | Primary  | Type     |
| -------------------------- | -------------------------- | -------- | -------- | -------- |
| idx_multipart_uploads_list | bucket_id, key, created_at | No       | No       | btree    |
| s3_multipart_uploads_pkey  | id                         | Yes      | Yes      | btree    |


---

### s3_multipart_uploads_parts

**Type**: BASE TABLE  
**Schema**: storage  
**Columns**: 10  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 1

#### Columns

| Column          | Type                     | Nullable | Default      |
| --------------- | ------------------------ | -------- | ------------ |
| **id**          | uuid                     | No       | UUID         |
| **upload_id**   | text                     | No       | None         |
| **size**        | bigint                   | No       | 0            |
| **part_number** | integer                  | No       | None         |
| **bucket_id**   | text                     | No       | None         |
| **key**         | text                     | No       | None         |
| **etag**        | text                     | No       | None         |
| **owner_id**    | text                     | Yes      | None         |
| **version**     | text                     | No       | None         |
| **created_at**  | timestamp with time zone | No       | Current Time |




**Timestamps**: created_at






#### Indexes

| Index Name                      | Columns  | Unique   | Primary  | Type     |
| ------------------------------- | -------- | -------- | -------- | -------- |
| s3_multipart_uploads_parts_pkey | id       | Yes      | Yes      | btree    |


---

### schema_migrations

**Type**: BASE TABLE  
**Schema**: supabase_migrations  
**Columns**: 8  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 4

#### Columns

| Column              | Type                        | Nullable | Default  |
| ------------------- | --------------------------- | -------- | -------- |
| **version**         | character varying(255)      | No       | None     |
| **version**         | bigint                      | No       | None     |
| **inserted_at**     | timestamp without time zone | Yes      | None     |
| **version**         | text                        | No       | None     |
| **statements**      | ARRAY                       | Yes      | None     |
| **name**            | text                        | Yes      | None     |
| **created_by**      | text                        | Yes      | None     |
| **idempotency_key** | text                        | Yes      | None     |









#### Indexes

| Index Name                            | Columns         | Unique   | Primary  | Type     |
| ------------------------------------- | --------------- | -------- | -------- | -------- |
| schema_migrations_pkey                | version         | Yes      | Yes      | btree    |
| schema_migrations_pkey                | version         | Yes      | Yes      | btree    |
| schema_migrations_idempotency_key_key | idempotency_key | Yes      | No       | btree    |
| schema_migrations_pkey                | version         | Yes      | Yes      | btree    |


---

### decrypted_secrets

**Type**: VIEW  
**Schema**: vault  
**Columns**: 9  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 0

#### Columns

| Column               | Type                     | Nullable | Default  |
| -------------------- | ------------------------ | -------- | -------- |
| **id**               | uuid                     | Yes      | None     |
| **name**             | text                     | Yes      | None     |
| **description**      | text                     | Yes      | None     |
| **secret**           | text                     | Yes      | None     |
| **decrypted_secret** | text                     | Yes      | None     |
| **key_id**           | uuid                     | Yes      | None     |
| **nonce**            | bytea                    | Yes      | None     |
| **created_at**       | timestamp with time zone | Yes      | None     |
| **updated_at**       | timestamp with time zone | Yes      | None     |




**Timestamps**: created_at, updated_at








---

### secrets

**Type**: BASE TABLE  
**Schema**: vault  
**Columns**: 8  
**Foreign Keys**: 0  
**RLS Policies**: 0  
**Indexes**: 2

#### Columns

| Column          | Type                     | Nullable | Default              |
| --------------- | ------------------------ | -------- | -------------------- |
| **id**          | uuid                     | No       | UUID                 |
| **name**        | text                     | Yes      | None                 |
| **description** | text                     | No       | ''::text             |
| **secret**      | text                     | No       | None                 |
| **key_id**      | uuid                     | Yes      | None                 |
| **nonce**       | bytea                    | Yes      | vault._crypto_aea... |
| **created_at**  | timestamp with time zone | No       | CURRENT_TIMESTAMP    |
| **updated_at**  | timestamp with time zone | No       | CURRENT_TIMESTAMP    |




**Timestamps**: created_at, updated_at






#### Indexes

| Index Name       | Columns  | Unique   | Primary  | Type     |
| ---------------- | -------- | -------- | -------- | -------- |
| secrets_name_idx | name     | Yes      | No       | btree    |
| secrets_pkey     | id       | Yes      | Yes      | btree    |


---


## Constraints and Validation Rules

Database constraints ensure data integrity and enforce business rules at the database level:

### CHECK Constraints

| Table                              | Constraint Name                                | Column             | Details  |
| ---------------------------------- | ---------------------------------------------- | ------------------ | -------- |
| **audit_log_entries**              | 16492_16523_2_not_null                         | Multiple           | N/A      |
| **audit_log_entries**              | 16492_16523_5_not_null                         | Multiple           | N/A      |
| **flow_state**                     | 16492_16925_11_not_null                        | Multiple           | N/A      |
| **flow_state**                     | 16492_16925_1_not_null                         | Multiple           | N/A      |
| **flow_state**                     | 16492_16925_3_not_null                         | Multiple           | N/A      |
| **flow_state**                     | 16492_16925_4_not_null                         | Multiple           | N/A      |
| **flow_state**                     | 16492_16925_5_not_null                         | Multiple           | N/A      |
| **flow_state**                     | 16492_16925_6_not_null                         | Multiple           | N/A      |
| **identities**                     | 16492_16723_1_not_null                         | Multiple           | N/A      |
| **identities**                     | 16492_16723_2_not_null                         | Multiple           | N/A      |
| **identities**                     | 16492_16723_3_not_null                         | Multiple           | N/A      |
| **identities**                     | 16492_16723_4_not_null                         | Multiple           | N/A      |
| **identities**                     | 16492_16723_9_not_null                         | Multiple           | N/A      |
| **instances**                      | 16492_16516_1_not_null                         | Multiple           | N/A      |
| **mfa_amr_claims**                 | 16492_16812_1_not_null                         | Multiple           | N/A      |
| **mfa_amr_claims**                 | 16492_16812_2_not_null                         | Multiple           | N/A      |
| **mfa_amr_claims**                 | 16492_16812_3_not_null                         | Multiple           | N/A      |
| **mfa_amr_claims**                 | 16492_16812_4_not_null                         | Multiple           | N/A      |
| **mfa_amr_claims**                 | 16492_16812_5_not_null                         | Multiple           | N/A      |
| **mfa_challenges**                 | 16492_16800_1_not_null                         | Multiple           | N/A      |
| **mfa_challenges**                 | 16492_16800_2_not_null                         | Multiple           | N/A      |
| **mfa_challenges**                 | 16492_16800_3_not_null                         | Multiple           | N/A      |
| **mfa_challenges**                 | 16492_16800_5_not_null                         | Multiple           | N/A      |
| **mfa_factors**                    | 16492_16787_1_not_null                         | Multiple           | N/A      |
| **mfa_factors**                    | 16492_16787_2_not_null                         | Multiple           | N/A      |
| **mfa_factors**                    | 16492_16787_4_not_null                         | Multiple           | N/A      |
| **mfa_factors**                    | 16492_16787_5_not_null                         | Multiple           | N/A      |
| **mfa_factors**                    | 16492_16787_6_not_null                         | Multiple           | N/A      |
| **mfa_factors**                    | 16492_16787_7_not_null                         | Multiple           | N/A      |
| **oauth_clients**                  | 16492_59759_10_not_null                        | Multiple           | N/A      |
| **oauth_clients**                  | 16492_59759_11_not_null                        | Multiple           | N/A      |
| **oauth_clients**                  | 16492_59759_1_not_null                         | Multiple           | N/A      |
| **oauth_clients**                  | 16492_59759_2_not_null                         | Multiple           | N/A      |
| **oauth_clients**                  | 16492_59759_3_not_null                         | Multiple           | N/A      |
| **oauth_clients**                  | 16492_59759_4_not_null                         | Multiple           | N/A      |
| **oauth_clients**                  | 16492_59759_5_not_null                         | Multiple           | N/A      |
| **oauth_clients**                  | 16492_59759_6_not_null                         | Multiple           | N/A      |
| **oauth_clients**                  | oauth_clients_client_name_length               | Multiple           | N/A      |
| **oauth_clients**                  | oauth_clients_client_uri_length                | Multiple           | N/A      |
| **oauth_clients**                  | oauth_clients_logo_uri_length                  | Multiple           | N/A      |
| **one_time_tokens**                | 16492_16975_1_not_null                         | Multiple           | N/A      |
| **one_time_tokens**                | 16492_16975_2_not_null                         | Multiple           | N/A      |
| **one_time_tokens**                | 16492_16975_3_not_null                         | Multiple           | N/A      |
| **one_time_tokens**                | 16492_16975_4_not_null                         | Multiple           | N/A      |
| **one_time_tokens**                | 16492_16975_5_not_null                         | Multiple           | N/A      |
| **one_time_tokens**                | 16492_16975_6_not_null                         | Multiple           | N/A      |
| **one_time_tokens**                | 16492_16975_7_not_null                         | Multiple           | N/A      |
| **one_time_tokens**                | one_time_tokens_token_hash_check               | Multiple           | N/A      |
| **refresh_tokens**                 | 16492_16505_2_not_null                         | Multiple           | N/A      |
| **saml_providers**                 | 16492_16854_1_not_null                         | Multiple           | N/A      |
| **saml_providers**                 | 16492_16854_2_not_null                         | Multiple           | N/A      |
| **saml_providers**                 | 16492_16854_3_not_null                         | Multiple           | N/A      |
| **saml_providers**                 | 16492_16854_4_not_null                         | Multiple           | N/A      |
| **saml_providers**                 | entity_id not empty                            | Multiple           | N/A      |
| **saml_providers**                 | metadata_url not empty                         | Multiple           | N/A      |
| **saml_providers**                 | metadata_xml not empty                         | Multiple           | N/A      |
| **saml_relay_states**              | 16492_16872_1_not_null                         | Multiple           | N/A      |
| **saml_relay_states**              | 16492_16872_2_not_null                         | Multiple           | N/A      |
| **saml_relay_states**              | 16492_16872_3_not_null                         | Multiple           | N/A      |
| **saml_relay_states**              | request_id not empty                           | Multiple           | N/A      |
| **sessions**                       | 16492_16753_1_not_null                         | Multiple           | N/A      |
| **sessions**                       | 16492_16753_2_not_null                         | Multiple           | N/A      |
| **sso_domains**                    | 16492_16839_1_not_null                         | Multiple           | N/A      |
| **sso_domains**                    | 16492_16839_2_not_null                         | Multiple           | N/A      |
| **sso_domains**                    | 16492_16839_3_not_null                         | Multiple           | N/A      |
| **sso_domains**                    | domain not empty                               | Multiple           | N/A      |
| **sso_providers**                  | 16492_16830_1_not_null                         | Multiple           | N/A      |
| **sso_providers**                  | resource_id not empty                          | Multiple           | N/A      |
| **users**                          | 16492_16493_2_not_null                         | Multiple           | N/A      |
| **users**                          | 16492_16493_33_not_null                        | Multiple           | N/A      |
| **users**                          | 16492_16493_35_not_null                        | Multiple           | N/A      |
| **users**                          | users_email_change_confirm_status_check        | Multiple           | N/A      |
| **trial_balance_uploads**          | 85414_85577_10_not_null                        | Multiple           | perio... |
| **trial_balance_uploads**          | 85414_85577_11_not_null                        | Multiple           | perio... |
| **trial_balance_uploads**          | 85414_85577_12_not_null                        | Multiple           | perio... |
| **trial_balance_uploads**          | 85414_85577_13_not_null                        | Multiple           | as_of... |
| **trial_balance_uploads**          | 85414_85577_14_not_null                        | Multiple           | amoun... |
| **trial_balance_uploads**          | 85414_85577_15_not_null                        | Multiple           | curre... |
| **trial_balance_uploads**          | 85414_85577_16_not_null                        | Multiple           | sourc... |
| **trial_balance_uploads**          | 85414_85577_17_not_null                        | Multiple           | sourc... |
| **trial_balance_uploads**          | 85414_85577_18_not_null                        | Multiple           | sourc... |
| **trial_balance_uploads**          | 85414_85577_19_not_null                        | Multiple           | sourc... |
| **trial_balance_uploads**          | 85414_85577_1_not_null                         | Multiple           | trial... |
| **trial_balance_uploads**          | 85414_85577_20_not_null                        | Multiple           | creat... |
| **trial_balance_uploads**          | 85414_85577_21_not_null                        | Multiple           | updat... |
| **trial_balance_uploads**          | 85414_85577_22_not_null                        | Multiple           | trial... |
| **trial_balance_uploads**          | 85414_85577_2_not_null                         | Multiple           | entit... |
| **trial_balance_uploads**          | 85414_85577_3_not_null                         | Multiple           | accou... |
| **trial_balance_uploads**          | 85414_85577_5_not_null                         | Multiple           | accou... |
| **trial_balance_uploads**          | 85414_85577_6_not_null                         | Multiple           | amoun... |
| **trial_balance_uploads**          | 85414_85577_7_not_null                         | Multiple           | amoun... |
| **trial_balance_uploads**          | 85414_85577_9_not_null                         | Multiple           | aggre... |
| **coa_translation_sessions**       | 2200_35528_10_not_null                         | Multiple           | statu... |
| **coa_translation_sessions**       | 2200_35528_11_not_null                         | Multiple           | creat... |
| **coa_translation_sessions**       | 2200_35528_13_not_null                         | Multiple           | updat... |
| **coa_translation_sessions**       | 2200_35528_19_not_null                         | Multiple           | statu... |
| **coa_translation_sessions**       | 2200_35528_1_not_null                          | Multiple           | coa_t... |
| **coa_translation_sessions**       | 2200_35528_20_not_null                         | Multiple           | coa_t... |
| **coa_translation_sessions**       | 2200_35528_2_not_null                          | Multiple           | sessi... |
| **coa_translation_sessions**       | 2200_35528_3_not_null                          | Multiple           | user_... |
| **coa_translation_sessions**       | 2200_35528_4_not_null                          | Multiple           | filen... |
| **coa_translation_sessions**       | 2200_35528_5_not_null                          | Multiple           | total... |
| **coa_translation_sessions**       | 2200_35528_8_not_null                          | Multiple           | targe... |
| **coa_translation_sessions**       | 2200_35528_9_not_null                          | Multiple           | sessi... |
| **coa_translation_sessions**       | coa_translation_sessions_status_check          | status             | (stat... |
| **entities**                       | 2200_49146_10_not_null                         | Multiple           | updat... |
| **entities**                       | 2200_49146_1_not_null                          | Multiple           | entit... |
| **entities**                       | 2200_49146_2_not_null                          | Multiple           | entit... |
| **entities**                       | 2200_49146_3_not_null                          | Multiple           | entit... |
| **entities**                       | 2200_49146_4_not_null                          | Multiple           | entit... |
| **entities**                       | 2200_49146_5_not_null                          | Multiple           | entit... |
| **entities**                       | 2200_49146_6_not_null                          | Multiple           | entit... |
| **entities**                       | 2200_49146_8_not_null                          | Multiple           | is_ac... |
| **entities**                       | 2200_49146_9_not_null                          | Multiple           | creat... |
| **entity_groups**                  | 2200_49125_1_not_null                          | Multiple           | entit... |
| **entity_groups**                  | 2200_49125_2_not_null                          | Multiple           | entit... |
| **entity_groups**                  | 2200_49125_3_not_null                          | Multiple           | entit... |
| **entity_groups**                  | 2200_49125_4_not_null                          | Multiple           | entit... |
| **entity_groups**                  | 2200_49125_6_not_null                          | Multiple           | is_ac... |
| **entity_groups**                  | 2200_49125_7_not_null                          | Multiple           | creat... |
| **entity_groups**                  | 2200_49125_8_not_null                          | Multiple           | updat... |
| **report_line_items**              | 2200_28522_11_not_null                         | Multiple           | sort_... |
| **report_line_items**              | 2200_28522_1_not_null                          | Multiple           | repor... |
| **report_line_items**              | 2200_28522_2_not_null                          | Multiple           | repor... |
| **report_line_items**              | 2200_28522_4_not_null                          | Multiple           | repor... |
| **report_line_items**              | 2200_28522_5_not_null                          | Multiple           | repor... |
| **report_line_items**              | 2200_28522_6_not_null                          | Multiple           | repor... |
| **report_line_items**              | 2200_28522_7_not_null                          | Multiple           | repor... |
| **report_line_items_translations** | 2200_57305_10_not_null                         | Multiple           | creat... |
| **report_line_items_translations** | 2200_57305_11_not_null                         | Multiple           | updat... |
| **report_line_items_translations** | 2200_57305_12_not_null                         | Multiple           | langu... |
| **report_line_items_translations** | 2200_57305_13_not_null                         | Multiple           | origi... |
| **report_line_items_translations** | 2200_57305_1_not_null                          | Multiple           | repor... |
| **report_line_items_translations** | 2200_57305_2_not_null                          | Multiple           | repor... |
| **report_line_items_translations** | 2200_57305_3_not_null                          | Multiple           | repor... |
| **report_line_items_translations** | 2200_57305_4_not_null                          | Multiple           | langu... |
| **report_line_items_translations** | 2200_57305_5_not_null                          | Multiple           | sourc... |
| **report_line_items_translations** | 2200_57305_7_not_null                          | Multiple           | sourc... |
| **report_line_items_translations** | 2200_57305_8_not_null                          | Multiple           | creat... |
| **report_line_items_translations** | 2200_57305_9_not_null                          | Multiple           | updat... |
| **report_line_items_translations** | report_line_items_translations_field_key_check | source_field_name  | ((sou... |
| **report_line_items_translations** | report_line_items_translations_source_check    | source             | (sour... |
| **report_structure_change_logs**   | 2200_27322_11_not_null                         | Multiple           | actio... |
| **report_structure_change_logs**   | 2200_27322_12_not_null                         | Multiple           | line_... |
| **report_structure_change_logs**   | 2200_27322_16_not_null                         | Multiple           | times... |
| **report_structure_change_logs**   | 2200_27322_17_not_null                         | Multiple           | is_un... |
| **report_structure_change_logs**   | 2200_27322_1_not_null                          | Multiple           | chang... |
| **report_structure_change_logs**   | 2200_27322_2_not_null                          | Multiple           | chang... |
| **report_structure_change_logs**   | 2200_27322_3_not_null                          | Multiple           | user_... |
| **report_structure_change_logs**   | 2200_27322_7_not_null                          | Multiple           | struc... |
| **report_structure_change_logs**   | 2200_27322_8_not_null                          | Multiple           | struc... |
| **report_structures**              | 2200_28507_18_not_null                         | Multiple           | lifec... |
| **report_structures**              | 2200_28507_1_not_null                          | Multiple           | repor... |
| **report_structures**              | 2200_28507_2_not_null                          | Multiple           | repor... |
| **report_structures**              | 2200_28507_3_not_null                          | Multiple           | repor... |
| **report_structures**              | 2200_28507_4_not_null                          | Multiple           | is_ac... |
| **report_structures**              | 2200_28507_5_not_null                          | Multiple           | creat... |
| **report_structures**              | 2200_28507_6_not_null                          | Multiple           | updat... |
| **report_structures**              | 2200_28507_7_not_null                          | Multiple           | creat... |
| **report_structures**              | 2200_28507_8_not_null                          | Multiple           | creat... |
| **report_structures**              | 2200_28507_9_not_null                          | Multiple           | versi... |
| **report_structures_translations** | 2200_57265_10_not_null                         | Multiple           | creat... |
| **report_structures_translations** | 2200_57265_11_not_null                         | Multiple           | updat... |
| **report_structures_translations** | 2200_57265_12_not_null                         | Multiple           | langu... |
| **report_structures_translations** | 2200_57265_13_not_null                         | Multiple           | origi... |
| **report_structures_translations** | 2200_57265_1_not_null                          | Multiple           | repor... |
| **report_structures_translations** | 2200_57265_2_not_null                          | Multiple           | repor... |
| **report_structures_translations** | 2200_57265_3_not_null                          | Multiple           | repor... |
| **report_structures_translations** | 2200_57265_4_not_null                          | Multiple           | langu... |
| **report_structures_translations** | 2200_57265_5_not_null                          | Multiple           | sourc... |
| **report_structures_translations** | 2200_57265_7_not_null                          | Multiple           | sourc... |
| **report_structures_translations** | 2200_57265_8_not_null                          | Multiple           | creat... |
| **report_structures_translations** | 2200_57265_9_not_null                          | Multiple           | updat... |
| **report_structures_translations** | report_structures_translations_field_key_check | source_field_name  | (sour... |
| **report_structures_translations** | report_structures_translations_source_check    | source             | (sour... |
| **security_audit_logs**            | 2200_41112_11_not_null                         | Multiple           | secur... |
| **security_audit_logs**            | 2200_41112_1_not_null                          | Multiple           | secur... |
| **security_audit_logs**            | 2200_41112_3_not_null                          | Multiple           | actio... |
| **security_audit_logs**            | 2200_41112_8_not_null                          | Multiple           | creat... |
| **security_rate_limits**           | 2200_52774_10_not_null                         | Multiple           | creat... |
| **security_rate_limits**           | 2200_52774_11_not_null                         | Multiple           | updat... |
| **security_rate_limits**           | 2200_52774_1_not_null                          | Multiple           | secur... |
| **security_rate_limits**           | 2200_52774_2_not_null                          | Multiple           | secur... |
| **security_rate_limits**           | 2200_52774_3_not_null                          | Multiple           | opera... |
| **security_rate_limits**           | 2200_52774_4_not_null                          | Multiple           | ident... |
| **security_rate_limits**           | 2200_52774_5_not_null                          | Multiple           | attem... |
| **security_rate_limits**           | 2200_52774_6_not_null                          | Multiple           | windo... |
| **security_rate_limits**           | 2200_52774_7_not_null                          | Multiple           | last_... |
| **security_rate_limits**           | 2200_52774_8_not_null                          | Multiple           | is_bl... |
| **system_languages**               | 2200_57251_1_not_null                          | Multiple           | langu... |
| **system_languages**               | 2200_57251_2_not_null                          | Multiple           | langu... |
| **system_languages**               | 2200_57251_3_not_null                          | Multiple           | is_de... |
| **system_languages**               | 2200_57251_4_not_null                          | Multiple           | is_en... |
| **system_languages**               | 2200_57251_5_not_null                          | Multiple           | creat... |
| **system_languages**               | 2200_57251_6_not_null                          | Multiple           | updat... |
| **system_languages**               | system_languages_language_code_check           | language_code      | (lang... |
| **ui_translations**                | 2200_58548_10_not_null                         | Multiple           | creat... |
| **ui_translations**                | 2200_58548_11_not_null                         | Multiple           | updat... |
| **ui_translations**                | 2200_58548_12_not_null                         | Multiple           | creat... |
| **ui_translations**                | 2200_58548_13_not_null                         | Multiple           | updat... |
| **ui_translations**                | 2200_58548_1_not_null                          | Multiple           | ui_tr... |
| **ui_translations**                | 2200_58548_2_not_null                          | Multiple           | ui_tr... |
| **ui_translations**                | 2200_58548_3_not_null                          | Multiple           | ui_ke... |
| **ui_translations**                | 2200_58548_4_not_null                          | Multiple           | langu... |
| **ui_translations**                | 2200_58548_5_not_null                          | Multiple           | langu... |
| **ui_translations**                | 2200_58548_6_not_null                          | Multiple           | sourc... |
| **ui_translations**                | 2200_58548_7_not_null                          | Multiple           | origi... |
| **ui_translations**                | 2200_58548_9_not_null                          | Multiple           | sourc... |
| **ui_translations**                | ui_translations_source_check                   | source             | (sour... |
| **user_accounts**                  | 2200_35478_19_not_null                         | Multiple           | user_... |
| **user_accounts**                  | 2200_35478_1_not_null                          | Multiple           | user_... |
| **user_accounts**                  | 2200_35478_2_not_null                          | Multiple           | user_... |
| **user_accounts**                  | 2200_35478_3_not_null                          | Multiple           | supab... |
| **user_accounts**                  | 2200_35478_4_not_null                          | Multiple           | email... |
| **user_accounts**                  | 2200_35478_8_not_null                          | Multiple           | creat... |
| **user_accounts**                  | check_supabase_user_uuid_not_null              | supabase_user_uuid | (supa... |
| **user_entity_access**             | 2200_49178_11_not_null                         | Multiple           | grant... |
| **user_entity_access**             | 2200_49178_13_not_null                         | Multiple           | is_ac... |
| **user_entity_access**             | 2200_49178_1_not_null                          | Multiple           | user_... |
| **user_entity_access**             | 2200_49178_2_not_null                          | Multiple           | user_... |
| **user_entity_access**             | 2200_49178_3_not_null                          | Multiple           | user_... |
| **user_entity_access**             | 2200_49178_4_not_null                          | Multiple           | user_... |
| **user_entity_access**             | 2200_49178_9_not_null                          | Multiple           | acces... |
| **user_entity_access**             | chk_entity_or_group                            | entity_group_uuid  | (((en... |
| **user_entity_access**             | chk_entity_or_group                            | entity_uuid        | (((en... |
| **user_roles**                     | 2200_41085_1_not_null                          | Multiple           | user_... |
| **user_roles**                     | 2200_41085_2_not_null                          | Multiple           | user_... |
| **user_roles**                     | 2200_41085_5_not_null                          | Multiple           | assig... |
| **user_roles**                     | 2200_41085_8_not_null                          | Multiple           | user_... |
| **user_session_logs**              | 2200_52761_11_not_null                         | Multiple           | is_ac... |
| **user_session_logs**              | 2200_52761_1_not_null                          | Multiple           | user_... |
| **user_session_logs**              | 2200_52761_2_not_null                          | Multiple           | user_... |
| **user_session_logs**              | 2200_52761_3_not_null                          | Multiple           | user_... |
| **user_session_logs**              | 2200_52761_4_not_null                          | Multiple           | sessi... |
| **user_session_logs**              | 2200_52761_7_not_null                          | Multiple           | creat... |
| **user_session_logs**              | 2200_52761_8_not_null                          | Multiple           | expir... |
| **user_session_logs**              | 2200_52761_9_not_null                          | Multiple           | last_... |
| **messages**                       | 16603_17253_10_not_null                        | Multiple           | id IS... |
| **messages**                       | 16603_17253_3_not_null                         | Multiple           | topic... |
| **messages**                       | 16603_17253_4_not_null                         | Multiple           | exten... |
| **messages**                       | 16603_17253_8_not_null                         | Multiple           | updat... |
| **messages**                       | 16603_17253_9_not_null                         | Multiple           | inser... |
| **schema_migrations**              | 16603_17000_1_not_null                         | Multiple           | N/A      |
| **subscription**                   | 16603_17107_1_not_null                         | Multiple           | N/A      |
| **subscription**                   | 16603_17107_2_not_null                         | Multiple           | N/A      |
| **subscription**                   | 16603_17107_4_not_null                         | Multiple           | N/A      |
| **subscription**                   | 16603_17107_5_not_null                         | Multiple           | N/A      |
| **subscription**                   | 16603_17107_7_not_null                         | Multiple           | N/A      |
| **subscription**                   | 16603_17107_8_not_null                         | Multiple           | N/A      |
| **subscription**                   | 16603_17107_9_not_null                         | Multiple           | N/A      |
| **buckets**                        | 16540_16544_11_not_null                        | Multiple           | N/A      |
| **buckets**                        | 16540_16544_1_not_null                         | Multiple           | N/A      |
| **buckets**                        | 16540_16544_2_not_null                         | Multiple           | N/A      |
| **buckets_analytics**              | 16540_50502_1_not_null                         | Multiple           | N/A      |
| **buckets_analytics**              | 16540_50502_2_not_null                         | Multiple           | N/A      |
| **buckets_analytics**              | 16540_50502_3_not_null                         | Multiple           | N/A      |
| **buckets_analytics**              | 16540_50502_4_not_null                         | Multiple           | N/A      |
| **buckets_analytics**              | 16540_50502_5_not_null                         | Multiple           | N/A      |
| **objects**                        | 16540_16559_1_not_null                         | Multiple           | N/A      |
| **prefixes**                       | 16540_50457_1_not_null                         | Multiple           | N/A      |
| **prefixes**                       | 16540_50457_2_not_null                         | Multiple           | N/A      |
| **prefixes**                       | 16540_50457_3_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads**           | 16540_17037_1_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads**           | 16540_17037_2_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads**           | 16540_17037_3_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads**           | 16540_17037_4_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads**           | 16540_17037_5_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads**           | 16540_17037_6_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads**           | 16540_17037_8_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads_parts**     | 16540_17051_10_not_null                        | Multiple           | N/A      |
| **s3_multipart_uploads_parts**     | 16540_17051_1_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads_parts**     | 16540_17051_2_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads_parts**     | 16540_17051_3_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads_parts**     | 16540_17051_4_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads_parts**     | 16540_17051_5_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads_parts**     | 16540_17051_6_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads_parts**     | 16540_17051_7_not_null                         | Multiple           | N/A      |
| **s3_multipart_uploads_parts**     | 16540_17051_9_not_null                         | Multiple           | N/A      |
| **schema_migrations**              | 17269_17270_1_not_null                         | Multiple           | versi... |
| **secrets**                        | 16651_16656_1_not_null                         | Multiple           | N/A      |
| **secrets**                        | 16651_16656_3_not_null                         | Multiple           | N/A      |
| **secrets**                        | 16651_16656_4_not_null                         | Multiple           | N/A      |
| **secrets**                        | 16651_16656_7_not_null                         | Multiple           | N/A      |
| **secrets**                        | 16651_16656_8_not_null                         | Multiple           | N/A      |

**Count**: 284 constraints of this type

### PRIMARY KEY Constraints

| Table                              | Constraint Name                     | Column                            | Details  |
| ---------------------------------- | ----------------------------------- | --------------------------------- | -------- |
| **audit_log_entries**              | audit_log_entries_pkey              | id                                | prima... |
| **flow_state**                     | flow_state_pkey                     | id                                | prima... |
| **identities**                     | identities_pkey                     | id                                | prima... |
| **instances**                      | instances_pkey                      | id                                | prima... |
| **mfa_amr_claims**                 | amr_id_pk                           | id                                | prima... |
| **mfa_challenges**                 | mfa_challenges_pkey                 | id                                | prima... |
| **mfa_factors**                    | mfa_factors_pkey                    | id                                | prima... |
| **oauth_clients**                  | oauth_clients_pkey                  | id                                | prima... |
| **one_time_tokens**                | one_time_tokens_pkey                | id                                | prima... |
| **refresh_tokens**                 | refresh_tokens_pkey                 | id                                | prima... |
| **saml_providers**                 | saml_providers_pkey                 | id                                | prima... |
| **saml_relay_states**              | saml_relay_states_pkey              | id                                | prima... |
| **sessions**                       | sessions_pkey                       | id                                | prima... |
| **sso_domains**                    | sso_domains_pkey                    | id                                | prima... |
| **sso_providers**                  | sso_providers_pkey                  | id                                | prima... |
| **users**                          | users_pkey                          | id                                | prima... |
| **trial_balance_uploads**          | trial_balances_uploaded_pkey        | trial_balance_upload_uuid         | prima... |
| **coa_translation_sessions**       | pk_coa_translation_sessions         | coa_translation_session_uuid      | prima... |
| **entities**                       | pk_entities                         | entity_uuid                       | prima... |
| **entity_groups**                  | pk_entity_groups                    | entity_group_uuid                 | prima... |
| **report_line_items**              | pk_report_line_items                | report_line_item_uuid             | prima... |
| **report_line_items_translations** | report_line_items_translations_pkey | report_line_item_translation_uuid | prima... |
| **report_structure_change_logs**   | pk_report_structure_change_logs     | change_uuid                       | prima... |
| **report_structures**              | pk_report_structures                | report_structure_uuid             | prima... |
| **report_structures_translations** | report_structures_translations_pkey | report_structure_translation_uuid | prima... |
| **security_audit_logs**            | pk_security_audit_logs              | security_audit_log_uuid           | prima... |
| **security_rate_limits**           | security_rate_limits_pkey           | security_rate_limit_uuid          | prima... |
| **system_languages**               | system_languages_pkey               | language_code                     | prima... |
| **ui_translations**                | ui_translations_pkey                | ui_translation_uuid               | prima... |
| **user_accounts**                  | pk_user_accounts                    | user_uuid                         | prima... |
| **user_entity_access**             | pk_user_entity_access               | user_entity_access_uuid           | prima... |
| **user_roles**                     | pk_user_roles                       | user_role_uuid                    | prima... |
| **user_session_logs**              | user_session_logs_pkey              | user_session_log_uuid             | prima... |
| **messages**                       | messages_pkey                       | id                                | prima... |
| **messages**                       | messages_pkey                       | id                                | prima... |
| **messages**                       | messages_pkey                       | inserted_at                       | prima... |
| **messages**                       | messages_pkey                       | inserted_at                       | prima... |
| **schema_migrations**              | schema_migrations_pkey              | version                           | prima... |
| **subscription**                   | pk_subscription                     | id                                | prima... |
| **buckets**                        | buckets_pkey                        | id                                | prima... |
| **buckets_analytics**              | buckets_analytics_pkey              | id                                | prima... |
| **objects**                        | objects_pkey                        | id                                | prima... |
| **prefixes**                       | prefixes_pkey                       | name                              | prima... |
| **prefixes**                       | prefixes_pkey                       | bucket_id                         | prima... |
| **prefixes**                       | prefixes_pkey                       | level                             | prima... |
| **s3_multipart_uploads**           | s3_multipart_uploads_pkey           | id                                | prima... |
| **s3_multipart_uploads_parts**     | s3_multipart_uploads_parts_pkey     | id                                | prima... |
| **schema_migrations**              | schema_migrations_pkey              | version                           | prima... |
| **secrets**                        | secrets_pkey                        | id                                | prima... |

**Count**: 49 constraints of this type

### FOREIGN KEY Constraints

| Table                              | Constraint Name                                    | Column                        | Details  |
| ---------------------------------- | -------------------------------------------------- | ----------------------------- | -------- |
| **identities**                     | identities_user_id_fkey                            | user_id                       | Refer... |
| **mfa_amr_claims**                 | mfa_amr_claims_session_id_fkey                     | session_id                    | Refer... |
| **mfa_challenges**                 | mfa_challenges_auth_factor_id_fkey                 | factor_id                     | Refer... |
| **mfa_factors**                    | mfa_factors_user_id_fkey                           | user_id                       | Refer... |
| **one_time_tokens**                | one_time_tokens_user_id_fkey                       | user_id                       | Refer... |
| **refresh_tokens**                 | refresh_tokens_session_id_fkey                     | session_id                    | Refer... |
| **saml_providers**                 | saml_providers_sso_provider_id_fkey                | sso_provider_id               | Refer... |
| **saml_relay_states**              | saml_relay_states_flow_state_id_fkey               | flow_state_id                 | Refer... |
| **saml_relay_states**              | saml_relay_states_sso_provider_id_fkey             | sso_provider_id               | Refer... |
| **sessions**                       | sessions_user_id_fkey                              | user_id                       | Refer... |
| **sso_domains**                    | sso_domains_sso_provider_id_fkey                   | sso_provider_id               | Refer... |
| **coa_translation_sessions**       | coa_translation_sessions_user_id_fkey              | user_id                       | Refer... |
| **coa_translation_sessions**       | fk_coa_translation_sessions_entity                 | entity_uuid                   | Refer... |
| **coa_translation_sessions**       | fk_coa_translation_sessions_user_account           | user_uuid                     | Refer... |
| **entities**                       | fk_entities_created_by                             | created_by_user_uuid          | Refer... |
| **entities**                       | fk_entities_entity_group                           | entity_group_uuid             | Refer... |
| **entity_groups**                  | fk_entity_groups_created_by                        | created_by_user_uuid          | Refer... |
| **report_line_items**              | fk_report_line_items_created_by_user_account       | created_by_user_uuid          | Refer... |
| **report_line_items**              | fk_report_line_items_entity                        | entity_uuid                   | Refer... |
| **report_line_items**              | fk_report_line_items_updated_by_user_account       | updated_by_user_uuid          | Refer... |
| **report_line_items**              | report_line_items_created_by_fkey                  | created_by                    | Refer... |
| **report_line_items**              | report_line_items_report_structure_id_fkey         | report_structure_id           | Refer... |
| **report_line_items**              | report_line_items_report_structure_uuid_fkey       | report_structure_uuid         | Refer... |
| **report_line_items**              | report_line_items_source_language_code_fkey        | source_language_code          | Refer... |
| **report_line_items**              | report_line_items_updated_by_fkey                  | updated_by                    | Refer... |
| **report_line_items_translations** | fk_report_line_items_translations_created_by       | created_by                    | Refer... |
| **report_line_items_translations** | fk_report_line_items_translations_item             | report_line_item_uuid         | Refer... |
| **report_line_items_translations** | fk_report_line_items_translations_language         | language_code_target          | Refer... |
| **report_line_items_translations** | fk_report_line_items_translations_updated_by       | updated_by                    | Refer... |
| **report_line_items_translations** | report_line_items_translations_language_code_or... | language_code_original        | Refer... |
| **report_structures**              | fk_report_structures_archived_by_user_account      | archived_by_user_uuid         | Refer... |
| **report_structures**              | fk_report_structures_entity                        | entity_uuid                   | Refer... |
| **report_structures**              | report_structures_archived_by_fkey                 | archived_by                   | Refer... |
| **report_structures**              | report_structures_source_language_code_fkey        | source_language_code          | Refer... |
| **report_structures_translations** | fk_report_structures_translations_created_by       | created_by                    | Refer... |
| **report_structures_translations** | fk_report_structures_translations_language         | language_code_target          | Refer... |
| **report_structures_translations** | fk_report_structures_translations_structure        | report_structure_uuid         | Refer... |
| **report_structures_translations** | fk_report_structures_translations_updated_by       | updated_by                    | Refer... |
| **report_structures_translations** | report_structures_translations_language_code_or... | language_code_original        | Refer... |
| **security_audit_logs**            | fk_security_audit_logs_entity                      | entity_uuid                   | Refer... |
| **security_audit_logs**            | fk_security_audit_logs_target_user_account         | target_user_uuid              | Refer... |
| **security_audit_logs**            | fk_security_audit_logs_user_account                | user_uuid                     | Refer... |
| **security_audit_logs**            | security_audit_log_user_id_fkey                    | user_id                       | Refer... |
| **ui_translations**                | ui_translations_created_by_fkey                    | created_by                    | Refer... |
| **ui_translations**                | ui_translations_language_code_original_fkey        | language_code_original        | Refer... |
| **ui_translations**                | ui_translations_language_code_target_fkey          | language_code_target          | Refer... |
| **ui_translations**                | ui_translations_updated_by_fkey                    | updated_by                    | Refer... |
| **user_accounts**                  | user_accounts_preferred_ui_language_fkey           | preferred_ui_language         | Refer... |
| **user_entity_access**             | fk_user_entity_access_entity                       | entity_uuid                   | Refer... |
| **user_entity_access**             | fk_user_entity_access_entity_group                 | entity_group_uuid             | Refer... |
| **user_entity_access**             | fk_user_entity_access_granted_by                   | granted_by_user_uuid          | Refer... |
| **user_entity_access**             | fk_user_entity_access_user                         | user_uuid                     | Refer... |
| **user_roles**                     | fk_user_roles_assigned_by_user_account             | assigned_by_user_account_uuid | Refer... |
| **user_roles**                     | fk_user_roles_user_account                         | user_uuid                     | Refer... |
| **user_roles**                     | user_roles_assigned_by_fkey                        | assigned_by                   | Refer... |
| **user_roles**                     | user_roles_user_id_fkey                            | user_id                       | Refer... |
| **objects**                        | objects_bucketId_fkey                              | bucket_id                     | Refer... |
| **prefixes**                       | prefixes_bucketId_fkey                             | bucket_id                     | Refer... |
| **s3_multipart_uploads**           | s3_multipart_uploads_bucket_id_fkey                | bucket_id                     | Refer... |
| **s3_multipart_uploads_parts**     | s3_multipart_uploads_parts_bucket_id_fkey          | bucket_id                     | Refer... |
| **s3_multipart_uploads_parts**     | s3_multipart_uploads_parts_upload_id_fkey          | upload_id                     | Refer... |

**Count**: 61 constraints of this type

### UNIQUE Constraints

| Table                              | Constraint Name                                    | Column                          | Details  |
| ---------------------------------- | -------------------------------------------------- | ------------------------------- | -------- |
| **identities**                     | identities_provider_id_provider_unique             | provider_id                     | uniqu... |
| **identities**                     | identities_provider_id_provider_unique             | provider                        | uniqu... |
| **mfa_amr_claims**                 | mfa_amr_claims_session_id_authentication_method... | session_id                      | uniqu... |
| **mfa_amr_claims**                 | mfa_amr_claims_session_id_authentication_method... | authentication_method           | uniqu... |
| **mfa_factors**                    | mfa_factors_last_challenged_at_key                 | last_challenged_at              | uniqu... |
| **oauth_clients**                  | oauth_clients_client_id_key                        | client_id                       | uniqu... |
| **refresh_tokens**                 | refresh_tokens_token_unique                        | token                           | uniqu... |
| **saml_providers**                 | saml_providers_entity_id_key                       | entity_id                       | uniqu... |
| **users**                          | users_phone_key                                    | phone                           | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_type                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | entity_uuid                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | aggregation_scope               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | currency_code                   | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | account_number                  | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | period_key_yyyymm               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_periodicity              | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_type                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | entity_uuid                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | aggregation_scope               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | currency_code                   | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | account_number                  | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | period_key_yyyymm               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_periodicity              | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_type                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | entity_uuid                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | aggregation_scope               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | currency_code                   | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | account_number                  | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | period_key_yyyymm               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_periodicity              | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_type                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | entity_uuid                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | aggregation_scope               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | currency_code                   | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | account_number                  | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | period_key_yyyymm               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_periodicity              | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_type                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | entity_uuid                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | aggregation_scope               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | currency_code                   | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | account_number                  | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | period_key_yyyymm               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_periodicity              | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_type                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | entity_uuid                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | aggregation_scope               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | currency_code                   | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | account_number                  | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | period_key_yyyymm               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_periodicity              | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_type                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | entity_uuid                     | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | aggregation_scope               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | currency_code                   | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | account_number                  | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | period_key_yyyymm               | uniqu... |
| **trial_balance_uploads**          | uq_trial_balance_uploads                           | amount_periodicity              | uniqu... |
| **coa_translation_sessions**       | uq_coa_translation_sessions_id                     | coa_translation_session_id      | uniqu... |
| **coa_translation_sessions**       | uq_coa_translation_sessions_session_id             | session_id                      | uniqu... |
| **entities**                       | uq_entities_code                                   | entity_code                     | uniqu... |
| **entities**                       | uq_entities_id                                     | entity_id                       | uniqu... |
| **entity_groups**                  | uq_entity_groups_code                              | entity_group_code               | uniqu... |
| **entity_groups**                  | uq_entity_groups_id                                | entity_group_id                 | uniqu... |
| **report_line_items**              | uq_report_line_items_id                            | report_line_item_id             | uniqu... |
| **report_line_items**              | uq_report_line_items_structure_sort_order          | sort_order                      | uniqu... |
| **report_line_items**              | uq_report_line_items_structure_sort_order          | sort_order                      | uniqu... |
| **report_line_items**              | uq_report_line_items_structure_sort_order          | report_structure_uuid           | uniqu... |
| **report_line_items**              | uq_report_line_items_structure_sort_order          | report_structure_uuid           | uniqu... |
| **report_line_items_translations** | report_line_items_translation_report_line_item_... | report_line_item_translation_id | uniqu... |
| **report_line_items_translations** | report_line_items_translations_unique              | report_line_item_uuid           | uniqu... |
| **report_line_items_translations** | report_line_items_translations_unique              | report_line_item_uuid           | uniqu... |
| **report_line_items_translations** | report_line_items_translations_unique              | source_field_name               | uniqu... |
| **report_line_items_translations** | report_line_items_translations_unique              | language_code_target            | uniqu... |
| **report_line_items_translations** | report_line_items_translations_unique              | report_line_item_uuid           | uniqu... |
| **report_line_items_translations** | report_line_items_translations_unique              | source_field_name               | uniqu... |
| **report_line_items_translations** | report_line_items_translations_unique              | language_code_target            | uniqu... |
| **report_line_items_translations** | report_line_items_translations_unique              | language_code_target            | uniqu... |
| **report_line_items_translations** | report_line_items_translations_unique              | source_field_name               | uniqu... |
| **report_line_items_translations** | unique_line_item_translation                       | source_field_name               | uniqu... |
| **report_line_items_translations** | unique_line_item_translation                       | report_line_item_uuid           | uniqu... |
| **report_line_items_translations** | unique_line_item_translation                       | report_line_item_uuid           | uniqu... |
| **report_line_items_translations** | unique_line_item_translation                       | language_code_target            | uniqu... |
| **report_line_items_translations** | unique_line_item_translation                       | source_field_name               | uniqu... |
| **report_line_items_translations** | unique_line_item_translation                       | language_code_target            | uniqu... |
| **report_line_items_translations** | unique_line_item_translation                       | source_field_name               | uniqu... |
| **report_line_items_translations** | unique_line_item_translation                       | report_line_item_uuid           | uniqu... |
| **report_line_items_translations** | unique_line_item_translation                       | language_code_target            | uniqu... |
| **report_line_items_translations** | uq_report_line_items_translations_unique           | report_line_item_uuid           | uniqu... |
| **report_line_items_translations** | uq_report_line_items_translations_unique           | source_field_name               | uniqu... |
| **report_line_items_translations** | uq_report_line_items_translations_unique           | language_code_target            | uniqu... |
| **report_line_items_translations** | uq_report_line_items_translations_unique           | source_field_name               | uniqu... |
| **report_line_items_translations** | uq_report_line_items_translations_unique           | language_code_target            | uniqu... |
| **report_line_items_translations** | uq_report_line_items_translations_unique           | report_line_item_uuid           | uniqu... |
| **report_line_items_translations** | uq_report_line_items_translations_unique           | source_field_name               | uniqu... |
| **report_line_items_translations** | uq_report_line_items_translations_unique           | report_line_item_uuid           | uniqu... |
| **report_line_items_translations** | uq_report_line_items_translations_unique           | language_code_target            | uniqu... |
| **report_structure_change_logs**   | uq_report_structure_change_logs_change_id          | change_id                       | uniqu... |
| **report_structures**              | uq_report_structures_id                            | report_structure_id             | uniqu... |
| **report_structures_translations** | report_structures_translation_report_structure_... | report_structure_translation_id | uniqu... |
| **report_structures_translations** | report_structures_translations_unique              | language_code_target            | uniqu... |
| **report_structures_translations** | report_structures_translations_unique              | language_code_target            | uniqu... |
| **report_structures_translations** | report_structures_translations_unique              | source_field_name               | uniqu... |
| **report_structures_translations** | report_structures_translations_unique              | report_structure_uuid           | uniqu... |
| **report_structures_translations** | report_structures_translations_unique              | report_structure_uuid           | uniqu... |
| **report_structures_translations** | report_structures_translations_unique              | source_field_name               | uniqu... |
| **report_structures_translations** | report_structures_translations_unique              | language_code_target            | uniqu... |
| **report_structures_translations** | report_structures_translations_unique              | report_structure_uuid           | uniqu... |
| **report_structures_translations** | report_structures_translations_unique              | source_field_name               | uniqu... |
| **report_structures_translations** | unique_structure_translation                       | report_structure_uuid           | uniqu... |
| **report_structures_translations** | unique_structure_translation                       | source_field_name               | uniqu... |
| **report_structures_translations** | unique_structure_translation                       | report_structure_uuid           | uniqu... |
| **report_structures_translations** | unique_structure_translation                       | language_code_target            | uniqu... |
| **report_structures_translations** | unique_structure_translation                       | source_field_name               | uniqu... |
| **report_structures_translations** | unique_structure_translation                       | language_code_target            | uniqu... |
| **report_structures_translations** | unique_structure_translation                       | report_structure_uuid           | uniqu... |
| **report_structures_translations** | unique_structure_translation                       | source_field_name               | uniqu... |
| **report_structures_translations** | unique_structure_translation                       | language_code_target            | uniqu... |
| **report_structures_translations** | uq_report_structures_translations_unique           | report_structure_uuid           | uniqu... |
| **report_structures_translations** | uq_report_structures_translations_unique           | source_field_name               | uniqu... |
| **report_structures_translations** | uq_report_structures_translations_unique           | language_code_target            | uniqu... |
| **report_structures_translations** | uq_report_structures_translations_unique           | source_field_name               | uniqu... |
| **report_structures_translations** | uq_report_structures_translations_unique           | report_structure_uuid           | uniqu... |
| **report_structures_translations** | uq_report_structures_translations_unique           | source_field_name               | uniqu... |
| **report_structures_translations** | uq_report_structures_translations_unique           | language_code_target            | uniqu... |
| **report_structures_translations** | uq_report_structures_translations_unique           | report_structure_uuid           | uniqu... |
| **report_structures_translations** | uq_report_structures_translations_unique           | language_code_target            | uniqu... |
| **security_audit_logs**            | uq_security_audit_logs_id                          | security_audit_log_id           | uniqu... |
| **ui_translations**                | ui_translations_unique                             | language_code_target            | uniqu... |
| **ui_translations**                | ui_translations_unique                             | source_field_name               | uniqu... |
| **ui_translations**                | ui_translations_unique                             | ui_key                          | uniqu... |
| **ui_translations**                | ui_translations_unique                             | language_code_target            | uniqu... |
| **ui_translations**                | ui_translations_unique                             | source_field_name               | uniqu... |
| **ui_translations**                | ui_translations_unique                             | ui_key                          | uniqu... |
| **ui_translations**                | ui_translations_unique                             | language_code_target            | uniqu... |
| **ui_translations**                | ui_translations_unique                             | source_field_name               | uniqu... |
| **ui_translations**                | ui_translations_unique                             | ui_key                          | uniqu... |
| **ui_translations**                | unique_ui_translation                              | source_field_name               | uniqu... |
| **ui_translations**                | unique_ui_translation                              | language_code_target            | uniqu... |
| **ui_translations**                | unique_ui_translation                              | ui_key                          | uniqu... |
| **ui_translations**                | unique_ui_translation                              | source_field_name               | uniqu... |
| **ui_translations**                | unique_ui_translation                              | language_code_target            | uniqu... |
| **ui_translations**                | unique_ui_translation                              | ui_key                          | uniqu... |
| **ui_translations**                | unique_ui_translation                              | language_code_target            | uniqu... |
| **ui_translations**                | unique_ui_translation                              | ui_key                          | uniqu... |
| **ui_translations**                | unique_ui_translation                              | source_field_name               | uniqu... |
| **user_accounts**                  | uq_user_accounts_email                             | email                           | uniqu... |
| **user_accounts**                  | uq_user_accounts_id                                | user_id                         | uniqu... |
| **user_accounts**                  | uq_user_accounts_supabase_user_uuid                | supabase_user_uuid              | uniqu... |
| **user_entity_access**             | uq_user_entity_access_id                           | user_entity_access_id           | uniqu... |
| **user_roles**                     | uq_user_roles_id                                   | user_role_id                    | uniqu... |
| **schema_migrations**              | schema_migrations_idempotency_key_key              | idempotency_key                 | uniqu... |

**Count**: 152 constraints of this type

### Constraint Summary
- **Primary Key**: Ensures unique identification of records
- **Foreign Key**: Maintains referential integrity between tables  
- **Unique**: Prevents duplicate values in specified columns
- **Check**: Enforces custom validation rules and business logic

---

## Enums and Custom Types

### access_level

**Values**: viewer, entity_admin


### account_type

**Values**: pl, bs, subledger, statistical


### aggregation_scope

**Values**: period, ytd, qtd, mtd, ltm, ltd, custom_period


### amount_periodicity

**Values**: monthly, quarterly, annual


### amount_time_basis

**Values**: point-in-time, time-span


### amount_type

**Values**: opening, movement, ending, total, debit_total, credit_total


### app_role

**Values**: super_admin, entity_admin, viewer


### change_action_type

**Values**: create, delete, rename, move


### measurement_basis

**Values**: instant, movement


### report_structure_lifecycle_status

**Values**: draft, active, inactive, archived, deprecated


### time_grain

**Values**: monthly, quarterly, annual


### translation_session_status

**Values**: pending, processing, completed, failed, cancelled, paused


### user_account_status

**Values**: pending, approved, rejected, suspended, archived



---

## Foreign Key Relationships Graph (Text-Based)

This section provides a text-based mapping of all foreign key relationships in the database:

- **coa_translation_sessions.entity_uuid**  **entities.entity_uuid**
- **coa_translation_sessions.user_uuid**  **user_accounts.user_uuid**
- **entities.created_by_user_uuid**  **user_accounts.user_uuid**
- **entities.entity_group_uuid**  **entity_groups.entity_group_uuid**
- **entity_groups.created_by_user_uuid**  **user_accounts.user_uuid**
- **report_line_items.created_by_user_uuid**  **user_accounts.user_uuid**
- **report_line_items.entity_uuid**  **entities.entity_uuid**
- **report_line_items.report_structure_id**  **report_structures.report_structure_id**
- **report_line_items.report_structure_uuid**  **report_structures.report_structure_uuid**
- **report_line_items.source_language_code**  **system_languages.language_code**
- **report_line_items.updated_by_user_uuid**  **user_accounts.user_uuid**
- **report_line_items_translations.language_code_original**  **system_languages.language_code**
- **report_line_items_translations.language_code_target**  **system_languages.language_code**
- **report_line_items_translations.report_line_item_uuid**  **report_line_items.report_line_item_uuid**
- **report_structures.archived_by_user_uuid**  **user_accounts.user_uuid**
- **report_structures.entity_uuid**  **entities.entity_uuid**
- **report_structures.source_language_code**  **system_languages.language_code**
- **report_structures_translations.language_code_original**  **system_languages.language_code**
- **report_structures_translations.language_code_target**  **system_languages.language_code**
- **report_structures_translations.report_structure_uuid**  **report_structures.report_structure_uuid**
- **security_audit_logs.entity_uuid**  **entities.entity_uuid**
- **security_audit_logs.target_user_uuid**  **user_accounts.user_uuid**
- **security_audit_logs.user_uuid**  **user_accounts.user_uuid**
- **ui_translations.language_code_original**  **system_languages.language_code**
- **ui_translations.language_code_target**  **system_languages.language_code**
- **user_accounts.preferred_ui_language**  **system_languages.language_code**
- **user_entity_access.entity_group_uuid**  **entity_groups.entity_group_uuid**
- **user_entity_access.entity_uuid**  **entities.entity_uuid**
- **user_entity_access.granted_by_user_uuid**  **user_accounts.user_uuid**
- **user_entity_access.user_uuid**  **user_accounts.user_uuid**
- **user_roles.assigned_by_user_account_uuid**  **user_accounts.user_uuid**
- **user_roles.user_uuid**  **user_accounts.user_uuid**

---

## Database Functions

The database includes 195 custom functions for business logic, security, and data validation:

| Function Name                                      | Schema         | Return Type           | Arguments                                          | Type     |
| -------------------------------------------------- | -------------- | --------------------- | -------------------------------------------------- | -------- |
| **email**                                          | auth           | text                  | None                                               | function |
| **jwt**                                            | auth           | jsonb                 | None                                               | function |
| **role**                                           | auth           | text                  | None                                               | function |
| **uid**                                            | auth           | uuid                  | None                                               | function |
| **armor**                                          | extensions     | text                  | bytea, text[], text[]                              | function |
| **armor**                                          | extensions     | text                  | bytea                                              | function |
| **crypt**                                          | extensions     | text                  | text, text                                         | function |
| **dearmor**                                        | extensions     | bytea                 | text                                               | function |
| **decrypt**                                        | extensions     | bytea                 | bytea, bytea, text                                 | function |
| **decrypt_iv**                                     | extensions     | bytea                 | bytea, bytea, bytea, text                          | function |
| **digest**                                         | extensions     | bytea                 | text, text                                         | function |
| **digest**                                         | extensions     | bytea                 | bytea, text                                        | function |
| **encrypt**                                        | extensions     | bytea                 | bytea, bytea, text                                 | function |
| **encrypt_iv**                                     | extensions     | bytea                 | bytea, bytea, bytea, text                          | function |
| **gen_salt**                                       | extensions     | text                  | text, integer                                      | function |
| **gen_salt**                                       | extensions     | text                  | text                                               | function |
| **grant_pg_cron_access**                           | extensions     | event_trigger         | None                                               | function |
| **grant_pg_graphql_access**                        | extensions     | event_trigger         | None                                               | function |
| **grant_pg_net_access**                            | extensions     | event_trigger         | None                                               | function |
| **hmac**                                           | extensions     | bytea                 | bytea, bytea, text                                 | function |
| **hmac**                                           | extensions     | bytea                 | text, text, text                                   | function |
| **set_graphql_placeholder**                        | extensions     | event_trigger         | None                                               | function |
| **uuid_generate_v1**                               | extensions     | uuid                  | None                                               | function |
| **uuid_generate_v1mc**                             | extensions     | uuid                  | None                                               | function |
| **uuid_generate_v3**                               | extensions     | uuid                  | namespace uuid, name text                          | function |
| **uuid_generate_v4**                               | extensions     | uuid                  | None                                               | function |
| **uuid_generate_v5**                               | extensions     | uuid                  | namespace uuid, name text                          | function |
| **uuid_nil**                                       | extensions     | uuid                  | None                                               | function |
| **uuid_ns_dns**                                    | extensions     | uuid                  | None                                               | function |
| **uuid_ns_oid**                                    | extensions     | uuid                  | None                                               | function |
| **uuid_ns_url**                                    | extensions     | uuid                  | None                                               | function |
| **uuid_ns_x500**                                   | extensions     | uuid                  | None                                               | function |
| **_internal_resolve**                              | graphql        | jsonb                 | query text, variables jsonb DEFAULT '{}'::jsonb... | function |
| **comment_directive**                              | graphql        | jsonb                 | comment_ text                                      | function |
| **exception**                                      | graphql        | text                  | message text                                       | function |
| **get_schema_version**                             | graphql        | integer               | None                                               | function |
| **increment_schema_version**                       | graphql        | event_trigger         | None                                               | function |
| **resolve**                                        | graphql        | jsonb                 | query text, variables jsonb DEFAULT '{}'::jsonb... | function |
| **graphql**                                        | graphql_public | jsonb                 | "operationName" text DEFAULT NULL::text, query ... | function |
| **get_auth**                                       | pgbouncer      | record                | p_usename text                                     | function |
| **assess_translation_data_completeness**           | public         | jsonb                 | None                                               | function |
| **audit_user_account_changes**                     | public         | trigger               | None                                               | function |
| **audit_user_accounts_access**                     | public         | trigger               | None                                               | function |
| **bulk_update_user_status**                        | public         | jsonb                 | p_user_uuids uuid[], p_new_status user_account_... | function |
| **can_access_audit_logs**                          | public         | boolean               | None                                               | function |
| **can_delete_users**                               | public         | boolean               | None                                               | function |
| **can_manage_report_structure_status**             | public         | boolean               | None                                               | function |
| **check_permission_conflicts**                     | public         | record                | p_user_uuid uuid                                   | function |
| **check_translation_data_integrity**               | public         | jsonb                 | None                                               | function |
| **check_ui_translation_integrity**                 | public         | jsonb                 | None                                               | function |
| **cleanup_old_documentation_files**                | public         | integer               | p_keep_count integer DEFAULT 10                    | function |
| **compute_hierarchy_fields_for_structure**         | public         | jsonb                 | p_structure_uuid uuid                              | function |
| **convert_line_items_to_concatenated_format**      | public         | jsonb                 | p_structure_id integer                             | function |
| **create_translation_entries**                     | public         | void                  | p_entity_type text, p_entity_uuid uuid, p_trans... | function |
| **debug_translation_fallback**                     | public         | jsonb                 | p_entity_type text, p_entity_uuid uuid, p_sourc... | function |
| **delete_all_rows_secure**                         | public         | integer               | p_schema_name text, p_table_name text, p_mode t... | function |
| **delete_entity_group_safe**                       | public         | jsonb                 | p_entity_group_uuid uuid, p_force_delete boolea... | function |
| **delete_entity_safe**                             | public         | jsonb                 | p_entity_uuid uuid, p_force_delete boolean DEFA... | function |
| **delete_trial_balance_record**                    | public         | jsonb                 | p_uuid uuid                                        | function |
| **detect_suspicious_activity**                     | public         | boolean               | p_user_id uuid, p_time_window_minutes integer D... | function |
| **enforce_node_limit**                             | public         | trigger               | None                                               | function |
| **enhanced_check_rate_limit**                      | public         | boolean               | operation_type text, identifier text, max_attem... | function |
| **enhanced_log_security_event**                    | public         | uuid                  | p_action text, p_target_user_id uuid DEFAULT NU... | function |
| **enhanced_log_security_event**                    | public         | uuid                  | p_action text, p_target_user_id uuid DEFAULT NU... | function |
| **extract_structure_id_from_line_item_id**         | public         | integer               | p_line_item_id integer                             | function |
| **get_all_user_profiles_admin**                    | public         | record                | None                                               | function |
| **get_column_info**                                | public         | record                | None                                               | function |
| **get_current_user_details**                       | public         | record                | None                                               | function |
| **get_database_functions**                         | public         | record                | None                                               | function |
| **get_enhanced_user_management_summary**           | public         | record                | None                                               | function |
| **get_enhanced_user_summary**                      | public         | record                | None                                               | function |
| **get_enum_values**                                | public         | record                | None                                               | function |
| **get_foreign_keys**                               | public         | record                | None                                               | function |
| **get_indexes**                                    | public         | record                | None                                               | function |
| **get_next_concatenated_line_item_id**             | public         | integer               | p_structure_id integer                             | function |
| **get_report_structure_with_creator**              | public         | record                | p_structure_uuid uuid                              | function |
| **get_report_structures_by_lifecycle_status**      | public         | record                | p_status report_structure_lifecycle_status         | function |
| **get_rls_policies**                               | public         | record                | None                                               | function |
| **get_schema_info**                                | public         | record                | None                                               | function |
| **get_table_constraints**                          | public         | record                | None                                               | function |
| **get_table_info**                                 | public         | record                | None                                               | function |
| **get_table_metadata**                             | public         | record                | None                                               | function |
| **get_translation**                                | public         | text                  | p_entity_type text, p_entity_uuid uuid, p_field... | function |
| **get_translation_sessions_by_status**             | public         | record                | p_status translation_session_status                | function |
| **get_translation_with_fallback**                  | public         | text                  | p_entity_type text, p_entity_uuid uuid, p_sourc... | function |
| **get_trial_balance_data**                         | public         | record                | p_entity_uuid uuid DEFAULT NULL::uuid              | function |
| **get_user_accessible_entities**                   | public         | record                | p_user_uuid uuid                                   | function |
| **get_user_account_by_supabase_uuid**              | public         | record                | p_supabase_uuid uuid                               | function |
| **get_user_effective_permissions**                 | public         | record                | p_user_uuid uuid                                   | function |
| **get_user_profile_safe**                          | public         | record                | None                                               | function |
| **get_user_session_activity**                      | public         | record                | None                                               | function |
| **get_user_summary**                               | public         | record                | None                                               | function |
| **get_user_with_roles**                            | public         | record                | p_supabase_user_uuid uuid                          | function |
| **get_users_by_status**                            | public         | record                | p_status user_account_status                       | function |
| **get_valid_user_account_status_transitions**      | public         | user_account_status[] | p_current_status user_account_status               | function |
| **grant_entity_access**                            | public         | boolean               | p_user_uuid uuid, p_entity_uuid uuid, p_access_... | function |
| **grant_entity_access**                            | public         | boolean               | p_user_uuid uuid, p_access_level access_level, ... | function |
| **grant_entity_group_access**                      | public         | boolean               | p_user_uuid uuid, p_entity_group_uuid uuid, p_a... | function |
| **handle_new_user**                                | public         | trigger               | None                                               | function |
| **handle_new_user_role**                           | public         | trigger               | None                                               | function |
| **has_role**                                       | public         | boolean               | _user_id uuid, _role app_role                      | function |
| **insert_trial_balance_data**                      | public         | jsonb                 | p_data jsonb                                       | function |
| **invite_user_with_role**                          | public         | jsonb                 | p_email text, p_first_name text DEFAULT NULL::t... | function |
| **is_admin_user**                                  | public         | boolean               | None                                               | function |
| **is_admin_user_v2**                               | public         | boolean               | None                                               | function |
| **is_entity_admin_for_scope**                      | public         | boolean               | p_user_uuid uuid, p_entity_uuid uuid DEFAULT NU... | function |
| **is_super_admin_user**                            | public         | boolean               | None                                               | function |
| **is_super_admin_user_secure**                     | public         | boolean               | None                                               | function |
| **is_table_protected**                             | public         | boolean               | p_schema_name text, p_table_name text              | function |
| **is_user_deletable**                              | public         | boolean               | target_user_uuid uuid                              | function |
| **is_valid_report_structure_lifecycle_transition** | public         | boolean               | p_from_status report_structure_lifecycle_status... | function |
| **is_valid_translation_session_status_transition** | public         | boolean               | p_from_status translation_session_status, p_to_... | function |
| **is_valid_user_account_status_transition**        | public         | boolean               | p_from_status user_account_status, p_to_status ... | function |
| **log_failed_auth_attempt**                        | public         | void                  | p_email text, p_ip_address inet DEFAULT NULL::i... | function |
| **log_security_event**                             | public         | void                  | p_action text, p_target_user_id uuid DEFAULT NU... | function |
| **log_security_function_changes**                  | public         | event_trigger         | None                                               | function |
| **log_sql_maintenance_event**                      | public         | uuid                  | p_action text, p_schema_name text, p_table_name... | function |
| **log_sql_maintenance_event**                      | public         | uuid                  | p_action text, p_schema_name text, p_table_name... | function |
| **log_sql_maintenance_event**                      | public         | uuid                  | p_action text, p_schema_name text, p_table_name... | function |
| **log_structure_change**                           | public         | uuid                  | p_structure_uuid uuid, p_structure_id integer, ... | function |
| **log_trial_balance_upload**                       | public         | void                  | p_file_name text, p_file_size integer, p_entity... | function |
| **log_user_data_access**                           | public         | void                  | p_accessed_user_uuid uuid, p_access_type text, ... | function |
| **migrate_existing_translations**                  | public         | jsonb                 | None                                               | function |
| **migrate_report_line_items_translations_null_v... | public         | jsonb                 | None                                               | function |
| **migrate_report_structures_translations_null_v... | public         | jsonb                 | None                                               | function |
| **migrate_ui_translations_null_values**            | public         | jsonb                 | None                                               | function |
| **prevent_null_translation_fields**                | public         | trigger               | None                                               | function |
| **prevent_rls_disable**                            | public         | event_trigger         | None                                               | function |
| **prevent_self_role_escalation**                   | public         | trigger               | None                                               | function |
| **reorder_line_item_with_hierarchy**               | public         | jsonb                 | p_structure_uuid uuid, p_moved_item_uuid uuid, ... | function |
| **revoke_all_user_access**                         | public         | jsonb                 | p_user_uuid uuid, p_reason text DEFAULT 'Accoun... | function |
| **save_trial_balance_data**                        | public         | jsonb                 | p_trial_balance_data jsonb                         | function |
| **secure_insert_audit_log**                        | public         | uuid                  | p_user_id uuid, p_action text, p_target_user_id... | function |
| **set_audit_fields_safe**                          | public         | trigger               | None                                               | function |
| **set_updated_at**                                 | public         | trigger               | None                                               | function |
| **transition_user_account_status**                 | public         | boolean               | p_user_uuid uuid, p_new_status user_account_sta... | function |
| **update_own_profile**                             | public         | jsonb                 | p_first_name text DEFAULT NULL::text, p_last_na... | function |
| **update_sort_orders_transaction**                 | public         | jsonb                 | p_structure_uuid uuid, p_updates jsonb             | function |
| **update_translations_updated_at**                 | public         | trigger               | None                                               | function |
| **update_trial_balance_updated_at**                | public         | trigger               | None                                               | function |
| **update_updated_at_column**                       | public         | trigger               | None                                               | function |
| **user_has_entity_access**                         | public         | boolean               | p_user_uuid uuid, p_entity_uuid uuid               | function |
| **validate_report_structure_lifecycle_transition** | public         | trigger               | None                                               | function |
| **validate_translation_data_integrity**            | public         | jsonb                 | None                                               | function |
| **validate_translation_language_consistency**      | public         | trigger               | None                                               | function |
| **validate_translation_session_status_transition** | public         | trigger               | None                                               | function |
| **validate_ui_translation_completeness**           | public         | trigger               | None                                               | function |
| **validate_user_account_status_transition**        | public         | trigger               | None                                               | function |
| **validate_user_input**                            | public         | text                  | input_text text, max_length integer DEFAULT 1000   | function |
| **validate_user_input**                            | public         | boolean               | input_data jsonb, validation_rules jsonb           | function |
| **apply_rls**                                      | realtime       | realtime.wal_rls      | wal jsonb, max_record_bytes integer DEFAULT (10... | function |
| **broadcast_changes**                              | realtime       | void                  | topic_name text, event_name text, operation tex... | function |
| **build_prepared_statement_sql**                   | realtime       | text                  | prepared_statement_name text, entity regclass, ... | function |
| **cast**                                           | realtime       | jsonb                 | val text, type_ regtype                            | function |
| **check_equality_op**                              | realtime       | boolean               | op realtime.equality_op, type_ regtype, val_1 t... | function |
| **is_visible_through_filters**                     | realtime       | boolean               | columns realtime.wal_column[], filters realtime... | function |
| **list_changes**                                   | realtime       | realtime.wal_rls      | publication name, slot_name name, max_changes i... | function |
| **quote_wal2json**                                 | realtime       | text                  | entity regclass                                    | function |
| **send**                                           | realtime       | void                  | payload jsonb, event text, topic text, private ... | function |
| **subscription_check_filters**                     | realtime       | trigger               | None                                               | function |
| **to_regrole**                                     | realtime       | regrole               | role_name text                                     | function |
| **topic**                                          | realtime       | text                  | None                                               | function |
| **add_prefixes**                                   | storage        | void                  | _bucket_id text, _name text                        | function |
| **can_insert_object**                              | storage        | void                  | bucketid text, name text, owner uuid, metadata ... | function |
| **delete_leaf_prefixes**                           | storage        | void                  | bucket_ids text[], names text[]                    | function |
| **delete_prefix**                                  | storage        | boolean               | _bucket_id text, _name text                        | function |
| **delete_prefix_hierarchy_trigger**                | storage        | trigger               | None                                               | function |
| **enforce_bucket_name_length**                     | storage        | trigger               | None                                               | function |
| **extension**                                      | storage        | text                  | name text                                          | function |
| **filename**                                       | storage        | text                  | name text                                          | function |
| **foldername**                                     | storage        | text[]                | name text                                          | function |
| **get_level**                                      | storage        | integer               | name text                                          | function |
| **get_prefix**                                     | storage        | text                  | name text                                          | function |
| **get_prefixes**                                   | storage        | text[]                | name text                                          | function |
| **get_size_by_bucket**                             | storage        | record                | None                                               | function |
| **list_multipart_uploads_with_delimiter**          | storage        | record                | bucket_id text, prefix_param text, delimiter_pa... | function |
| **list_objects_with_delimiter**                    | storage        | record                | bucket_id text, prefix_param text, delimiter_pa... | function |
| **lock_top_prefixes**                              | storage        | void                  | bucket_ids text[], names text[]                    | function |
| **objects_delete_cleanup**                         | storage        | trigger               | None                                               | function |
| **objects_insert_prefix_trigger**                  | storage        | trigger               | None                                               | function |
| **objects_update_cleanup**                         | storage        | trigger               | None                                               | function |
| **objects_update_prefix_trigger**                  | storage        | trigger               | None                                               | function |
| **operation**                                      | storage        | text                  | None                                               | function |
| **prefixes_delete_cleanup**                        | storage        | trigger               | None                                               | function |
| **prefixes_insert_trigger**                        | storage        | trigger               | None                                               | function |
| **search**                                         | storage        | record                | prefix text, bucketname text, limits integer DE... | function |
| **search_legacy_v1**                               | storage        | record                | prefix text, bucketname text, limits integer DE... | function |
| **search_v1_optimised**                            | storage        | record                | prefix text, bucketname text, limits integer DE... | function |
| **search_v2**                                      | storage        | record                | prefix text, bucket_name text, limits integer D... | function |
| **update_updated_at_column**                       | storage        | trigger               | None                                               | function |
| **_crypto_aead_det_decrypt**                       | vault          | bytea                 | message bytea, additional bytea, key_id bigint,... | function |
| **_crypto_aead_det_encrypt**                       | vault          | bytea                 | message bytea, additional bytea, key_id bigint,... | function |
| **_crypto_aead_det_noncegen**                      | vault          | bytea                 | None                                               | function |
| **create_secret**                                  | vault          | uuid                  | new_secret text, new_name text DEFAULT NULL::te... | function |
| **update_secret**                                  | vault          | void                  | secret_id uuid, new_secret text DEFAULT NULL::t... | function |

---

## Security Policies Summary

This database implements Row Level Security (RLS) across 18 tables to ensure data isolation and proper access control.

### Tables with RLS Enabled

- **trial_balance_uploads**: 4 policies
- **coa_translation_sessions**: 5 policies
- **entities**: 3 policies
- **entity_groups**: 2 policies
- **report_line_items**: 5 policies
- **report_line_items_translations**: 2 policies
- **report_structure_change_logs**: 3 policies
- **report_structures**: 5 policies
- **report_structures_translations**: 2 policies
- **security_audit_logs**: 4 policies
- **security_rate_limits**: 1 policies
- **system_languages**: 2 policies
- **ui_translations**: 2 policies
- **user_accounts**: 6 policies
- **user_entity_access**: 6 policies
- **user_roles**: 3 policies
- **user_session_logs**: 4 policies
- **objects**: 22 policies

### Key Security Features
- **Row Level Security**: Enabled on 18 tables
- **Role-based Access Control**: Different access levels (viewer, entity_admin, super_admin)
- **Audit Logging**: All sensitive operations are logged to security_audit_logs
- **Rate Limiting**: Protection against excessive API calls

---

## Indexes and Performance

The database includes 179 indexes for performance optimization:

### Index Summary by Type

| Index Type | Count    |
| ---------- | -------- |
| **btree**  | 177      |
| **hash**   | 2        |

---

## Usage Examples

This section provides practical examples of how to interact with the database structure:

### Common Query Patterns

#### User and Role Management
```sql
-- Get user with roles and entity access
SELECT 
  ua.email,
  ua.first_name,
  ua.last_name,
  ur.role,
  uea.access_level,
  e.entity_name
FROM user_accounts ua
JOIN user_roles ur ON ua.supabase_user_uuid = ur.user_id
LEFT JOIN user_entity_access uea ON ua.user_uuid = uea.user_uuid
LEFT JOIN entities e ON uea.entity_uuid = e.entity_uuid
WHERE ua.user_status = 'approved'
  AND uea.is_active = true;
```

#### Security Audit Queries
```sql
-- Recent security events for monitoring
SELECT 
  action,
  user_id,
  details,
  created_at
FROM security_audit_logs
WHERE created_at >= now() - interval '24 hours'
ORDER BY created_at DESC;
```

#### Report Structure Access
```sql
-- Get active report structure with line items
SELECT 
  rs.report_structure_name,
  rli.report_line_item_key,
  rli.report_line_item_description,
  rli.sort_order,
  rli.is_leaf
FROM report_structures rs
JOIN report_line_items rli ON rs.report_structure_uuid = rli.report_structure_uuid
WHERE rs.is_active = true
ORDER BY rli.sort_order;
```

### Application Integration Examples

#### Supabase Client Usage (TypeScript)
```typescript
import { supabase } from '@/integrations/supabase/client';

// Fetch user profile with roles
async function getUserProfile(userId: string) {
  const { data, error } = await supabase
    .from('user_accounts')
    .select(`
      *,
      user_roles(*),
      user_entity_access(
        access_level,
        entities(entity_name, entity_code)
      )
    `)
    .eq('supabase_user_uuid', userId)
    .single();
    
  return { data, error };
}

// Create security audit log
async function logSecurityEvent(action: string, details: any) {
  const { data, error } = await supabase
    .from('security_audit_logs')
    .insert({
      action,
      details,
      // user_id automatically set by RLS policy
    });
    
  return { data, error };
}
```

#### RLS Policy Usage Examples
```sql
-- Example of how RLS policies work in practice:

-- This query automatically filters by user's accessible entities
SELECT * FROM report_structures; 
-- RLS policy ensures user only sees structures they have access to

-- This insert automatically sets user_id from auth context
INSERT INTO security_audit_logs (action, details) 
VALUES ('user_login', '{"ip": "192.168.1.1"}');
-- RLS policy ensures user_id = auth.uid()
```

### Data Validation Examples

#### Using Database Functions
```sql
-- Check if user has admin privileges
SELECT is_admin_user_v2();

-- Get user's accessible entities  
SELECT * FROM get_user_accessible_entities('user-uuid-here');

-- Clean up old documentation files
SELECT cleanup_old_documentation_files(5); -- Keep 5 most recent
```

#### Working with Constraints
```sql
-- Primary key constraints ensure uniqueness
INSERT INTO entities (entity_name, entity_code) 
VALUES ('New Entity', 'NEW_ENTITY');
-- Will succeed if entity_code is unique

-- Foreign key constraints maintain referential integrity
INSERT INTO user_entity_access (user_uuid, entity_uuid, access_level)
VALUES ('valid-user-uuid', 'valid-entity-uuid', 'viewer');
-- Will fail if either UUID doesn't exist in parent tables

-- Check constraints enforce business rules
-- (Examples depend on specific CHECK constraints in your schema)
```

### Performance Optimization Tips

#### Using Indexes Effectively
```sql
-- Leverage indexes for faster queries:

-- Use indexed columns in WHERE clauses
SELECT * FROM security_audit_logs 
WHERE created_at >= '2024-01-01'  -- Uses timestamp index
  AND action = 'login_success';    -- Uses action index if exists

-- Sort by indexed columns for better performance
SELECT * FROM report_line_items 
WHERE report_structure_uuid = 'structure-uuid'
ORDER BY sort_order;  -- Uses sort_order index
```

#### Efficient Pagination
```typescript
// Efficient pagination using created_at cursor
const { data } = await supabase
  .from('security_audit_logs')
  .select('*')
  .order('created_at', { ascending: false })
  .limit(50);
  
// For next page, use last record's created_at as cursor
const { data: nextPage } = await supabase
  .from('security_audit_logs')
  .select('*')
  .lt('created_at', lastRecord.created_at)
  .order('created_at', { ascending: false })
  .limit(50);
```

### Error Handling Best Practices

#### Common Error Scenarios
```typescript
try {
  const { data, error } = await supabase
    .from('user_accounts')
    .insert({ email: 'user@example.com' });
    
  if (error) {
    if (error.code === '23505') { // Unique violation
      console.log('Email already exists');
    } else if (error.code === '42501') { // RLS violation
      console.log('Access denied by security policy');
    } else {
      console.log('Unexpected error:', error.message);
    }
  }
} catch (err) {
  console.error('Network or other error:', err);
}
```

---

## Conventions Used

This database follows these naming and structural conventions:

- **snake_case**: All table and column names use snake_case
- **Timestamps**: All tables include created_at and updated_at fields where applicable
- **UUIDs**: Primary keys use UUID format with gen_random_uuid() default
- **Soft Delete**: Some tables support soft delete with is_active flags
- **Audit Trail**: Important operations are logged with user attribution
- **Foreign Keys**: Proper referential integrity with named constraints
- **RLS Policies**: Comprehensive row-level security implementation

---

## Changelog

- **9/24/2025**: v04 - Initial database structure documentation generated by Thomas Schenkelberg
  - Generated comprehensive schema documentation
  - Included 49 tables, 568 columns
  - Documented 32 foreign key relationships
  - Cataloged 81 RLS policies
  - Listed 195 database functions
  - Indexed 179 performance indexes

---

*This documentation was automatically generated from the live database schema. For the most current information, regenerate this documentation from the System Administration panel.*
